
======================================================================
JUSTDATA FULL STACK INTEGRATION TEST
======================================================================

======================================================================
BACKEND TESTS
======================================================================

Test 1: App Creation
  âœ… App created successfully

Test 2: Blueprint Registration
  âœ… branchseeker blueprint registered
  âœ… lendsight blueprint registered
  âœ… bizsight blueprint registered
  âœ… mergermeter blueprint registered
  âœ… branchmapper blueprint registered
  âœ… dashboard blueprint registered

Test 3: Route Registration
  âœ… Route landing -> /
  âœ… Route health -> /health
  âœ… Route api_access_info -> /api/access-info
  âœ… Route branchseeker.index -> /branchseeker/
  âœ… Route lendsight.index -> /lendsight/
  âœ… Route bizsight.index -> /bizsight/
  âœ… Route mergermeter.index -> /mergermeter/
  âœ… Route branchmapper.index -> /branchmapper/

Test 4: API Endpoints
  âœ… /health endpoint: healthy
  âœ… /api/access-info: user_type = public

======================================================================
FRONTEND TESTS
======================================================================

Test 1: Template Rendering
  âœ… Landing page renders
    âœ… Contains 'JustData' text
    âœ… Contains app cards
    âœ… No unrendered template variables
  âœ… branchseeker page accessible (status: 302)
  âœ… lendsight page accessible (status: 200)
  âœ… bizsight page accessible (status: 302)
  âœ… mergermeter page accessible (status: 302)

Test 2: Static File Serving
  âœ… /static/css/style.css served (text/css; charset=utf-8)
  âœ… /static/js/app.js served (text/javascript; charset=utf-8)

Test 3: Template Variable Injection
  âœ… Template variables rendered (no raw Jinja2 syntax)

======================================================================
INTEGRATION TESTS
======================================================================

Test 1: Full Analysis Request Flow (LendSight)
[DEBUG] analyze endpoint - received data: {'counties': 'Alameda County, California', 'selection_type': 'county', 'years': ''}
[DEBUG] Calling parse_web_parameters with counties_str=Alameda County;California, years=auto (last 5), selection_type=county, state_code=None
âœ… Fetched last 5 HMDA years: [2024, 2023, 2022, 2021, 2020]
âœ… Automatically using last 5 HMDA years: [2024, 2023, 2022, 2021, 2020]
[DEBUG] parse_web_parameters returned 2 counties and 5 years
[DEBUG] Starting background thread for job 823fc544-6ab8-4d83-bcec-5e1d9e4284f4
Matching county 1/2: Alameda County
[DEBUG] Returning success response with job_id: 823fc544-6ab8-4d83-bcec-5e1d9e4284f4
  âœ… Analysis request accepted
    âœ… Job ID: 823fc544-6ab8-4d83-bcec-5e1d9e4284f4
    âœ… Progress endpoint accessible

Test 2: User Type API
  âœ… User type set to: staff
    âœ… Permissions: ['can_export', 'export_formats', 'geographic_limit']

Test 3: Cache System Integration
  âœ… Cache key generation works
    âœ… Normalized params: ['app', 'counties', 'years']
    âœ… Cache key: lendsight_0acd1815c7bd477326e55b...

======================================================================
TEST SUMMARY
======================================================================
âœ… Backend: App creation, blueprints, routes, APIs
âœ… Frontend: Templates, static files, rendering
âœ… Integration: Analysis flow, user management, cache

ðŸŽ‰ Full stack test complete!

To start the server:
  python run_justdata.py

Then open: http://localhost:8000
