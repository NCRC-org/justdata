<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataExplorer 2.0 - Interactive Financial Data Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('.static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('.static', filename='css/dashboard.css') }}?v={{ version }}">
    <link rel="icon" type="image/png" href="/static/favicon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon-16x16.png">
</head>
<body>
    <div class="container">
        {% include "shared_header.html" %}

        <nav class="mode-selector">
            <button class="mode-btn active" data-mode="area">Area Analysis</button>
            <button class="mode-btn" data-mode="lender">Lender Targeting</button>
        </nav>

        <!-- Area Analysis Mode -->
        <div id="area-mode" class="mode-panel active">
            <div class="panel-header">
                <h2>Area Analysis</h2>
                <p>Analyze lending patterns by geography, year, and data type</p>
            </div>

            <div class="form-section">
                <div class="form-group">
                    <label for="data-type">Data Type:</label>
                    <select id="data-type" class="form-control">
                        <option value="hmda">HMDA Mortgage Lending</option>
                        <option value="sb">Small Business Lending</option>
                        <option value="branches">Bank Branches</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="years">Years:</label>
                    <input type="text" id="years" class="form-control" placeholder="e.g., 2020,2021,2022,2023,2024">
                    <small class="form-text">Comma-separated years (max 10 years)</small>
                </div>

                <div class="form-group">
                    <label for="geoids">GEOIDs (County FIPS Codes):</label>
                    <textarea id="geoids" class="form-control" rows="3" placeholder="e.g., 24031,24033,24035"></textarea>
                    <small class="form-text">Comma-separated county FIPS codes (max 100 counties)</small>
                </div>

                <div class="form-group">
                    <button id="run-area-analysis" class="btn btn-primary">Run Analysis</button>
                </div>
            </div>

            <div id="area-results" class="results-panel" style="display: none;">
                <h3>Analysis Results</h3>
                <div id="area-results-content"></div>
            </div>
        </div>

        <!-- Lender Targeting Mode -->
        <div id="lender-mode" class="mode-panel">
            <div class="panel-header">
                <h2>Lender Targeting</h2>
                <p>Analyze specific lenders with peer comparison</p>
            </div>

            <div class="form-section">
                <div class="form-group">
                    <label for="lender-search">Search for Lender:</label>
                    <input type="text" id="lender-search" class="form-control" placeholder="Enter lender name">
                    <button id="search-lender" class="btn btn-secondary">Search</button>
                </div>

                <div id="lender-results" class="lender-list" style="display: none;">
                    <h4>Select a Lender:</h4>
                    <div id="lender-options"></div>
                </div>

                <div id="selected-lender-info" class="selected-lender" style="display: none;">
                    <h4>Selected Lender:</h4>
                    <div id="lender-details"></div>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="enable-peer-comparison" checked>
                        Enable Peer Comparison
                    </label>
                </div>

                <div class="form-group">
                    <label for="lender-years">Years:</label>
                    <input type="text" id="lender-years" class="form-control" placeholder="e.g., 2020,2021,2022,2023,2024">
                </div>

                <div class="form-group">
                    <button id="run-lender-analysis" class="btn btn-primary" disabled>Run Analysis</button>
                </div>
            </div>

            <div id="lender-results-panel" class="results-panel" style="display: none;">
                <h3>Lender Analysis Results</h3>
                <div id="lender-results-content"></div>
            </div>
        </div>

        <!-- Shared Footer -->
        {% set app_name = "DataExplorer" %}
        {% include "shared_footer.html" %}
    </div>

    <script src="{{ url_for('.static', filename='js/dashboard.js') }}?v={{ version }}"></script>

    <script>
        // Toggle hamburger navigation menu
        function toggleNavMenu() {
            const menu = document.getElementById('navMenu');
            if (menu.style.display === 'none' || menu.style.display === '') {
                menu.style.display = 'block';
            } else {
                menu.style.display = 'none';
            }
        }

        // Close menu when clicking outside
        document.addEventListener('click', function(event) {
            const menu = document.getElementById('navMenu');
            const hamburger = document.querySelector('.hamburger-menu');
            if (menu && hamburger && !menu.contains(event.target) && !hamburger.contains(event.target)) {
                menu.style.display = 'none';
            }
        });
    </script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-analytics-compat.js"></script>

    <!-- JustData Auth -->
    <script src="/static/js/auth.js"></script>

    <!-- JustData Analytics Event Logging -->
    <script src="/static/js/analytics-events.js"></script>

    {% include "shared_header_js.html" %}
</body>
</html>
