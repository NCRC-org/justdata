<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JustData - NCRC Data Analysis Platform</title>
    <meta name="description" content="Comprehensive data analysis platform providing insights across banking, mortgage, small business, and member management.">
    <meta name="keywords" content="JustData, NCRC, data analysis, banking, mortgage, small business, member management">
    <meta name="author" content="JustData - National Community Reinvestment Coalition">
    <meta name="theme-color" content="#552d87">
    <link rel="icon" type="image/x-icon" href="/static/favicon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon-16x16.png">
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* ProPublica-Inspired Design - Clean, Professional, Minimal */
        :root {
            /* Colors - ProPublica Style */
            --color-header: #1E3D5C;           /* Navy header bar */
            --color-primary: #0077B6;          /* Primary accent - Launch buttons, links */
            --color-primary-hover: #005a8c;    /* Primary hover state */
            --color-text: #1a1a1a;             /* Main text color */
            --color-text-secondary: #666666;  /* Secondary text */
            --color-text-muted: #999999;       /* Muted text */
            --color-background: #f8f8f8;       /* Page background */
            --color-card: #ffffff;             /* Card background */
            --color-border: #e0e0e0;           /* Card borders */
            --color-locked-bg: #f5f5f5;        /* Locked card background */

            /* Legacy variables for compatibility */
            --ncrc-primary-blue: #0077B6;
            --ncrc-secondary-blue: #005a8c;
            --ncrc-dark-blue: #1E3D5C;
            --ncrc-light-blue: #E6F2FF;
            --ncrc-gold: #ffc23a;
            --ncrc-gray: #666666;
            --ncrc-white: #FFFFFF;
            --ncrc-black: #000000;
            --ncrc-gray-light: #f8f8f8;
            --ncrc-gray-dark: #1a1a1a;

            /* Typography */
            --font-serif: Georgia, "Times New Roman", serif;
            --font-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;

            /* Spacing */
            --spacing-xs: 8px;
            --spacing-sm: 12px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 48px;

            /* Border radius */
            --radius-sm: 4px;

            /* Shadows */
            --shadow-card-hover: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-sans);
            background: var(--color-background);
            min-height: 100vh;
            color: var(--color-text);
            line-height: 1.6;
            margin: 0;
            padding-top: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--spacing-lg);
        }

        .content-wrapper {
            width: 100%;
        }

        /* Header - Simplified ProPublica Style */
        .header {
            background: var(--color-header);
            padding: 0 var(--spacing-lg);
            color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
        }

        .header-layout {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 64px;
            width: 100%;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            text-decoration: none;
            color: white;
        }

        .logo:hover {
            opacity: 0.9;
        }

        /* Logo text styling */
        .logo-text {
            font-family: var(--font-serif);
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            letter-spacing: -0.5px;
        }

        .logo img {
            height: 40px;
            width: auto;
        }

        /* User Avatar Dropdown */
        .user-avatar-dropdown {
            position: relative;
        }

        .user-avatar-btn {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-sm);
            transition: background 0.2s ease;
        }

        .user-avatar-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--color-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
        }

        .user-dropdown-menu {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: white;
            border-radius: var(--radius-sm);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            min-width: 200px;
            padding: var(--spacing-xs) 0;
            display: none;
            z-index: 1000;
        }

        .user-dropdown-menu.active {
            display: block;
        }

        .user-dropdown-header {
            padding: var(--spacing-sm) var(--spacing-md);
            border-bottom: 1px solid var(--color-border);
        }

        .user-dropdown-name {
            font-weight: 600;
            color: var(--color-text);
            font-size: 14px;
        }

        .user-dropdown-email {
            font-size: 12px;
            color: var(--color-text-muted);
        }

        .user-dropdown-role {
            font-size: 11px;
            color: var(--color-primary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 4px;
        }

        .user-dropdown-item {
            display: block;
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md);
            background: none;
            border: none;
            text-align: left;
            color: var(--color-text);
            font-size: 14px;
            cursor: pointer;
            text-decoration: none;
            transition: background 0.2s ease;
        }

        .user-dropdown-item:hover {
            background: var(--color-background);
        }

        .user-dropdown-item i {
            width: 20px;
            margin-right: var(--spacing-xs);
            color: var(--color-text-secondary);
        }

        /* Welcome Section */
        .welcome-section {
            padding: var(--spacing-xl) 0 var(--spacing-lg);
        }

        .welcome-greeting {
            font-family: var(--font-serif);
            font-size: 24px;
            font-weight: 400;
            color: var(--color-text);
            margin: 0 0 var(--spacing-xs) 0;
        }

        .welcome-subtext {
            font-size: 14px;
            color: var(--color-text-secondary);
            margin: 0;
        }

        /* Platform Stats Bar */
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--spacing-lg);
            padding: var(--spacing-lg) 0;
            margin-bottom: var(--spacing-lg);
            border-bottom: 1px solid var(--color-border);
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-family: var(--font-serif);
            font-size: 42px;
            font-weight: 700;
            color: var(--color-text);
            line-height: 1.1;
            margin-bottom: 4px;
        }

        .stat-label {
            font-family: var(--font-sans);
            font-size: 12px;
            font-weight: 600;
            color: var(--color-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        @media (max-width: 900px) {
            .stats-bar {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 500px) {
            .stats-bar {
                grid-template-columns: 1fr;
            }
            .stat-number {
                font-size: 36px;
            }
        }

        /* Main Content */
        .main-content {
            padding: 0 0 var(--spacing-xl);
        }

        /* Category Sections */
        .category-section {
            margin-bottom: var(--spacing-xl);
        }

        .category-header {
            font-size: 12px;
            font-weight: 600;
            color: var(--color-text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-xs);
            border-bottom: 2px solid var(--color-header);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .category-note {
            font-size: 11px;
            color: var(--color-text-muted);
            font-weight: normal;
            text-transform: none;
            letter-spacing: normal;
        }

        .category-subtitle {
            font-size: 14px;
            color: var(--color-text-secondary, #666);
            margin: -8px 0 var(--spacing-md) 0;
            font-weight: normal;
        }

        .apps-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--spacing-lg);
        }

        @media (max-width: 1200px) {
            .apps-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 900px) {
            .apps-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .apps-grid {
                grid-template-columns: 1fr;
            }
        }

        /* App Cards - ProPublica Style */
        .app-card {
            background: var(--color-card);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            padding: var(--spacing-lg);
            transition: box-shadow 0.2s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            min-height: 180px;
        }

        .app-card:hover {
            box-shadow: var(--shadow-card-hover);
        }

        /* App Card Title - Serif font */
        .app-card-title {
            font-family: var(--font-serif);
            font-size: 20px;
            font-weight: 700;
            color: var(--color-text);
            margin: 0 0 var(--spacing-sm) 0;
        }

        .app-card-description {
            font-size: 14px;
            color: var(--color-text-secondary);
            line-height: 1.6;
            margin: 0;
            flex-grow: 1;
        }

        .app-card-buttons {
            margin-top: var(--spacing-lg);
            display: flex;
            justify-content: flex-end;
        }

        .app-card-launch-btn {
            background: var(--color-primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-xs);
            text-decoration: none;
            transition: background 0.2s ease;
        }

        .app-card-launch-btn:hover {
            background: var(--color-primary-hover);
        }

        .app-card-launch-btn i {
            font-size: 12px;
        }

        /* Locked App Cards */
        .app-card.locked {
            background: var(--color-locked-bg);
        }

        .app-card.locked .app-card-title {
            color: var(--color-text-muted);
        }

        .app-card.locked .app-card-description {
            color: #aaaaaa;
        }

        .app-card.locked .lock-icon {
            position: absolute;
            top: var(--spacing-md);
            right: var(--spacing-md);
            color: #cccccc;
            font-size: 16px;
        }

        .app-card.locked .app-card-cta {
            background: transparent;
            color: var(--color-primary);
            border: 1px solid var(--color-primary);
            padding: 10px 20px;
            border-radius: var(--radius-sm);
            font-size: 14px;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-xs);
            transition: all 0.2s ease;
        }

        .app-card.locked .app-card-cta:hover {
            background: var(--color-primary);
            color: white;
        }

        /* Coming Soon Cards */
        .app-card.coming-soon {
            background: var(--color-locked-bg);
        }

        .app-card.coming-soon .app-card-title {
            color: var(--color-text-muted);
        }

        .app-card.coming-soon .app-card-description {
            color: #aaaaaa;
        }

        .app-card.coming-soon .app-card-launch-btn {
            background: transparent;
            color: var(--color-text-muted);
            border: 1px solid var(--color-border);
            cursor: default;
        }

        .app-card.coming-soon .app-card-launch-btn:hover {
            background: transparent;
        }

        /* Coming Soon Badge */
        .coming-soon-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: transparent;
            color: var(--color-text-muted, #999);
            border: 1px solid var(--color-border, #e0e0e0);
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
        }

        /* Legacy card header - simplified */
        .app-card-header {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .app-card-status {
            display: none;
            margin-top: 15px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
        }

        /* Page Title */
        .page-title {
            margin-bottom: var(--spacing-lg);
        }

        .page-title h2 {
            font-family: var(--font-serif);
            font-size: 24px;
            font-weight: 400;
            color: var(--color-text);
            margin: 0 0 var(--spacing-xs) 0;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .page-title h2 i {
            color: var(--color-primary);
        }

        .page-title p {
            font-size: 14px;
            color: var(--color-text-secondary);
            margin: 0;
        }

        /* Focus states for accessibility */
        .app-card:focus {
            outline: 3px solid var(--ncrc-secondary-blue);
            outline-offset: 2px;
        }

        .app-card:focus-visible {
            outline: 3px solid var(--ncrc-secondary-blue);
            outline-offset: 2px;
        }

        /* Mobile Responsive Styles */
        @media (max-width: 1024px) {
            .container {
                flex-direction: column;
                gap: 20px;
            }

            .sidebar {
                width: 100%;
                position: relative;
                top: 0;
                margin-top: 0;
                max-height: none;
            }

            .apps-grid {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: 20px;
            }
        }

        @media (max-width: 768px) {
            .header-layout {
                flex-direction: column;
                gap: 15px;
            }

            .header-title-section {
                position: relative;
                left: auto;
                transform: none;
                order: 2;
            }

            .logo {
                order: 1;
                justify-content: center;
            }

            .header-tagline {
                order: 3;
                justify-content: center;
            }

            .header-title-section h1 {
                font-size: 2rem;
            }

            .just-data-subtitle {
                font-size: 1rem;
            }

            .apps-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .app-card {
                padding: 20px;
            }

            .app-card-buttons {
                position: relative;
                bottom: auto;
                right: auto;
                margin-top: 15px;
                width: 100%;
                flex-direction: column;
                gap: 10px;
            }

            .app-card-launch-btn {
                width: 100%;
                justify-content: center;
            }

            .page-title h2 {
                font-size: 1.5rem;
            }

            .page-title p {
                font-size: 1rem;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 20px 15px;
            }

            .header-title-section h1 {
                font-size: 1.75rem;
            }

            .tagline-box {
                width: 100%;
                max-width: 256px;
            }

            .container {
                padding: 0 15px;
            }

            .app-card {
                padding: 15px;
            }

            .app-card-icon {
                width: 50px;
                height: 50px;
                font-size: 2rem;
            }

            .app-card-title {
                font-size: 1.2rem;
            }

            .app-card-description {
                font-size: 0.9rem;
            }

            .sidebar {
                padding: 15px;
            }

            .sidebar h3 {
                font-size: 1rem;
            }

            .modal-content {
                max-width: 100%;
                margin: 10px;
            }

            .modal-body {
                padding: 20px 15px;
            }

            .access-matrix-table {
                font-size: 0.75rem;
            }

            .access-matrix-table th,
            .access-matrix-table td {
                padding: 8px 5px;
            }
        }

        /* Touch device optimizations */
        @media (hover: none) and (pointer: coarse) {
            .app-card {
                cursor: pointer;
            }

            .app-card-buttons {
                position: relative;
                bottom: auto;
                right: auto;
                margin-top: 15px;
                width: 100%;
                flex-direction: column;
                gap: 10px;
            }

            .app-card-launch-btn {
                width: 100%;
                justify-content: center;
            }
        }

        .status-ready {
            background: #d4edda;
            color: #155724;
        }

        .status-dev {
            background: #fff3cd;
            color: #856404;
        }

        /* Color coding for apps */
        .app-branchsight .app-card-icon {
            background: rgba(3, 78, 160, 0.1);
            color: var(--ncrc-dark-blue);
        }

        .app-lendsight .app-card-icon {
            background: rgba(34, 139, 34, 0.1);
            color: #228b22;
        }

        .app-branchmapper .app-card-icon {
            background: rgba(255, 140, 0, 0.1);
            color: #ff8c00;
        }

        .app-dataexplorer .app-card-icon {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .app-lenderprofile .app-card-icon {
            background: rgba(85, 45, 135, 0.1);
            color: var(--ncrc-primary-blue);
        }

        .app-commentmaker .app-card-icon {
            background: rgba(232, 46, 46, 0.1);
            color: var(--ncrc-accent-red);
        }

        .app-justpolicy .app-card-icon {
            background: rgba(85, 45, 135, 0.1);
            color: var(--ncrc-primary-blue);
        }

        .app-bizsight .app-card-icon {
            background: rgba(0, 128, 128, 0.1);
            color: #008080;
        }


        .app-analytics .app-card-icon {
            background: rgba(47, 173, 227, 0.1);
            color: var(--ncrc-secondary-blue);
        }

        .app-admin .app-card-icon {
            background: rgba(232, 46, 46, 0.1);
            color: var(--ncrc-accent-red);
        }

        .app-mergermeter .app-card-icon {
            background: rgba(85, 45, 135, 0.1);
            color: var(--ncrc-primary-blue);
        }

        /* Locked App States */
        .app-card.app-locked {
            opacity: 0.9;
            position: relative;
            cursor: not-allowed;
            pointer-events: auto;
        }

        .app-card.app-locked::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.45);
            border-radius: 12px;
            z-index: 1;
            pointer-events: none;
        }

        .app-card.app-locked .lock-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2;
            text-align: center;
            color: var(--ncrc-gray);
            pointer-events: none;
        }

        .app-card.app-locked .lock-overlay i {
            font-size: 2.5rem;
            color: var(--ncrc-primary-blue);
            margin-bottom: 10px;
            display: block;
        }

        .app-card.app-locked .lock-overlay p {
            font-weight: 600;
            color: var(--ncrc-primary-blue);
            margin: 0;
            font-size: 0.95rem;
        }

        .app-card.app-locked .app-card-launch-btn {
            display: none;
        }

        .app-card.app-hidden {
            display: none !important;
        }

        /* Sidebar */
        .sidebar {
            width: 320px;
            flex-shrink: 0;
            position: sticky;
            top: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 18px;
            margin-top: 20px;
            max-height: calc(100vh - 40px);
            overflow-y: visible;
        }

        .sidebar h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--ncrc-primary-blue);
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--ncrc-light-blue);
        }

        .sidebar-features {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .sidebar .feature-card {
            background: var(--ncrc-light-blue);
            border-radius: 8px;
            padding: 10px 12px;
            border: 1px solid rgba(0, 51, 102, 0.1);
        }

        .sidebar .feature-card i {
            font-size: 1.4rem;
            color: var(--ncrc-primary-blue);
            margin-bottom: 6px;
            display: inline-block;
            margin-right: 8px;
            vertical-align: top;
        }

        .sidebar .feature-card h4 {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--ncrc-primary-blue);
            margin: 0 0 4px 0;
            display: inline-block;
            vertical-align: top;
            width: calc(100% - 40px);
        }

        .sidebar .feature-card p {
            font-size: 0.8rem;
            color: var(--ncrc-gray);
            line-height: 1.3;
            margin: 4px 0 0 0;
        }

        /* Footer - ProPublica Style */
        .footer {
            background: var(--color-header);
            color: white;
            padding: var(--spacing-lg);
            margin-top: var(--spacing-xl);
            text-align: center;
        }

        .footer-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .footer-content {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: var(--spacing-sm);
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: var(--spacing-lg);
            margin-top: var(--spacing-sm);
        }

        .footer-links a {
            color: #8bb8ff;
            text-decoration: none;
            font-size: 13px;
            transition: color 0.2s ease;
        }

        .footer-links a:hover {
            text-decoration: underline;
            color: white;
        }

        /* Legacy footer columns - hidden in new design */
        .footer-col {
            display: none;
        }

        .footer-bottom {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
            margin-top: var(--spacing-sm);
        }

        .footer-bottom em {
            color: #eb2f89;
            font-style: italic;
        }

        /* User Types Button */
        .user-types-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--ncrc-primary-blue);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px auto;
            display: block;
            box-shadow: 0 2px 8px rgba(85, 45, 135, 0.2);
        }

        .user-types-button:hover {
            background: var(--ncrc-secondary-blue);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(85, 45, 135, 0.3);
        }

        .user-types-button:focus {
            outline: 3px solid var(--ncrc-secondary-blue);
            outline-offset: 2px;
        }

        .user-types-button i {
            font-size: 0.9rem;
        }

        /* Modal Overlay */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(4px);
        }

        .modal-overlay.active {
            display: flex;
        }

        /* Modal Content - Compact centered design for app info */
        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 480px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            position: relative;
            animation: modalFadeIn 0.3s ease-out;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--color-border, #e0e0e0);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: white;
            z-index: 1;
            border-radius: 12px 12px 0 0;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.25rem;
            color: var(--color-text, #1a1a1a);
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--ncrc-gray);
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 6px;
            transition: all 0.2s ease;
            line-height: 1;
        }

        .modal-close:hover {
            background: var(--ncrc-light-blue);
            color: var(--ncrc-primary-blue);
        }

        .modal-close:focus {
            outline: 2px solid var(--ncrc-secondary-blue);
            outline-offset: 2px;
        }

        .modal-body {
            padding: 20px 24px 24px;
        }
        
        /* Wider modal for mockup displays (Analytics and Administration) */
        .modal-content.mockup-modal {
            max-width: 95vw;
            max-height: 95vh;
        }
        
        .modal-body iframe {
            width: 100%;
            min-height: 600px;
            border: none;
            border-radius: 8px;
        }
        
        @media (max-width: 768px) {
            .modal-content.mockup-modal {
                max-width: 100vw;
                max-height: 100vh;
                border-radius: 0;
            }
            
            .modal-body iframe {
                min-height: 500px;
            }
        }

        /* Access Matrix Table */
        .access-matrix-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
            margin-top: 20px;
        }

        .access-matrix-table th {
            background: var(--ncrc-primary-blue);
            color: white;
            padding: 12px 10px;
            text-align: center;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .access-matrix-table th:first-child {
            text-align: left;
            background: var(--ncrc-dark-blue);
            position: sticky;
            left: 0;
            z-index: 11;
        }

        .access-matrix-table td {
            padding: 12px 10px;
            text-align: center;
            border-bottom: 1px solid #e0e0e0;
            vertical-align: middle;
        }

        .access-matrix-table td:first-child {
            text-align: left;
            font-weight: 600;
            color: var(--ncrc-dark-blue);
            background: var(--ncrc-light-blue);
            position: sticky;
            left: 0;
            z-index: 1;
        }

        .access-matrix-table tr:hover td {
            background: #f8f9fa;
        }

        .access-matrix-table tr:hover td:first-child {
            background: var(--ncrc-light-blue);
        }

        /* Access Status Icons */
        .access-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .access-full {
            background: #d4edda;
            color: #155724;
        }

        .access-locked {
            background: #fff3cd;
            color: #856404;
        }

        .access-hidden {
            background: #f8d7da;
            color: #721c24;
        }

        .access-partial {
            background: #d1ecf1;
            color: #0c5460;
        }

        .access-icon {
            margin-right: 4px;
        }

        /* Launch Modal Feature Details */
        .feature-detail-section {
            margin-bottom: 25px;
            padding: 20px;
            background: var(--ncrc-light-blue);
            border-radius: 8px;
            border-left: 4px solid var(--ncrc-primary-blue);
        }

        .feature-detail-section h4 {
            font-size: 1.1rem;
            color: var(--ncrc-primary-blue);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .feature-detail-section h4 i {
            font-size: 1.2rem;
        }

        .feature-detail-section p {
            margin: 8px 0;
            color: var(--ncrc-gray-dark);
            line-height: 1.6;
        }

        .feature-detail-section .feature-note {
            font-size: 0.9rem;
            color: var(--ncrc-gray);
            font-style: italic;
            margin-top: 8px;
        }

        .export-formats-list {
            list-style: none;
            padding: 0;
            margin: 12px 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }

        .export-formats-list li {
            padding: 10px 15px;
            background: white;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            color: var(--ncrc-dark-blue);
        }

        .export-formats-list li i {
            color: var(--ncrc-primary-blue);
        }

        .upgrade-notice {
            margin-top: 25px;
            padding: 20px;
            background: #fff3cd;
            border-radius: 8px;
            border-left: 4px solid var(--ncrc-gold);
        }

        .upgrade-notice h4 {
            font-size: 1rem;
            color: #856404;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .upgrade-notice p {
            margin: 8px 0;
            color: #856404;
        }

        .upgrade-notice ul {
            margin: 10px 0 0 20px;
            color: #856404;
        }

        .upgrade-notice ul li {
            margin: 5px 0;
        }

        /* Page Title */
        .page-title {
            text-align: center;
            margin: 40px 0 30px;
        }

        .page-title h2 {
            font-size: 2rem;
            font-weight: 600;
            color: var(--ncrc-primary-blue);
            margin-bottom: 10px;
        }

        .page-title p {
            font-size: 1.1rem;
            color: var(--ncrc-gray);
        }

        /* Skip to main content link for screen readers */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--ncrc-primary-blue);
            color: white;
            padding: 8px 16px;
            text-decoration: none;
            z-index: 1000;
            border-radius: 0 0 4px 0;
        }

        .skip-link:focus {
            top: 0;
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            .app-card {
                border: 2px solid var(--ncrc-gray-dark);
            }

            .app-card:hover {
                border-color: var(--ncrc-primary-blue);
            }
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }

            .app-card:hover {
                transform: none;
            }
        }

        /* Slack Support Button */
        .support-bar {
            position: relative;
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--spacing-xs) var(--spacing-lg);
        }

        .slack-support-btn {
            position: absolute;
            right: var(--spacing-lg);
            top: var(--spacing-xs);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: #4A154B;
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            padding: 8px 16px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
            transition: background 0.2s ease, transform 0.2s ease;
            z-index: 100;
        }

        .slack-support-btn:hover {
            background: #611f69;
            transform: translateY(-1px);
        }

        .slack-support-btn i {
            font-size: 16px;
        }

        @media (max-width: 600px) {
            .slack-support-btn {
                padding: 6px 12px;
                font-size: 12px;
            }

            .slack-support-btn span {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Skip to main content link -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <!-- Header -->
    <header class="header" style="padding: 10px 20px;">
        <div class="header-content">
            <div class="header-layout" style="display: flex; justify-content: space-between; align-items: center;">
                <!-- Left side: Hamburger Menu + Logo -->
                <div style="display: flex; align-items: center; gap: 12px;">
                    <!-- Hamburger Menu (moved to left) -->
                    <button class="hamburger-menu" onclick="toggleNavMenu()" aria-label="Toggle navigation menu" style="background: none; border: none; cursor: pointer; padding: 8px; display: flex; flex-direction: column; gap: 5px;">
                        <span style="display: block; width: 24px; height: 3px; background: white; border-radius: 1px;"></span>
                        <span style="display: block; width: 24px; height: 3px; background: white; border-radius: 1px;"></span>
                        <span style="display: block; width: 24px; height: 3px; background: white; border-radius: 1px;"></span>
                    </button>
                    <!-- Logo -->
                    <a href="/" class="logo" style="display: flex; align-items: center; text-decoration: none;">
                        <img src="/static/img/justdata-logo-white.png" alt="JustData" style="height: 48px; width: auto;">
                    </a>
                </div>

                <!-- Hidden user type selector -->
                <select id="userTypeSelect" onchange="switchUserType(this.value)" style="display: none;">
                    <option value="public_anonymous">Guest</option>
                    <option value="public_registered">Registered</option>
                    <option value="member">Member</option>
                    <option value="member_premium">Member Premium</option>
                    <option value="non_member_org">Institutional</option>
                    <option value="staff">Staff</option>
                    <option value="senior_executive">Senior Executive</option>
                    <option value="admin">Admin</option>
                </select>
                <!-- Right side: Auth -->
                <div style="display: flex; align-items: center; min-width: 280px; justify-content: flex-end; gap: 12px;">
                    <!-- User Info (shown when logged in) -->
                    <div id="userInfo" style="display: none; align-items: center; gap: 8px;">
                        <img id="userAvatar" src="" alt="User" style="width: 32px; height: 32px; border-radius: 50%; display: none;">
                        <div style="display: flex; flex-direction: column; align-items: flex-start;">
                            <span id="userEmail" style="color: white; font-size: 13px; max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"></span>
                            <span id="userTypeBadge" style="color: #90EE90; font-size: 10px; text-transform: uppercase; font-weight: 600;"></span>
                        </div>
                    </div>

                    <!-- Login Button -->
                    <button id="loginBtn" onclick="openLoginModal()" style="display: inline-flex; align-items: center; gap: 6px; background: white; color: var(--ncrc-dark-blue); border: none; border-radius: 6px; padding: 8px 14px; font-size: 13px; font-weight: 500; cursor: pointer; transition: background 0.2s;">
                        <i class="fas fa-sign-in-alt" style="font-size: 14px;"></i>
                        <span>Sign In</span>
                    </button>

                    <!-- Logout Button -->
                    <button id="logoutBtn" onclick="JustDataAuth.signOut()" style="display: none; align-items: center; gap: 6px; background: rgba(255,255,255,0.15); color: white; border: 1px solid rgba(255,255,255,0.3); border-radius: 6px; padding: 8px 14px; font-size: 13px; font-weight: 500; cursor: pointer; transition: background 0.2s;">
                        <i class="fas fa-sign-out-alt" style="font-size: 14px;"></i>
                        <span>Sign Out</span>
                    </button>
                </div>
            </div>
            <!-- Dropdown Nav Menu -->
            <nav id="navMenu" class="nav-menu" style="display: none; position: absolute; top: 100%; left: 0; background: white; box-shadow: 0 4px 12px rgba(0,0,0,0.15); border-radius: 0 0 8px 8px; min-width: 220px; z-index: 1000;">
                <a href="/" class="nav-item" data-app="home" style="display: block; padding: 12px 20px; color: #333; text-decoration: none; border-bottom: 1px solid #eee;"><i class="fas fa-home" style="margin-right: 10px; color: var(--ncrc-dark-blue);"></i>Home</a>
                <a href="/lendsight" class="nav-item" data-app="lendsight" style="display: block; padding: 12px 20px; color: #333; text-decoration: none; border-bottom: 1px solid #eee;"><i class="fas fa-chart-line" style="margin-right: 10px; color: #2563eb;"></i>LendSight</a>
                <a href="/bizsight" class="nav-item" data-app="bizsight" style="display: block; padding: 12px 20px; color: #333; text-decoration: none; border-bottom: 1px solid #eee;"><i class="fas fa-briefcase" style="margin-right: 10px; color: #059669;"></i>BizSight</a>
                <a href="/branchsight" class="nav-item" data-app="branchsight" style="display: block; padding: 12px 20px; color: #333; text-decoration: none; border-bottom: 1px solid #eee;"><i class="fas fa-building" style="margin-right: 10px; color: #7c3aed;"></i>BranchSight</a>
                <a href="/branchmapper" class="nav-item" data-app="branchmapper" style="display: block; padding: 12px 20px; color: #333; text-decoration: none; border-bottom: 1px solid #eee;"><i class="fas fa-map-marked-alt" style="margin-right: 10px; color: #0891b2;"></i>BranchMapper</a>
                <a href="/mergermeter" class="nav-item" data-app="mergermeter" style="display: block; padding: 12px 20px; color: #333; text-decoration: none; border-bottom: 1px solid #eee;"><i class="fas fa-exchange-alt" style="margin-right: 10px; color: #dc2626;"></i>MergerMeter</a>
                <a href="/dataexplorer" class="nav-item" data-app="dataexplorer" style="display: block; padding: 12px 20px; color: #333; text-decoration: none; border-bottom: 1px solid #eee;"><i class="fas fa-search" style="margin-right: 10px; color: #ca8a04;"></i>DataExplorer</a>
                <a href="/lenderprofile" class="nav-item" data-app="lenderprofile" style="display: block; padding: 12px 20px; color: #333; text-decoration: none; border-bottom: 1px solid #eee;"><i class="fas fa-university" style="margin-right: 10px; color: #be185d;"></i>LenderProfile</a>
                <a href="/analytics" class="nav-item" data-app="analytics" style="display: block; padding: 12px 20px; color: #333; text-decoration: none; border-bottom: 1px solid #eee;"><i class="fas fa-chart-pie" style="margin-right: 10px; color: #10b981;"></i>Analytics</a>
                <a href="/electwatch" class="nav-item" data-app="electwatch" style="display: block; padding: 12px 20px; color: #333; text-decoration: none; border-bottom: 1px solid #eee;"><i class="fas fa-landmark" style="margin-right: 10px; color: #4f46e5;"></i>ElectWatch</a>
                <a href="/admin/users" class="nav-item" data-app="admin" style="display: block; padding: 12px 20px; color: #333; text-decoration: none;"><i class="fas fa-cog" style="margin-right: 10px; color: #6b7280;"></i>Admin</a>
            </nav>

        </div>
    </header>

    <!-- Slack Support Button Bar -->
    <div class="support-bar">
        <a href="#" id="slackSupportBtn" class="slack-support-btn" title="Get support via Slack" onclick="openSlackSupport(event)">
            <i class="fab fa-slack"></i>
            <span>Get Support</span>
        </a>
    </div>

    <!-- Login/Register Modal -->
    <div id="loginModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 100000; justify-content: center; align-items: center;">
        <div style="background: white; border-radius: 12px; padding: 32px; width: 100%; max-width: 420px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); position: relative; max-height: 90vh; overflow-y: auto;">
            <!-- Close button -->
            <button onclick="closeLoginModal()" style="position: absolute; top: 12px; right: 12px; background: none; border: none; font-size: 24px; cursor: pointer; color: #666; line-height: 1;">&times;</button>

            <!-- Tab Selector -->
            <div id="authTabs" style="display: flex; margin-bottom: 24px; border-bottom: 2px solid #e5e7eb;">
                <button id="signInTab" onclick="switchAuthTab('signin')" style="flex: 1; padding: 12px 16px; background: none; border: none; font-size: 15px; font-weight: 600; color: #1a365d; border-bottom: 2px solid #1a365d; margin-bottom: -2px; cursor: pointer;">
                    Sign In
                </button>
                <button id="registerTab" onclick="switchAuthTab('register')" style="flex: 1; padding: 12px 16px; background: none; border: none; font-size: 15px; font-weight: 500; color: #6b7280; cursor: pointer;">
                    Create Account
                </button>
            </div>

            <!-- Sign In View -->
            <div id="signInView">
                <form id="emailLoginForm" onsubmit="handleEmailLogin(event)" style="margin-bottom: 20px;">
                    <div style="margin-bottom: 16px;">
                        <label for="loginEmail" style="display: block; margin-bottom: 6px; font-weight: 500; color: #333; font-size: 14px;">Email</label>
                        <input type="email" id="loginEmail" placeholder="Enter your email" required autocomplete="email" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 15px; box-sizing: border-box;">
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label for="loginPassword" style="display: block; margin-bottom: 6px; font-weight: 500; color: #333; font-size: 14px;">Password</label>
                        <input type="password" id="loginPassword" placeholder="Enter your password" required autocomplete="current-password" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 15px; box-sizing: border-box;">
                    </div>
                    <div id="loginError" style="display: none; background: #fee2e2; color: #dc2626; padding: 10px 12px; border-radius: 6px; margin-bottom: 16px; font-size: 14px;"></div>
                    <button type="submit" id="emailLoginBtn" style="width: 100%; padding: 12px; background: #1a365d; color: white; border: none; border-radius: 8px; font-size: 15px; font-weight: 600; cursor: pointer;">
                        <span id="emailLoginText">Sign In</span>
                        <span id="emailLoginSpinner" style="display: none;"><i class="fas fa-spinner fa-spin"></i> Signing in...</span>
                    </button>
                </form>
            </div>

            <!-- Register View -->
            <div id="registerView" style="display: none;">
                <form id="emailRegisterForm" onsubmit="handleEmailRegister(event)" style="margin-bottom: 20px;">
                    <div style="display: flex; gap: 12px; margin-bottom: 16px;">
                        <div style="flex: 1;">
                            <label for="registerFirstName" style="display: block; margin-bottom: 6px; font-weight: 500; color: #333; font-size: 14px;">First Name <span style="color: #dc2626;">*</span></label>
                            <input type="text" id="registerFirstName" placeholder="First name" required autocomplete="given-name" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 15px; box-sizing: border-box;">
                        </div>
                        <div style="flex: 1;">
                            <label for="registerLastName" style="display: block; margin-bottom: 6px; font-weight: 500; color: #333; font-size: 14px;">Last Name <span style="color: #dc2626;">*</span></label>
                            <input type="text" id="registerLastName" placeholder="Last name" required autocomplete="family-name" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 15px; box-sizing: border-box;">
                        </div>
                    </div>
                    <div style="margin-bottom: 16px;">
                        <label for="registerEmail" style="display: block; margin-bottom: 6px; font-weight: 500; color: #333; font-size: 14px;">Email <span style="color: #dc2626;">*</span></label>
                        <input type="email" id="registerEmail" placeholder="Enter your email" required autocomplete="email" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 15px; box-sizing: border-box;">
                        <p style="margin: 6px 0 0; font-size: 12px; color: #6b7280;">
                            <i class="fas fa-info-circle"></i> NCRC staff: Use your @ncrc.org email for automatic staff access after verification
                        </p>
                    </div>
                    <div style="margin-bottom: 16px;">
                        <label for="registerOrganization" style="display: block; margin-bottom: 6px; font-weight: 500; color: #333; font-size: 14px;">Organization <span style="color: #dc2626;">*</span></label>
                        <input type="text" id="registerOrganization" placeholder="Your organization or company" required autocomplete="organization" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 15px; box-sizing: border-box;">
                    </div>
                    <div style="margin-bottom: 16px;">
                        <label for="registerPassword" style="display: block; margin-bottom: 6px; font-weight: 500; color: #333; font-size: 14px;">Password <span style="color: #dc2626;">*</span></label>
                        <input type="password" id="registerPassword" placeholder="Create a password (min 6 characters)" required autocomplete="new-password" minlength="6" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 15px; box-sizing: border-box;">
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label for="registerPasswordConfirm" style="display: block; margin-bottom: 6px; font-weight: 500; color: #333; font-size: 14px;">Confirm Password</label>
                        <input type="password" id="registerPasswordConfirm" placeholder="Confirm your password" required autocomplete="new-password" minlength="6" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 15px; box-sizing: border-box;">
                    </div>
                    <div id="registerError" style="display: none; background: #fee2e2; color: #dc2626; padding: 10px 12px; border-radius: 6px; margin-bottom: 16px; font-size: 14px;"></div>
                    <div id="registerSuccess" style="display: none; background: #dcfce7; color: #166534; padding: 10px 12px; border-radius: 6px; margin-bottom: 16px; font-size: 14px;"></div>
                    <button type="submit" id="emailRegisterBtn" style="width: 100%; padding: 12px; background: #1a365d; color: white; border: none; border-radius: 8px; font-size: 15px; font-weight: 600; cursor: pointer;">
                        <span id="emailRegisterText">Create Account</span>
                        <span id="emailRegisterSpinner" style="display: none;"><i class="fas fa-spinner fa-spin"></i> Creating account...</span>
                    </button>
                </form>
            </div>

            <!-- Divider -->
            <div style="display: flex; align-items: center; margin: 24px 0;">
                <div style="flex: 1; height: 1px; background: #ddd;"></div>
                <span style="padding: 0 16px; color: #999; font-size: 13px; font-weight: 500;">OR</span>
                <div style="flex: 1; height: 1px; background: #ddd;"></div>
            </div>

            <!-- Google Sign In -->
            <button onclick="handleGoogleLogin()" id="googleLoginBtn" style="width: 100%; padding: 12px; background: white; color: #333; border: 1px solid #ddd; border-radius: 8px; font-size: 15px; font-weight: 500; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;">
                <svg width="18" height="18" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/></svg>
                <span id="googleLoginText">Continue with Google</span>
                <span id="googleLoginSpinner" style="display: none;"><i class="fas fa-spinner fa-spin"></i></span>
            </button>

            <!-- Footer note -->
            <p style="margin: 20px 0 0; text-align: center; color: #999; font-size: 12px;">
                By signing in, you agree to NCRC's Terms of Service
            </p>
        </div>
    </div>

    <!-- Email Verification Banner -->
    <div id="emailVerificationBanner" style="display: none; background: linear-gradient(90deg, #fef3c7 0%, #fde68a 100%); border-bottom: 1px solid #f59e0b; padding: 12px 20px; position: fixed; top: 0; left: 0; right: 0; z-index: 99999;">
        <div style="max-width: 1400px; margin: 0 auto; display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
            <i class="fas fa-envelope" style="color: #d97706; font-size: 1.1rem;"></i>
            <span style="flex: 1; color: #92400e; font-size: 14px;">
                <strong>Verify your email</strong> to get full staff access. Check your inbox for a verification link.
            </span>
            <button onclick="resendVerificationEmail()" id="resendVerificationBtn" style="background: #d97706; color: white; border: none; padding: 8px 16px; border-radius: 6px; font-size: 13px; font-weight: 500; cursor: pointer;">
                <span id="resendVerificationText">Resend Email</span>
                <span id="resendVerificationSpinner" style="display: none;"><i class="fas fa-spinner fa-spin"></i></span>
            </button>
            <button onclick="checkEmailVerified()" style="background: white; color: #d97706; border: 1px solid #d97706; padding: 8px 16px; border-radius: 6px; font-size: 13px; font-weight: 500; cursor: pointer;">
                I've Verified
            </button>
            <button onclick="dismissVerificationBanner()" style="background: none; border: none; color: #92400e; font-size: 1.25rem; cursor: pointer; padding: 0 5px;" title="Dismiss">&times;</button>
        </div>
    </div>

    <div class="container">
        <div class="content-wrapper">
            <!-- Welcome Section -->
            <section class="welcome-section">
                <h1 class="welcome-greeting" id="welcomeGreeting">Welcome back</h1>
                <p class="welcome-subtext">Access your research and analysis tools below.</p>
            </section>

            <!-- Platform Stats Bar -->
            <section class="stats-bar" id="platformStats">
                <div class="stat-item">
                    <div class="stat-number" id="mortgageRecords">--</div>
                    <div class="stat-label">Mortgage Records Analyzed</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="lendersTracked">--</div>
                    <div class="stat-label">Lenders Tracked</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="reportsGenerated">--</div>
                    <div class="stat-label">Reports Generated</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="activeResearchers">--</div>
                    <div class="stat-label">Active Researchers</div>
                </div>
            </section>

            <main class="main-content" id="main-content" role="main">
                <!-- REPORTS Section - AI-powered reports for novices -->
                <section class="category-section" id="reportsSection">
                    <h2 class="category-header">Reports</h2>
                    <p class="category-subtitle">AI-powered reports with plain-language analysis. No data expertise required.</p>
                    <div class="apps-grid">
                        <!-- LendSight Card -->
                        <div class="app-card" data-app="lendsight" onclick="handleInfoClick('LendSight')">
                            <h3 class="app-card-title">LendSight</h3>
                            <p class="app-card-description">
                                Mortgage lending analysis with AI-generated narratives identifying disparities and compliance concerns.
                            </p>
                            <div class="app-card-buttons">
                                <a href="/lendsight" class="app-card-launch-btn" onclick="event.stopPropagation()">
                                    Launch <i class="fas fa-arrow-right"></i>
                                </a>
                            </div>
                        </div>

                        <!-- BizSight Card -->
                        <div class="app-card" data-app="bizsight" onclick="handleInfoClick('BizSight')">
                            <h3 class="app-card-title">BizSight</h3>
                            <p class="app-card-description">
                                Small business lending patterns using CRA data with AI-powered gap analysis.
                            </p>
                            <div class="app-card-buttons">
                                <a href="/bizsight" class="app-card-launch-btn" onclick="event.stopPropagation()">
                                    Launch <i class="fas fa-arrow-right"></i>
                                </a>
                            </div>
                        </div>

                        <!-- BranchSight Card -->
                        <div class="app-card" data-app="branchsight" onclick="handleInfoClick('BranchSight')">
                            <h3 class="app-card-title">BranchSight</h3>
                            <p class="app-card-description">
                                Bank branch network analysis tracking openings, closings, and market concentration.
                            </p>
                            <div class="app-card-buttons">
                                <a href="/branchsight" class="app-card-launch-btn" onclick="event.stopPropagation()">
                                    Launch <i class="fas fa-arrow-right"></i>
                                </a>
                            </div>
                        </div>

                        <!-- CommentMaker Card - Coming Soon (far right) -->
                        <div class="app-card coming-soon" data-app="commentmaker" onclick="handleInfoClick('CommentMaker')">
                            <h3 class="app-card-title">CommentMaker</h3>
                            <p class="app-card-description">
                                Generate public comments for federal rulemakings with AI assistance.
                            </p>
                            <div class="app-card-buttons">
                                <span class="coming-soon-badge"><i class="fas fa-clock"></i> Coming Soon</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- DATA TOOLS Section - For researchers and analysts -->
                <section class="category-section" id="dataToolsSection">
                    <h2 class="category-header">Data Tools</h2>
                    <p class="category-subtitle">Interactive dashboards and query tools for researchers and analysts.</p>
                    <div class="apps-grid">
                        <!-- DataExplorer Card -->
                        <div class="app-card" data-app="dataexplorer" onclick="handleInfoClick('DataExplorer')">
                            <h3 class="app-card-title">DataExplorer</h3>
                            <p class="app-card-description">
                                Query the full HMDA dataset with custom filters. Export raw data for your own analysis.
                            </p>
                            <div class="app-card-buttons">
                                <a href="/dataexplorer" class="app-card-launch-btn" onclick="event.stopPropagation()">
                                    Launch <i class="fas fa-arrow-right"></i>
                                </a>
                            </div>
                        </div>

                        <!-- BranchMapper Card -->
                        <div class="app-card" data-app="branchmapper" onclick="handleInfoClick('BranchMapper')">
                            <h3 class="app-card-title">BranchMapper</h3>
                            <p class="app-card-description">
                                Interactive map of branch locations with demographic overlays and filters.
                            </p>
                            <div class="app-card-buttons">
                                <a href="/branchmapper" class="app-card-launch-btn" onclick="event.stopPropagation()">
                                    Launch <i class="fas fa-arrow-right"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- INTERNAL TOOLS Section - Staff & above -->
                <section class="category-section" id="internalToolsSection" style="display: none;">
                    <h2 class="category-header">Internal Tools <span class="category-note">Staff & above</span></h2>
                    <p class="category-subtitle">Advanced analysis tools for NCRC staff research and advocacy.</p>
                    <div class="apps-grid">
                        <!-- MergerMeter Card (Active - first) -->
                        <div class="app-card" data-app="mergermeter" onclick="handleInfoClick('MergerMeter')">
                            <h3 class="app-card-title">MergerMeter</h3>
                            <p class="app-card-description">
                                Bank merger impact analysis with CBA goal recommendations and peer comparisons.
                            </p>
                            <div class="app-card-buttons">
                                <a href="/mergermeter" class="app-card-launch-btn" onclick="event.stopPropagation()">
                                    Launch <i class="fas fa-arrow-right"></i>
                                </a>
                            </div>
                        </div>

                        <!-- ElectWatch Card - Coming Soon -->
                        <div class="app-card coming-soon" data-app="electwatch" onclick="handleInfoClick('ElectWatch')">
                            <h3 class="app-card-title">ElectWatch</h3>
                            <p class="app-card-description">
                                Track campaign contributions from financial institutions to Congress.
                            </p>
                            <div class="app-card-buttons">
                                <span class="coming-soon-badge"><i class="fas fa-clock"></i> Coming Soon</span>
                            </div>
                        </div>

                        <!-- LenderProfile Card - Coming Soon -->
                        <div class="app-card coming-soon" data-app="lenderprofile" onclick="handleInfoClick('LenderProfile')">
                            <h3 class="app-card-title">LenderProfile</h3>
                            <p class="app-card-description">
                                Comprehensive lender intelligence combining corporate structure and CRA ratings.
                            </p>
                            <div class="app-card-buttons">
                                <span class="coming-soon-badge"><i class="fas fa-clock"></i> Coming Soon</span>
                            </div>
                        </div>

                        <!-- Redlining Dashboard Card - Coming Soon -->
                        <div class="app-card coming-soon" data-app="redlining" id="redliningCard" onclick="handleInfoClick('Redlining Dashboard')">
                            <h3 class="app-card-title">Redlining Dashboard</h3>
                            <p class="app-card-description">
                                Compare bank lending in minority tracts against peer institutions.
                            </p>
                            <div class="app-card-buttons">
                                <span class="coming-soon-badge"><i class="fas fa-clock"></i> Coming Soon</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- ADMIN Section - Senior Executive & above -->
                <section class="category-section" id="adminSection" style="display: none;">
                    <h2 class="category-header">Admin <span class="category-note">Senior Executive & above</span></h2>
                    <p class="category-subtitle">Platform monitoring and user management tools.</p>
                    <div class="apps-grid">
                        <!-- Analytics Card -->
                        <div class="app-card" data-app="analytics" onclick="handleInfoClick('Analytics')">
                            <h3 class="app-card-title">Analytics</h3>
                            <p class="app-card-description">
                                Monitor platform usage, report generation, and feature adoption.
                            </p>
                            <div class="app-card-buttons">
                                <a href="/analytics" class="app-card-launch-btn" onclick="event.stopPropagation()">
                                    Launch <i class="fas fa-arrow-right"></i>
                                </a>
                            </div>
                        </div>

                        <!-- Administration Card -->
                        <div class="app-card" data-app="admin" id="administrationCard" onclick="window.location.href='/admin/users'">
                            <h3 class="app-card-title">Administration</h3>
                            <p class="app-card-description">
                                Manage user accounts, permissions, and system integrations.
                            </p>
                            <div class="app-card-buttons">
                                <a href="/admin/users" class="app-card-launch-btn" onclick="event.stopPropagation()">
                                    Launch <i class="fas fa-arrow-right"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container" style="display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto; padding: 24px;">
            <!-- Left side: Copyright and links -->
            <div style="text-align: left;">
                <p style="margin: 0 0 8px 0; font-size: 13px; color: rgba(255,255,255,0.9);">&copy; 2026 National Community Reinvestment Coalition</p>
                <p style="margin: 0 0 8px 0; font-size: 11px; color: rgba(255,255,255,0.6);">JustData Platform v{{ platform_version }}</p>
                <div style="display: flex; gap: 16px; font-size: 13px;">
                    <a href="mailto:research@ncrc.org" style="color: #8bb8ff; text-decoration: none;">research@ncrc.org</a>
                    <span style="color: rgba(255,255,255,0.5);">|</span>
                    <a href="tel:+12024644600" style="color: #8bb8ff; text-decoration: none;">(202) 464-4600</a>
                    <span style="color: rgba(255,255,255,0.5);">|</span>
                    <a href="/privacy" style="color: #8bb8ff; text-decoration: none;">Privacy</a>
                    <span style="color: rgba(255,255,255,0.5);">|</span>
                    <a href="/terms" style="color: #8bb8ff; text-decoration: none;">Terms</a>
                </div>
                <p style="margin: 12px 0 0 0; font-size: 11px; color: rgba(255,255,255,0.6);">
                    Created by Jay Richardson &amp; Jad Edlebi
                </p>
            </div>
            <!-- Right side: NCRC Logo -->
            <div style="flex-shrink: 0;">
                <img src="/static/img/ncrc-logo-white.png" alt="NCRC" style="height: 50px; width: auto; opacity: 0.9;">
            </div>
        </div>
    </footer>

    <!-- Launch Modal -->
    <div class="modal-overlay" id="launchModal" role="dialog" aria-labelledby="launchModalTitle" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="launchModalTitle">
                    <i class="fas fa-rocket" aria-hidden="true"></i>
                    <span id="launchAppName">Application Features</span>
                </h3>
                <button class="modal-close" onclick="closeLaunchModal()" aria-label="Close launch modal">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div class="modal-body" id="launchModalBody">
                <!-- Content populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- App Info Modal -->
    <div class="modal-overlay" id="appInfoModal" role="dialog" aria-labelledby="appInfoModalTitle" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="appInfoModalTitle">
                    <i class="fas fa-info-circle" aria-hidden="true"></i>
                    <span id="appInfoName">Application Information</span>
                </h3>
                <button class="modal-close" onclick="closeAppInfoModal()" aria-label="Close app info modal">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div class="modal-body" id="appInfoModalBody">
                <!-- Content populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Toggle hamburger navigation menu
        function toggleNavMenu() {
            const menu = document.getElementById('navMenu');
            if (menu.style.display === 'none' || menu.style.display === '') {
                menu.style.display = 'block';
            } else {
                menu.style.display = 'none';
            }
        }
        
        // Close menu when clicking outside
        document.addEventListener('click', function(event) {
            const menu = document.getElementById('navMenu');
            const hamburger = document.querySelector('.hamburger-menu');
            if (menu && hamburger && !menu.contains(event.target) && !hamburger.contains(event.target)) {
                menu.style.display = 'none';
            }
        });

        // Slack Support Button
        function openSlackSupport(event) {
            event.preventDefault();
            const currentUserType = document.getElementById('userTypeSelect').value;
            const isInternalUser = ['staff', 'senior_executive', 'admin'].includes(currentUserType);

            // Staff channel for internal users, public support channel for everyone else
            const slackChannelUrl = isInternalUser
                ? 'https://ncrcgroup.slack.com/app_redirect?channel=C0A0BBWRT36'  // justdata_staff
                : 'https://ncrcgroup.slack.com/app_redirect?channel=C0AAHCK98A0'; // public support

            window.open(slackChannelUrl, '_blank');
        }

        // Login Modal Functions
        function openLoginModal(tab = 'signin') {
            document.getElementById('loginModal').style.display = 'flex';
            switchAuthTab(tab);
            if (tab === 'signin') {
                document.getElementById('loginEmail').focus();
            } else {
                document.getElementById('registerName').focus();
            }
            // Clear errors
            document.getElementById('loginError').style.display = 'none';
            const registerError = document.getElementById('registerError');
            const registerSuccess = document.getElementById('registerSuccess');
            if (registerError) registerError.style.display = 'none';
            if (registerSuccess) registerSuccess.style.display = 'none';
        }

        function closeLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
            // Reset forms
            document.getElementById('loginEmail').value = '';
            document.getElementById('loginPassword').value = '';
            const registerFirstName = document.getElementById('registerFirstName');
            const registerLastName = document.getElementById('registerLastName');
            const registerEmail = document.getElementById('registerEmail');
            const registerOrganization = document.getElementById('registerOrganization');
            const registerPassword = document.getElementById('registerPassword');
            const registerPasswordConfirm = document.getElementById('registerPasswordConfirm');
            if (registerFirstName) registerFirstName.value = '';
            if (registerLastName) registerLastName.value = '';
            if (registerEmail) registerEmail.value = '';
            if (registerOrganization) registerOrganization.value = '';
            if (registerPassword) registerPassword.value = '';
            if (registerPasswordConfirm) registerPasswordConfirm.value = '';
        }

        function switchAuthTab(tab) {
            const signInTab = document.getElementById('signInTab');
            const registerTab = document.getElementById('registerTab');
            const signInView = document.getElementById('signInView');
            const registerView = document.getElementById('registerView');

            if (tab === 'signin') {
                signInTab.style.color = '#1a365d';
                signInTab.style.fontWeight = '600';
                signInTab.style.borderBottom = '2px solid #1a365d';
                registerTab.style.color = '#6b7280';
                registerTab.style.fontWeight = '500';
                registerTab.style.borderBottom = 'none';
                signInView.style.display = 'block';
                registerView.style.display = 'none';
            } else {
                registerTab.style.color = '#1a365d';
                registerTab.style.fontWeight = '600';
                registerTab.style.borderBottom = '2px solid #1a365d';
                signInTab.style.color = '#6b7280';
                signInTab.style.fontWeight = '500';
                signInTab.style.borderBottom = 'none';
                registerView.style.display = 'block';
                signInView.style.display = 'none';
            }
        }

        // Close modal on background click
        document.getElementById('loginModal')?.addEventListener('click', function(e) {
            if (e.target === this) closeLoginModal();
        });

        // Close modal on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && document.getElementById('loginModal').style.display === 'flex') {
                closeLoginModal();
            }
        });

        // Handle email/password login
        async function handleEmailLogin(event) {
            event.preventDefault();

            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');
            const loginText = document.getElementById('emailLoginText');
            const loginSpinner = document.getElementById('emailLoginSpinner');
            const loginBtn = document.getElementById('emailLoginBtn');

            // Show loading state
            loginText.style.display = 'none';
            loginSpinner.style.display = 'inline';
            loginBtn.disabled = true;
            errorDiv.style.display = 'none';

            try {
                await JustDataAuth.signInWithEmail(email, password);
                closeLoginModal();
                // Page will update via auth state change handler
            } catch (error) {
                console.error('Email login error:', error);

                // Show user-friendly error messages
                let errorMessage = 'Sign in failed. Please try again.';
                switch (error.code) {
                    case 'auth/user-not-found':
                        errorMessage = 'No account found with this email address.';
                        break;
                    case 'auth/wrong-password':
                        errorMessage = 'Incorrect password. Please try again.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Please enter a valid email address.';
                        break;
                    case 'auth/user-disabled':
                        errorMessage = 'This account has been disabled. Contact support.';
                        break;
                    case 'auth/too-many-requests':
                        errorMessage = 'Too many failed attempts. Please try again later.';
                        break;
                    case 'auth/invalid-credential':
                        errorMessage = 'Invalid email or password. Please check and try again.';
                        break;
                }

                errorDiv.textContent = errorMessage;
                errorDiv.style.display = 'block';
            } finally {
                // Reset loading state
                loginText.style.display = 'inline';
                loginSpinner.style.display = 'none';
                loginBtn.disabled = false;
            }
        }

        // Handle Google login from modal
        async function handleGoogleLogin() {
            const loginText = document.getElementById('googleLoginText');
            const loginSpinner = document.getElementById('googleLoginSpinner');
            const loginBtn = document.getElementById('googleLoginBtn');
            const errorDiv = document.getElementById('loginError');

            // Show loading state
            loginText.style.display = 'none';
            loginSpinner.style.display = 'inline';
            loginBtn.disabled = true;
            errorDiv.style.display = 'none';

            try {
                await JustDataAuth.signInWithGoogle();
                closeLoginModal();
            } catch (error) {
                // Only show error if it wasn't user-cancelled
                if (error.code !== 'auth/popup-closed-by-user' && error.code !== 'auth/cancelled-popup-request') {
                    errorDiv.textContent = 'Google sign-in failed. Please try again.';
                    errorDiv.style.display = 'block';
                }
            } finally {
                // Reset loading state
                loginText.style.display = 'inline';
                loginSpinner.style.display = 'none';
                loginBtn.disabled = false;
            }
        }

        // Handle email/password registration
        async function handleEmailRegister(event) {
            event.preventDefault();
            const firstName = document.getElementById('registerFirstName').value.trim();
            const lastName = document.getElementById('registerLastName').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const organization = document.getElementById('registerOrganization').value.trim();
            const password = document.getElementById('registerPassword').value;
            const passwordConfirm = document.getElementById('registerPasswordConfirm').value;
            const errorDiv = document.getElementById('registerError');
            const successDiv = document.getElementById('registerSuccess');
            const registerText = document.getElementById('emailRegisterText');
            const registerSpinner = document.getElementById('emailRegisterSpinner');
            const registerBtn = document.getElementById('emailRegisterBtn');

            // Validate passwords match
            if (password !== passwordConfirm) {
                errorDiv.textContent = 'Passwords do not match.';
                errorDiv.style.display = 'block';
                successDiv.style.display = 'none';
                return;
            }

            registerText.style.display = 'none';
            registerSpinner.style.display = 'inline';
            registerBtn.disabled = true;
            errorDiv.style.display = 'none';
            successDiv.style.display = 'none';

            try {
                await JustDataAuth.signUpWithEmail(email, password, firstName, lastName, organization);

                // Show success message
                const isNcrcEmail = email.toLowerCase().endsWith('@ncrc.org');
                if (isNcrcEmail) {
                    successDiv.innerHTML = '<i class="fas fa-check-circle"></i> Account created! Check your email for a verification link to activate your staff access.';
                } else {
                    successDiv.innerHTML = '<i class="fas fa-check-circle"></i> Account created! Check your email to verify your account.';
                }
                successDiv.style.display = 'block';

                // Close modal after delay and show verification banner if needed
                setTimeout(() => {
                    closeLoginModal();
                    if (isNcrcEmail) {
                        showVerificationBanner();
                    }
                }, 2000);

            } catch (error) {
                console.error('Registration error:', error);
                let errorMessage = 'Registration failed. Please try again.';
                switch (error.code) {
                    case 'auth/email-already-in-use':
                        errorMessage = 'An account with this email already exists. Try signing in instead.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Please enter a valid email address.';
                        break;
                    case 'auth/weak-password':
                        errorMessage = 'Password is too weak. Please use at least 6 characters.';
                        break;
                    case 'auth/operation-not-allowed':
                        errorMessage = 'Email/password registration is not enabled. Please contact support.';
                        break;
                }
                errorDiv.textContent = errorMessage;
                errorDiv.style.display = 'block';
            } finally {
                registerText.style.display = 'inline';
                registerSpinner.style.display = 'none';
                registerBtn.disabled = false;
            }
        }

        // Email Verification Banner Functions
        function showVerificationBanner() {
            const banner = document.getElementById('emailVerificationBanner');
            if (banner && !sessionStorage.getItem('verificationBannerDismissed')) {
                banner.style.display = 'block';
            }
        }

        function dismissVerificationBanner() {
            const banner = document.getElementById('emailVerificationBanner');
            if (banner) {
                banner.style.display = 'none';
                sessionStorage.setItem('verificationBannerDismissed', 'true');
            }
        }

        async function resendVerificationEmail() {
            const btn = document.getElementById('resendVerificationBtn');
            const text = document.getElementById('resendVerificationText');
            const spinner = document.getElementById('resendVerificationSpinner');

            text.style.display = 'none';
            spinner.style.display = 'inline';
            btn.disabled = true;

            try {
                const result = await JustDataAuth.sendVerificationEmail();
                if (result.alreadyVerified) {
                    alert('Your email is already verified! Refreshing your access...');
                    await checkEmailVerified();
                } else {
                    alert('Verification email sent! Please check your inbox.');
                }
            } catch (error) {
                console.error('Error sending verification email:', error);
                if (error.code === 'auth/too-many-requests') {
                    alert('Too many requests. Please wait a few minutes before trying again.');
                } else {
                    alert('Failed to send verification email. Please try again later.');
                }
            } finally {
                text.style.display = 'inline';
                spinner.style.display = 'none';
                btn.disabled = false;
            }
        }

        async function checkEmailVerified() {
            try {
                const result = await JustDataAuth.refreshEmailVerification();
                if (result.verified) {
                    dismissVerificationBanner();
                    alert(result.message || 'Email verified! Your access has been upgraded.');
                    window.location.reload();
                } else {
                    alert('Email not yet verified. Please click the link in the verification email.');
                }
            } catch (error) {
                console.error('Error checking verification:', error);
                alert('Could not check verification status. Please try again.');
            }
        }

        // Check if user needs to see verification banner on page load
        function checkVerificationBannerOnLoad() {
            if (typeof JustDataAuth !== 'undefined' && JustDataAuth.checkVerificationNeeded) {
                JustDataAuth.checkVerificationNeeded().then(status => {
                    if (status.needs_verification) {
                        showVerificationBanner();
                    }
                }).catch(err => console.log('Verification check skipped:', err));
            }
        }

        // Run verification check when auth is ready
        setTimeout(checkVerificationBannerOnLoad, 1500);

        // User Access Configuration (8 user types)
        // Tiers: 1=anonymous, 2=public, 3=member, 4=member_plus, 5=institutional, 6=staff, 7=senior_exec, 8=admin
        const appAccessConfig = {
            // REPORTS SECTION
            'lendsight': {  // Min tier 2 (public)
                public_anonymous: 'locked',
                public_registered: 'limited',
                member: 'full',
                member_premium: 'full',
                non_member_org: 'full',
                staff: 'full',
                senior_executive: 'full',
                admin: 'full'
            },
            'bizsight': {  // Min tier 3 (member)
                public_anonymous: 'locked',
                public_registered: 'locked',
                member: 'full',
                member_premium: 'full',
                non_member_org: 'full',
                staff: 'full',
                senior_executive: 'full',
                admin: 'full'
            },
            'branchsight': {  // Min tier 3 (member)
                public_anonymous: 'locked',
                public_registered: 'locked',
                member: 'full',
                member_premium: 'full',
                non_member_org: 'full',
                staff: 'full',
                senior_executive: 'full',
                admin: 'full'
            },
            'commentmaker': {  // Min tier 2 (public) - Coming Soon
                public_anonymous: 'full',
                public_registered: 'full',
                member: 'full',
                member_premium: 'full',
                non_member_org: 'full',
                staff: 'full',
                senior_executive: 'full',
                admin: 'full'
            },
            // DATA TOOLS SECTION
            'dataexplorer': {  // Min tier 4 (member_plus)
                public_anonymous: 'locked',
                public_registered: 'locked',
                member: 'locked',
                member_premium: 'full',
                non_member_org: 'full',
                staff: 'full',
                senior_executive: 'full',
                admin: 'full'
            },
            'branchmapper': {  // Min tier 4 (member_plus)
                public_anonymous: 'locked',
                public_registered: 'locked',
                member: 'locked',
                member_premium: 'full',
                non_member_org: 'full',
                staff: 'full',
                senior_executive: 'full',
                admin: 'full'
            },
            // INTERNAL TOOLS SECTION
            'mergermeter': {  // Min tier 6 (staff)
                public_anonymous: 'hidden',
                public_registered: 'hidden',
                member: 'hidden',
                member_premium: 'hidden',
                non_member_org: 'hidden',
                staff: 'full',
                senior_executive: 'full',
                admin: 'full'
            },
            'electwatch': {  // Min tier 6 (staff) - Coming Soon
                public_anonymous: 'hidden',
                public_registered: 'hidden',
                member: 'hidden',
                member_premium: 'hidden',
                non_member_org: 'hidden',
                staff: 'full',
                senior_executive: 'full',
                admin: 'full'
            },
            'lenderprofile': {  // Min tier 6 (staff) - Coming Soon
                public_anonymous: 'hidden',
                public_registered: 'hidden',
                member: 'hidden',
                member_premium: 'hidden',
                non_member_org: 'hidden',
                staff: 'full',
                senior_executive: 'full',
                admin: 'full'
            },
            'redlining': {  // Min tier 6 (staff) - Coming Soon
                public_anonymous: 'hidden',
                public_registered: 'hidden',
                member: 'hidden',
                member_premium: 'hidden',
                non_member_org: 'hidden',
                staff: 'full',
                senior_executive: 'full',
                admin: 'full'
            },
            // ADMIN SECTION
            'analytics': {  // Min tier 7 (senior_executive)
                public_anonymous: 'hidden',
                public_registered: 'hidden',
                member: 'hidden',
                member_premium: 'hidden',
                non_member_org: 'hidden',
                staff: 'hidden',
                senior_executive: 'full',
                admin: 'full'
            },
            'admin': {  // Min tier 8 (administrator)
                public_anonymous: 'hidden',
                public_registered: 'hidden',
                member: 'hidden',
                member_premium: 'hidden',
                non_member_org: 'hidden',
                staff: 'hidden',
                senior_executive: 'hidden',
                admin: 'full'
            }
        };

        // App URLs - Render test deployment URLs
        const appUrls = {
            'commentmaker': 'https://commentmaker.onrender.com',
            'lendsight': '/lendsight',
            'bizsight': '/bizsight',
            'branchmapper': '/branchmapper',
            'branchsight': '/branchsight',
            'dataexplorer': '/dataexplorer',
            'mergermeter': '/mergermeter',
            'lenderprofile': '/lenderprofile',
            'redlining': '/redlining'
        };

        // Feature Permissions by User Type (8 types)
        const featurePermissions = {
            'public_anonymous': {
                geographicLimit: 'none',
                canExport: false,
                exportFormats: [],
                price: 'Free (Guest)'
            },
            'public_registered': {
                geographicLimit: 'own_county_only',
                canExport: false,
                exportFormats: [],
                price: 'Free (Registered)'
            },
            'member': {
                geographicLimit: 'up_to_3_counties',
                canExport: true,
                exportFormats: ['excel', 'powerpoint', 'pdf'],
                price: 'Included with $900/yr NCRC membership'
            },
            'member_premium': {
                geographicLimit: '5_plus_counties',
                canExport: true,
                exportFormats: ['excel', 'powerpoint', 'pdf', 'csv'],
                price: '$500-750/year (add-on)'
            },
            'non_member_org': {
                geographicLimit: 'unlimited',
                canExport: true,
                exportFormats: ['excel', 'powerpoint', 'pdf', 'csv'],
                price: '$5,000-15,000/year'
            },
            'staff': {
                geographicLimit: 'unlimited',
                canExport: true,
                exportFormats: ['excel', 'powerpoint', 'pdf', 'csv', 'json'],
                price: 'Included with employment'
            },
            'senior_executive': {
                geographicLimit: 'unlimited',
                canExport: true,
                exportFormats: ['excel', 'powerpoint', 'pdf', 'csv', 'json'],
                executiveTools: true,
                price: 'N/A (internal)'
            },
            'admin': {
                geographicLimit: 'unlimited',
                canExport: true,
                exportFormats: ['excel', 'powerpoint', 'pdf', 'csv', 'json'],
                executiveTools: true,
                adminAccess: true,
                price: 'N/A (internal)'
            }
        };

        // Switch user type and update app visibility
        function switchUserType(userType) {
            // Update all app cards based on user type
            Object.keys(appAccessConfig).forEach(appKey => {
                const card = document.querySelector(`.app-card[data-app="${appKey}"]`);
                if (!card) return;

                const access = appAccessConfig[appKey][userType];
                
                // Remove all state classes
                card.classList.remove('app-locked', 'app-hidden');
                
                // Remove lock overlay if it exists
                const existingOverlay = card.querySelector('.lock-overlay');
                if (existingOverlay) {
                    existingOverlay.remove();
                }

                if (access === 'hidden' || access === undefined) {
                    // Hide the app completely
                    card.classList.add('app-hidden');
                    card.style.display = 'none';
                    card.style.visibility = 'hidden';
                    return; // Exit early for hidden cards
                } else if (access === 'locked') {
                    // Show but lock the app
                    card.classList.add('app-locked');
                    card.style.display = 'block';
                    card.style.visibility = 'visible';
                    
                    // Add lock overlay
                    const lockOverlay = document.createElement('div');
                    lockOverlay.className = 'lock-overlay';
                    let lockMessage = 'NCRC organizational members only';
                    if (appKey === 'lendsight') {
                        lockMessage = 'Free registration required';
                    } else if (appKey === 'dataexplorer') {
                        lockMessage = 'Member Plus or Institutional tier required';
                    }
                    lockOverlay.innerHTML = `
                        <i class="fas fa-lock"></i>
                        <p>${lockMessage}</p>
                    `;
                    card.appendChild(lockOverlay);
                    
                    // Disable click functionality - replace with locked handler
                    card.onclick = function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        let message = 'This application is available to NCRC organizational members only. Please sign up or log in as a member to access.';
                        if (appKey === 'lendsight') {
                            message = 'LendSight requires a free account. Please sign up or log in to access.';
                        } else if (appKey === 'dataexplorer') {
                            message = 'DataExplorer is a premium feature. Upgrade to Member Plus ($500-750/year) or Institutional tier ($5K-15K/year) to access.';
                        }
                        alert(message);
                        return false;
                    };
                    card.onkeydown = function(e) {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            let message = 'This application is available to NCRC organizational members only. Please sign up or log in as a member to access.';
                            if (appKey === 'lendsight') {
                                message = 'LendSight requires a free account. Please sign up or log in to access.';
                            } else if (appKey === 'dataexplorer') {
                                message = 'DataExplorer is a premium feature. Upgrade to Member Plus ($500-750/year) or Institutional tier ($5K-15K/year) to access.';
                            }
                            alert(message);
                        }
                        return false;
                    };
                } else if (access === 'limited') {
                    // Limited access (for Status - Staff can see but with restrictions)
                    card.style.display = 'block';
                    card.style.visibility = 'visible';
                    // Don't add card-level click handlers - buttons handle interactions
                    // Status will handle limited access internally
                } else {
                    // Full access - show normally
                    card.style.display = 'block';
                    card.style.visibility = 'visible';
                    // Don't add card-level click handlers - buttons handle interactions
                }
            });

            // Update page title based on visible apps
            const visibleApps = document.querySelectorAll('.app-card:not(.app-hidden)').length;
            const titleP = document.querySelector('.page-title p');
            if (titleP) {
                titleP.textContent = "Select an application to begin your data analysis";
            }

            // Update hamburger nav menu visibility based on user type
            // Only show apps where user has FULL access
            document.querySelectorAll('#navMenu .nav-item').forEach(item => {
                const appKey = item.getAttribute('data-app');
                if (appKey === 'home') {
                    item.style.display = 'block'; // Home always visible
                    return;
                }
                const access = appAccessConfig[appKey];
                // Only show apps with 'full' access - hide everything else
                if (!access || access[userType] !== 'full') {
                    item.style.display = 'none';
                } else {
                    item.style.display = 'block';
                    item.style.opacity = '1';
                    // Remove lock icon if present (from previous state)
                    const lockIcon = item.querySelector('.nav-lock-icon');
                    if (lockIcon) lockIcon.remove();
                }
            });

            // Show/hide admin buttons based on user type (only senior_executive and admin can see)
            const adminButtonsContainer = document.getElementById('adminButtonsContainer');
            if (adminButtonsContainer) {
                if (userType === 'admin' || userType === 'senior_executive') {
                    adminButtonsContainer.style.display = 'flex';
                } else {
                    adminButtonsContainer.style.display = 'none';
                }
            }
        }

        // Handle card clicks
        function handleCardClick(appName) {
            // Special handling for Analytics and Admin - show info modal instead of navigating
            if (appName === 'Analytics' || appName === 'Administration' || appName === 'Admin') {
                handleInfoClick(appName);
                return;
            }
            
            // Show launch modal with feature details
            showLaunchModal(appName);
        }

        // Show launch modal with feature details based on current user type
        function showLaunchModal(appName) {
            const currentUserType = document.getElementById('userTypeSelect').value;
            const permissions = featurePermissions[currentUserType] || featurePermissions['public'];
            const modal = document.getElementById('launchModal');
            const modalTitle = document.getElementById('launchAppName');
            const modalBody = document.getElementById('launchModalBody');
            
            modalTitle.textContent = appName + ' - Available Features';
            
            let content = '';
            
            // Special handling for CommentMaker - it doesn't use geographic restrictions or exports
            if (appName === 'CommentMaker') {
                content += `
                    <div class="feature-detail-section">
                        <h4><i class="fas fa-comments"></i> How CommentMaker Works</h4>
                        <p><strong>Create Your Unique Comment Letter:</strong> CommentMaker helps you write and submit public comments to federal regulatory agencies without using complex forms.</p>
                        <p>Simply enter your personal information, and CommentMaker will generate a unique, personalized comment letter that includes NCRC's key policy points.</p>
                    </div>
                    
                    <div class="feature-detail-section">
                        <h4><i class="fas fa-user-edit"></i> Personal Information</h4>
                        <p>You'll be asked to provide basic information such as:</p>
                        <ul style="margin: 10px 0; padding-left: 20px; color: var(--ncrc-gray-dark);">
                            <li>Your name and contact information</li>
                            <li>Your organization (if applicable)</li>
                            <li>Your location</li>
                            <li>Any specific concerns or experiences you'd like to include</li>
                        </ul>
                    </div>
                    
                    <div class="feature-detail-section">
                        <h4><i class="fas fa-file-alt"></i> Generated Comment Letter</h4>
                        <p>CommentMaker creates a unique comment letter that:</p>
                        <ul style="margin: 10px 0; padding-left: 20px; color: var(--ncrc-gray-dark);">
                            <li>Includes NCRC's key policy points and recommendations</li>
                            <li>Personalizes the content with your information</li>
                            <li>Formats it properly for federal agency submission</li>
                            <li>Is ready to copy and paste into the Federal Register comment system</li>
                        </ul>
                    </div>
                    
                    <div class="feature-detail-section">
                        <h4><i class="fas fa-paper-plane"></i> Submission to Federal Register</h4>
                        <p>Once you have your generated comment letter, you can:</p>
                        <ul style="margin: 10px 0; padding-left: 20px; color: var(--ncrc-gray-dark);">
                            <li>Copy the text directly from CommentMaker</li>
                            <li>Paste it into the Federal Register comment form</li>
                            <li>Submit your comment to agencies like CFPB, FDIC, OCC, or the Federal Reserve</li>
                        </ul>
                        <p class="feature-note">No need to navigate complex agency forms - CommentMaker does the heavy lifting for you!</p>
                    </div>
                    
                    <div class="feature-detail-section">
                        <h4><i class="fas fa-unlock"></i> Available to Everyone</h4>
                        <p><strong>Free for All Users:</strong> CommentMaker is available to everyone - no membership or subscription required. This tool helps amplify community voices in federal rulemaking processes.</p>
                    </div>
                `;
                
                modalBody.innerHTML = content;
                modal.classList.add('active');
                modal.setAttribute('aria-hidden', 'false');
                document.body.style.overflow = 'hidden';
                
                // Focus on close button for accessibility
                setTimeout(() => {
                    modal.querySelector('.modal-close').focus();
                }, 100);
                return;
            }
            
            // Geographic limits
            if (permissions.geographicLimit === 'own_county_only') {
                content += `
                    <div class="feature-detail-section">
                        <h4><i class="fas fa-map-marker-alt"></i> Geographic Selection</h4>
                        <p><strong>Your County Only:</strong> You can only analyze data for the county in which you are located.</p>
                        <p class="feature-note">Reports will focus on your home county with detailed analysis. You cannot select other counties.</p>
                    </div>
                `;
            } else if (permissions.geographicLimit === 'single_county') {
                content += `
                    <div class="feature-detail-section">
                        <h4><i class="fas fa-map-marker-alt"></i> Geographic Selection</h4>
                        <p><strong>Single County Only:</strong> You can analyze data for one county at a time.</p>
                        <p class="feature-note">Reports will focus on a single county with detailed analysis.</p>
                    </div>
                `;
            } else if (permissions.geographicLimit === 'up_to_3_counties') {
                content += `
                    <div class="feature-detail-section">
                        <h4><i class="fas fa-map-marker-alt"></i> Geographic Selection</h4>
                        <p><strong>Up to 3 Counties/Metro Areas:</strong> You can select up to 3 counties or metro areas for analysis.</p>
                        <p class="feature-note">Reports will include separate sections for each selected geographic area, allowing for comparative analysis.</p>
                    </div>
                `;
            } else if (permissions.geographicLimit === '5_plus_counties') {
                content += `
                    <div class="feature-detail-section">
                        <h4><i class="fas fa-map-marker-alt"></i> Geographic Selection</h4>
                        <p><strong>5+ Counties or Unlimited:</strong> You can select 5 or more counties or unlimited geographic areas for analysis.</p>
                        <p class="feature-note">Reports will include separate sections for each selected geographic area, allowing for comprehensive comparative analysis.</p>
                    </div>
                `;
            } else if (permissions.geographicLimit === 'multiple_counties') {
                content += `
                    <div class="feature-detail-section">
                        <h4><i class="fas fa-map-marker-alt"></i> Geographic Selection</h4>
                        <p><strong>Multiple Counties & Metro Areas:</strong> You can select multiple counties or entire metro areas for analysis.</p>
                        <p class="feature-note">Reports will include separate sections for each selected geographic area, allowing for comparative analysis.</p>
                    </div>
                `;
            } else {
                content += `
                    <div class="feature-detail-section">
                        <h4><i class="fas fa-map-marker-alt"></i> Geographic Selection</h4>
                        <p><strong>Unlimited:</strong> You can analyze any geographic combination.</p>
                        <p class="feature-note">Full access to all geographic analysis options.</p>
                    </div>
                `;
            }
            
            // Export capabilities
            if (permissions.canExport && permissions.exportFormats.length > 0) {
                content += `
                    <div class="feature-detail-section">
                        <h4><i class="fas fa-download"></i> Export Options</h4>
                        <p><strong>Available Formats:</strong></p>
                        <ul class="export-formats-list">
                            ${permissions.exportFormats.map(format => `
                                <li><i class="fas fa-file-${format === 'excel' ? 'excel' : format === 'powerpoint' ? 'powerpoint' : format === 'pdf' ? 'pdf' : format === 'csv' ? 'file-csv' : 'code'}"></i> ${format.toUpperCase()}</li>
                            `).join('')}
                        </ul>
                        <p class="feature-note">You can export your analysis results in the formats listed above.</p>
                    </div>
                `;
            } else {
                content += `
                    <div class="feature-detail-section">
                        <h4><i class="fas fa-download"></i> Export Options</h4>
                        <p><strong>No Export Available:</strong> Export functionality is not available for your account type.</p>
                        <p class="feature-note">You can view reports online but cannot download or export data.</p>
                    </div>
                `;
            }
            
            // Additional app-specific features
            content += `
                <div class="feature-detail-section">
                    <h4><i class="fas fa-chart-bar"></i> Analysis Features</h4>
                    <p>Access to comprehensive data analysis tools, interactive visualizations, and detailed reporting capabilities.</p>
                </div>
            `;
            
            // Add pricing information
            content += `
                <div class="feature-detail-section">
                    <h4><i class="fas fa-dollar-sign"></i> Pricing</h4>
                    <p><strong>Your Account Type:</strong> ${permissions.price}</p>
                </div>
            `;
            
            // User type specific notes
            if (currentUserType === 'public') {
                content += `
                    <div class="upgrade-notice">
                        <h4><i class="fas fa-info-circle"></i> Upgrade Your Account</h4>
                        <p>Upgrade to an NCRC Member ($900/year membership) to unlock:</p>
                        <ul>
                            <li>Up to 3 counties/metro areas analysis</li>
                            <li>Export to Excel, PowerPoint, and PDF</li>
                            <li>Access to BranchSight, BranchMapper, and BizSight</li>
                        </ul>
                        <p style="margin-top: 10px;"><strong>Or upgrade to Member Plus ($500-750/year add-on) to also unlock DataExplorer with enhanced features!</strong></p>
                    </div>
                `;
            } else if (currentUserType === 'economy') {
                content += `
                    <div class="upgrade-notice">
                        <h4><i class="fas fa-info-circle"></i> Upgrade Your Account</h4>
                        <p>Upgrade to an NCRC Member ($900/year membership) to unlock:</p>
                        <ul>
                            <li>Up to 3 counties/metro areas analysis</li>
                            <li>Export to Excel, PowerPoint, and PDF</li>
                            <li>Access to BranchSight, BranchMapper, and BizSight</li>
                        </ul>
                        <p style="margin-top: 10px;"><strong>Or upgrade to Member Plus ($500-750/year add-on) to also unlock DataExplorer with enhanced features!</strong></p>
                    </div>
                `;
            } else if (currentUserType === 'member') {
                content += `
                    <div class="upgrade-notice">
                        <h4><i class="fas fa-info-circle"></i> Upgrade to Member Plus</h4>
                        <p>Unlock DataExplorer with enhanced features for $500-750/year:</p>
                        <ul>
                            <li>Advanced filtering options</li>
                            <li>Bulk export capabilities</li>
                            <li>Custom report builder</li>
                            <li>Historical data access</li>
                            <li>Priority support</li>
                            <li>5+ counties or unlimited geography</li>
                        </ul>
                    </div>
                `;
            }
            
            modalBody.innerHTML = content;
            modal.classList.add('active');
            modal.setAttribute('aria-hidden', 'false');
            document.body.style.overflow = 'hidden';
            
            // Focus on close button for accessibility
            setTimeout(() => {
                modal.querySelector('.modal-close').focus();
            }, 100);
        }

        // Close launch modal
        function closeLaunchModal() {
            const modal = document.getElementById('launchModal');
            modal.classList.remove('active');
            modal.setAttribute('aria-hidden', 'true');
            document.body.style.overflow = '';
        }

        // App descriptions - simplified single paragraph format
        const appDescriptions = {
            'LendSight': {
                description: 'Analyze mortgage lending patterns by lender, geography, race, ethnicity, and income. Generates AI-powered narratives that identify lending disparities and compliance concerns using HMDA data. Ideal for CRA exam prep, fair lending research, and CBA negotiations.'
            },
            'BizSight': {
                description: 'Analyze small business lending patterns using CRA data. Compare lenders by loan volume, amounts, and geographic distribution across communities. Identifies gaps in small business credit access for CBA negotiations and community development planning.'
            },
            'DataExplorer': {
                description: 'Query the full HMDA dataset with custom filters for lender, geography, loan type, demographics, and more. Export raw data tables for your own analysis. Built for researchers who need granular access beyond pre-built reports.'
            },
            'BranchSight': {
                description: 'Analyze bank branch networks using FDIC data. Track branch openings, closings, and market concentration by geography and institution. Essential for identifying branch deserts and monitoring access to in-person banking services.'
            },
            'BranchMapper': {
                description: 'Interactive map visualization of bank branch locations with demographic overlays. See branch networks in context of neighborhood income, race, and population density. Useful for identifying underserved areas and planning community outreach.'
            },
            'MergerMeter': {
                description: 'Analyze bank merger impacts on community lending and branch access. Calculates CBA goal recommendations based on combined institution lending patterns and peer comparisons. The go-to tool for preparing merger comment letters and CBA negotiations.'
            },
            'Analytics': {
                description: 'Monitor platform usage across applications, users, and time periods. Track report generation, search queries, and feature adoption. Helps NCRC understand how the coalition is using JustData tools.'
            },
            'Administration': {
                description: 'Manage user accounts, permissions, and system settings. Control access levels across the eight-tier membership structure. Configure platform integrations and monitor system health.'
            },
            'Admin': {
                description: 'Manage user accounts, permissions, and system settings. Control access levels across the eight-tier membership structure. Configure platform integrations and monitor system health.'
            },
            'ElectWatch': {
                description: 'UNDER CONSTRUCTION. Track campaign contributions from financial institutions to members of Congress. See which banks fund which legislators and how those lawmakers vote on banking legislation. Connects the dots between financial influence and policy outcomes.'
            },
            'LenderProfile': {
                description: 'UNDER CONSTRUCTION. Comprehensive intelligence on individual lenders combining corporate structure, regulatory identifiers, CRA ratings, and market position. One-stop lookup for understanding a lender\'s full profile before research or negotiations.'
            },
            'Redlining Dashboard': {
                description: 'UNDER CONSTRUCTION. Compare bank lending in minority census tracts against peer institutions. Identifies lenders underperforming their markets in communities of color. Supports fair lending advocacy with clear disparity metrics and peer benchmarks.'
            },
            'CommentMaker': {
                description: 'UNDER CONSTRUCTION. Generate public comments for federal rulemakings with AI assistance. Guides users through the comment process and helps articulate community perspectives on proposed regulations. Designed to amplify grassroots voices in policy debates.'
            }
        };

        // Show app info modal - simplified single paragraph format
        function handleInfoClick(appName) {
            const modal = document.getElementById('appInfoModal');
            const modalTitle = document.getElementById('appInfoName');
            const modalBody = document.getElementById('appInfoModalBody');

            // Remove mockup-modal class (no longer using mockups)
            const modalContent = modal.querySelector('.modal-content');
            if (modalContent) {
                modalContent.classList.remove('mockup-modal');
            }

            modalTitle.textContent = appName;

            const appInfo = appDescriptions[appName] || {};

            // Simple single paragraph content
            let content = '';
            if (appInfo && appInfo.description) {
                content = `<p style="font-size: 1.1rem; line-height: 1.7; color: var(--color-text-secondary, #666); margin: 0;">${appInfo.description}</p>`;
            } else {
                content = `<p style="font-size: 1.1rem; line-height: 1.7; color: var(--color-text-secondary, #666); margin: 0;">No description available for this application.</p>`;
            }

            modalBody.innerHTML = content;
            modal.classList.add('active');
            modal.setAttribute('aria-hidden', 'false');
            document.body.style.overflow = 'hidden';

            // Focus on close button for accessibility
            setTimeout(() => {
                modal.querySelector('.modal-close').focus();
            }, 100);
        }

        // Close app info modal
        function closeAppInfoModal() {
            const modal = document.getElementById('appInfoModal');
            const modalContent = modal.querySelector('.modal-content');
            if (modalContent) {
                modalContent.classList.remove('mockup-modal');
            }
            modal.classList.remove('active');
            modal.setAttribute('aria-hidden', 'true');
            document.body.style.overflow = '';
        }

        // Handle keyboard navigation for cards
        function handleCardKeyDown(event, appName) {
            // Enter or Space key activates the card
            if (event.key === 'Enter' || event.key === ' ') {
                event.preventDefault();
                handleCardClick(appName);
            }
        }

        // Add focus management for better keyboard navigation
        document.addEventListener('DOMContentLoaded', async function() {
            // Check auth status and set user type accordingly
            let userType = 'public_anonymous';  // Default for non-authenticated users

            let authData = null;
            try {
                const response = await fetch('/api/auth/status');
                authData = await response.json();
                if (authData.user_type) {
                    userType = authData.user_type;
                }
                console.log('User type:', userType, '| Authenticated:', authData.authenticated);
            } catch (error) {
                console.log('Auth check failed, using public_anonymous:', error);
            }

            document.getElementById('userTypeSelect').value = userType;
            switchUserType(userType);

            // Update welcome greeting with user's name
            // First-time users (login_count <= 1) see "Welcome to JustData!!"
            // Returning users see "Welcome back, [Name]"
            const welcomeGreeting = document.getElementById('welcomeGreeting');
            if (welcomeGreeting && authData) {
                const isFirstLogin = authData.login_count !== null && authData.login_count <= 1;

                if (authData.authenticated && isFirstLogin) {
                    // First-time user
                    if (authData.user && authData.user.name) {
                        const firstName = authData.user.name.split(' ')[0];
                        welcomeGreeting.textContent = 'Welcome to JustData, ' + firstName + '!';
                    } else if (authData.user && authData.user.email) {
                        const emailName = authData.user.email.split('@')[0];
                        welcomeGreeting.textContent = 'Welcome to JustData, ' + emailName + '!';
                    } else {
                        welcomeGreeting.textContent = 'Welcome to JustData!';
                    }
                } else if (authData.authenticated && authData.user && authData.user.name) {
                    // Returning user with name
                    const firstName = authData.user.name.split(' ')[0];
                    welcomeGreeting.textContent = 'Welcome back, ' + firstName;
                } else if (authData.authenticated && authData.user && authData.user.email) {
                    // Returning user with email only
                    const emailName = authData.user.email.split('@')[0];
                    welcomeGreeting.textContent = 'Welcome back, ' + emailName;
                } else if (authData.authenticated) {
                    welcomeGreeting.textContent = 'Welcome back';
                } else {
                    welcomeGreeting.textContent = 'Welcome to JustData';
                }
            }

            // Fetch and display platform stats
            try {
                const statsResponse = await fetch('/api/platform-stats');
                if (statsResponse.ok) {
                    const stats = await statsResponse.json();
                    // Format large numbers nicely (e.g., 12.5M+)
                    const formatNumber = (num) => {
                        if (num >= 1000000) {
                            return (num / 1000000).toFixed(1).replace(/\.0$/, '') + 'M+';
                        } else if (num >= 1000) {
                            return (num / 1000).toFixed(1).replace(/\.0$/, '') + 'K+';
                        }
                        return num.toLocaleString();
                    };

                    const mortgageEl = document.getElementById('mortgageRecords');
                    const lendersEl = document.getElementById('lendersTracked');
                    const reportsEl = document.getElementById('reportsGenerated');
                    const researchersEl = document.getElementById('activeResearchers');

                    if (mortgageEl && stats.mortgage_records !== undefined) {
                        mortgageEl.textContent = formatNumber(stats.mortgage_records);
                    }
                    if (lendersEl && stats.lenders_tracked !== undefined) {
                        lendersEl.textContent = formatNumber(stats.lenders_tracked);
                    }
                    if (reportsEl && stats.reports_generated !== undefined) {
                        reportsEl.textContent = stats.reports_generated.toLocaleString();
                    }
                    if (researchersEl && stats.active_researchers !== undefined) {
                        researchersEl.textContent = stats.active_researchers.toLocaleString();
                    }
                }
            } catch (error) {
                console.log('Stats fetch failed:', error);
            }

            // Show Internal Tools section for staff/senior_executive/admin users
            const internalToolsSection = document.getElementById('internalToolsSection');
            if (internalToolsSection) {
                if (userType === 'staff' || userType === 'senior_executive' || userType === 'admin') {
                    internalToolsSection.style.display = 'block';
                } else {
                    internalToolsSection.style.display = 'none';
                }
            }

            // Show admin section for senior_executive/admin users only (Analytics hidden from staff)
            const adminSection = document.getElementById('adminSection');
            if (adminSection) {
                if (userType === 'senior_executive' || userType === 'admin') {
                    adminSection.style.display = 'block';
                } else {
                    adminSection.style.display = 'none';
                }
            }

            // Hide Administration card for non-admin users (only admin can see it)
            const administrationCard = document.getElementById('administrationCard');
            if (administrationCard) {
                if (userType === 'admin') {
                    administrationCard.style.display = 'flex';
                } else {
                    administrationCard.style.display = 'none';
                }
            }

            const cards = document.querySelectorAll('.app-card');
            
            // Add visual feedback for keyboard users
            cards.forEach(card => {
                card.addEventListener('focus', function() {
                    this.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                });
            });

            // Announce page load to screen readers
            const announcement = document.createElement('div');
            announcement.setAttribute('role', 'status');
            announcement.setAttribute('aria-live', 'polite');
            announcement.setAttribute('aria-atomic', 'true');
            announcement.className = 'sr-only';
            announcement.style.cssText = 'position: absolute; left: -10000px; width: 1px; height: 1px; overflow: hidden;';
            announcement.textContent = 'JustData landing page loaded. ' + cards.length + ' applications available.';
            document.body.appendChild(announcement);

            // Remove announcement after screen reader has time to read it
            setTimeout(() => {
                announcement.remove();
            }, 1000);
        });

        // Close modal on Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const launchModal = document.getElementById('launchModal');
                const appInfoModal = document.getElementById('appInfoModal');
                if (launchModal.classList.contains('active')) {
                    closeLaunchModal();
                }
                if (appInfoModal.classList.contains('active')) {
                    closeAppInfoModal();
                }
            }
        });

        // Close modal when clicking overlay (but not modal content)
        document.getElementById('launchModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeLaunchModal();
            }
        });

        document.getElementById('appInfoModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeAppInfoModal();
            }
        });
    </script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>

    <!-- JustData Auth -->
    <script src="/static/js/auth.js"></script>

    <!-- Auth-gated app launching -->
    <script>
        // Intercept app launch buttons to require authentication
        document.addEventListener('DOMContentLoaded', function() {
            // Wait for Firebase to initialize
            setTimeout(function() {
                // Add click handlers to all launch buttons
                document.querySelectorAll('.app-card-launch-btn').forEach(function(btn) {
                    btn.addEventListener('click', function(e) {
                        // Check if user is authenticated
                        if (typeof JustDataAuth !== 'undefined' && !JustDataAuth.isAuthenticated()) {
                            e.preventDefault();
                            e.stopPropagation();

                            // Show sign-in prompt
                            if (confirm('Please sign in to access JustData applications.\n\nClick OK to sign in with Google.')) {
                                JustDataAuth.signInWithGoogle().then(function() {
                                    // After successful sign-in, open the app in a new window
                                    window.open(btn.getAttribute('href'), '_blank', 'noopener,noreferrer');
                                }).catch(function(err) {
                                    console.log('Sign-in cancelled or failed');
                                });
                            }
                        }
                        // If authenticated, allow normal navigation
                    });
                });

                // Also intercept nav menu links
                document.querySelectorAll('#navMenu .nav-item').forEach(function(link) {
                    const href = link.getAttribute('href');
                    if (href && href !== '/' && !href.startsWith('#')) {
                        link.addEventListener('click', function(e) {
                            if (typeof JustDataAuth !== 'undefined' && !JustDataAuth.isAuthenticated()) {
                                e.preventDefault();

                                if (confirm('Please sign in to access JustData applications.\n\nClick OK to sign in with Google.')) {
                                    JustDataAuth.signInWithGoogle().then(function() {
                                        window.open(href, '_blank', 'noopener,noreferrer');
                                    }).catch(function(err) {
                                        console.log('Sign-in cancelled or failed');
                                    });
                                }
                            }
                        });
                    }
                });
            }, 500); // Give Firebase time to initialize
        });
    </script>
</body>
</html>

