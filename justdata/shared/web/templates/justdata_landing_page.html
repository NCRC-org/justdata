<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JustData - NCRC Data Analysis Platform</title>
    <meta name="description" content="Comprehensive data analysis platform providing insights across banking, mortgage, small business, and member management.">
    <meta name="keywords" content="JustData, NCRC, data analysis, banking, mortgage, small business, member management">
    <meta name="author" content="JustData - National Community Reinvestment Coalition">
    <meta name="theme-color" content="#552d87">
    <link rel="icon" type="image/x-icon" href="/static/favicon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon-16x16.png">
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* ProPublica-Inspired Design - Clean, Professional, Minimal */
        :root {
            /* Colors - ProPublica Style */
            --color-header: #1E3D5C;           /* Navy header bar */
            --color-primary: #0077B6;          /* Primary accent - Launch buttons, links */
            --color-primary-hover: #005a8c;    /* Primary hover state */
            --color-text: #1a1a1a;             /* Main text color */
            --color-text-secondary: #666666;  /* Secondary text */
            --color-text-muted: #999999;       /* Muted text */
            --color-background: #f8f8f8;       /* Page background */
            --color-card: #ffffff;             /* Card background */
            --color-border: #e0e0e0;           /* Card borders */
            --color-locked-bg: #f5f5f5;        /* Locked card background */

            /* Legacy variables for compatibility */
            --ncrc-primary-blue: #0077B6;
            --ncrc-secondary-blue: #005a8c;
            --ncrc-dark-blue: #1E3D5C;
            --ncrc-light-blue: #E6F2FF;
            --ncrc-gold: #ffc23a;
            --ncrc-gray: #666666;
            --ncrc-white: #FFFFFF;
            --ncrc-black: #000000;
            --ncrc-gray-light: #f8f8f8;
            --ncrc-gray-dark: #1a1a1a;

            /* Typography */
            --font-serif: Georgia, "Times New Roman", serif;
            --font-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;

            /* Spacing */
            --spacing-xs: 8px;
            --spacing-sm: 12px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 48px;

            /* Border radius */
            --radius-sm: 4px;

            /* Shadows */
            --shadow-card-hover: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-sans);
            background: var(--color-background);
            min-height: 100vh;
            color: var(--color-text);
            line-height: 1.6;
            margin: 0;
            padding-top: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--spacing-lg);
        }

        .content-wrapper {
            width: 100%;
        }

        /* Header - Simplified ProPublica Style */
        .header {
            background: var(--color-header);
            padding: 0 var(--spacing-lg);
            color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
        }

        .header-layout {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 64px;
            width: 100%;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            text-decoration: none;
            color: white;
        }

        .logo:hover {
            opacity: 0.9;
        }

        /* Logo text styling */
        .logo-text {
            font-family: var(--font-serif);
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            letter-spacing: -0.5px;
        }

        .logo img {
            height: 40px;
            width: auto;
        }

        /* User Avatar Dropdown */
        .user-avatar-dropdown {
            position: relative;
        }

        .user-avatar-btn {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-sm);
            transition: background 0.2s ease;
        }

        .user-avatar-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--color-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
        }

        .user-dropdown-menu {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: white;
            border-radius: var(--radius-sm);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            min-width: 200px;
            padding: var(--spacing-xs) 0;
            display: none;
            z-index: 1000;
        }

        .user-dropdown-menu.active {
            display: block;
        }

        .user-dropdown-header {
            padding: var(--spacing-sm) var(--spacing-md);
            border-bottom: 1px solid var(--color-border);
        }

        .user-dropdown-name {
            font-weight: 600;
            color: var(--color-text);
            font-size: 14px;
        }

        .user-dropdown-email {
            font-size: 12px;
            color: var(--color-text-muted);
        }

        .user-dropdown-role {
            font-size: 11px;
            color: var(--color-primary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 4px;
        }

        .user-dropdown-item {
            display: block;
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md);
            background: none;
            border: none;
            text-align: left;
            color: var(--color-text);
            font-size: 14px;
            cursor: pointer;
            text-decoration: none;
            transition: background 0.2s ease;
        }

        .user-dropdown-item:hover {
            background: var(--color-background);
        }

        .user-dropdown-item i {
            width: 20px;
            margin-right: var(--spacing-xs);
            color: var(--color-text-secondary);
        }

        /* Welcome Section */
        .welcome-section {
            padding: var(--spacing-xl) 0 var(--spacing-lg);
        }

        .welcome-greeting {
            font-family: var(--font-serif);
            font-size: 24px;
            font-weight: 400;
            color: var(--color-text);
            margin: 0 0 var(--spacing-xs) 0;
        }

        .welcome-subtext {
            font-size: 14px;
            color: var(--color-text-secondary);
            margin: 0;
        }

        /* Platform Stats Bar */
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--spacing-lg);
            padding: var(--spacing-lg) 0;
            margin-bottom: var(--spacing-lg);
            border-bottom: 1px solid var(--color-border);
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-family: var(--font-serif);
            font-size: 42px;
            font-weight: 700;
            color: var(--color-text);
            line-height: 1.1;
            margin-bottom: 4px;
        }

        .stat-label {
            font-family: var(--font-sans);
            font-size: 12px;
            font-weight: 600;
            color: var(--color-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        @media (max-width: 900px) {
            .stats-bar {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 500px) {
            .stats-bar {
                grid-template-columns: 1fr;
            }
            .stat-number {
                font-size: 36px;
            }
        }

        /* Main Content */
        .main-content {
            padding: 0 0 var(--spacing-xl);
        }

        /* Category Sections */
        .category-section {
            margin-bottom: var(--spacing-xl);
        }

        .category-header {
            font-size: 12px;
            font-weight: 600;
            color: var(--color-text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-xs);
            border-bottom: 2px solid var(--color-header);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .category-note {
            font-size: 11px;
            color: var(--color-text-muted);
            font-weight: normal;
            text-transform: none;
            letter-spacing: normal;
        }

        .apps-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--spacing-lg);
        }

        @media (max-width: 1200px) {
            .apps-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 900px) {
            .apps-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .apps-grid {
                grid-template-columns: 1fr;
            }
        }

        /* App Cards - ProPublica Style */
        .app-card {
            background: var(--color-card);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            padding: var(--spacing-lg);
            transition: box-shadow 0.2s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            min-height: 180px;
        }

        .app-card:hover {
            box-shadow: var(--shadow-card-hover);
        }

        /* App Card Title - Serif font */
        .app-card-title {
            font-family: var(--font-serif);
            font-size: 20px;
            font-weight: 700;
            color: var(--color-text);
            margin: 0 0 var(--spacing-sm) 0;
        }

        .app-card-description {
            font-size: 14px;
            color: var(--color-text-secondary);
            line-height: 1.6;
            margin: 0;
            flex-grow: 1;
        }

        .app-card-buttons {
            margin-top: var(--spacing-lg);
            display: flex;
            justify-content: flex-end;
        }

        .app-card-launch-btn {
            background: var(--color-primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-xs);
            text-decoration: none;
            transition: background 0.2s ease;
        }

        .app-card-launch-btn:hover {
            background: var(--color-primary-hover);
        }

        .app-card-launch-btn i {
            font-size: 12px;
        }

        /* Locked App Cards */
        .app-card.locked {
            background: var(--color-locked-bg);
        }

        .app-card.locked .app-card-title {
            color: var(--color-text-muted);
        }

        .app-card.locked .app-card-description {
            color: #aaaaaa;
        }

        .app-card.locked .lock-icon {
            position: absolute;
            top: var(--spacing-md);
            right: var(--spacing-md);
            color: #cccccc;
            font-size: 16px;
        }

        .app-card.locked .app-card-cta {
            background: transparent;
            color: var(--color-primary);
            border: 1px solid var(--color-primary);
            padding: 10px 20px;
            border-radius: var(--radius-sm);
            font-size: 14px;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-xs);
            transition: all 0.2s ease;
        }

        .app-card.locked .app-card-cta:hover {
            background: var(--color-primary);
            color: white;
        }

        /* Coming Soon Cards */
        .app-card.coming-soon {
            background: var(--color-locked-bg);
        }

        .app-card.coming-soon .app-card-title {
            color: var(--color-text-muted);
        }

        .app-card.coming-soon .app-card-description {
            color: #aaaaaa;
        }

        .app-card.coming-soon .app-card-launch-btn {
            background: transparent;
            color: var(--color-text-muted);
            border: 1px solid var(--color-border);
            cursor: default;
        }

        .app-card.coming-soon .app-card-launch-btn:hover {
            background: transparent;
        }

        /* Legacy card header - simplified */
        .app-card-header {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .app-card-status {
            display: none;
            margin-top: 15px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
        }

        /* Page Title */
        .page-title {
            margin-bottom: var(--spacing-lg);
        }

        .page-title h2 {
            font-family: var(--font-serif);
            font-size: 24px;
            font-weight: 400;
            color: var(--color-text);
            margin: 0 0 var(--spacing-xs) 0;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .page-title h2 i {
            color: var(--color-primary);
        }

        .page-title p {
            font-size: 14px;
            color: var(--color-text-secondary);
            margin: 0;
        }

        /* Focus states for accessibility */
        .app-card:focus {
            outline: 3px solid var(--ncrc-secondary-blue);
            outline-offset: 2px;
        }

        .app-card:focus-visible {
            outline: 3px solid var(--ncrc-secondary-blue);
            outline-offset: 2px;
        }

        /* Mobile Responsive Styles */
        @media (max-width: 1024px) {
            .container {
                flex-direction: column;
                gap: 20px;
            }

            .sidebar {
                width: 100%;
                position: relative;
                top: 0;
                margin-top: 0;
                max-height: none;
            }

            .apps-grid {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: 20px;
            }
        }

        @media (max-width: 768px) {
            .header-layout {
                flex-direction: column;
                gap: 15px;
            }

            .header-title-section {
                position: relative;
                left: auto;
                transform: none;
                order: 2;
            }

            .logo {
                order: 1;
                justify-content: center;
            }

            .header-tagline {
                order: 3;
                justify-content: center;
            }

            .header-title-section h1 {
                font-size: 2rem;
            }

            .just-data-subtitle {
                font-size: 1rem;
            }

            .apps-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .app-card {
                padding: 20px;
            }

            .app-card-buttons {
                position: relative;
                bottom: auto;
                right: auto;
                margin-top: 15px;
                width: 100%;
                flex-direction: column;
                gap: 10px;
            }

            .app-card-launch-btn {
                width: 100%;
                justify-content: center;
            }

            .page-title h2 {
                font-size: 1.5rem;
            }

            .page-title p {
                font-size: 1rem;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 20px 15px;
            }

            .header-title-section h1 {
                font-size: 1.75rem;
            }

            .tagline-box {
                width: 100%;
                max-width: 256px;
            }

            .container {
                padding: 0 15px;
            }

            .app-card {
                padding: 15px;
            }

            .app-card-icon {
                width: 50px;
                height: 50px;
                font-size: 2rem;
            }

            .app-card-title {
                font-size: 1.2rem;
            }

            .app-card-description {
                font-size: 0.9rem;
            }

            .sidebar {
                padding: 15px;
            }

            .sidebar h3 {
                font-size: 1rem;
            }

            .modal-content {
                max-width: 100%;
                margin: 10px;
            }

            .modal-body {
                padding: 20px 15px;
            }

            .access-matrix-table {
                font-size: 0.75rem;
            }

            .access-matrix-table th,
            .access-matrix-table td {
                padding: 8px 5px;
            }
        }

        /* Touch device optimizations */
        @media (hover: none) and (pointer: coarse) {
            .app-card {
                cursor: pointer;
            }

            .app-card-buttons {
                position: relative;
                bottom: auto;
                right: auto;
                margin-top: 15px;
                width: 100%;
                flex-direction: column;
                gap: 10px;
            }

            .app-card-launch-btn {
                width: 100%;
                justify-content: center;
            }
        }

        .status-ready {
            background: #d4edda;
            color: #155724;
        }

        .status-dev {
            background: #fff3cd;
            color: #856404;
        }

        /* Color coding for apps */
        .app-branchseeker .app-card-icon {
            background: rgba(3, 78, 160, 0.1);
            color: var(--ncrc-dark-blue);
        }

        .app-lendsight .app-card-icon {
            background: rgba(34, 139, 34, 0.1);
            color: #228b22;
        }

        .app-branchmapper .app-card-icon {
            background: rgba(255, 140, 0, 0.1);
            color: #ff8c00;
        }

        .app-dataexplorer .app-card-icon {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .app-lenderprofile .app-card-icon {
            background: rgba(85, 45, 135, 0.1);
            color: var(--ncrc-primary-blue);
        }

        .app-commentmaker .app-card-icon {
            background: rgba(232, 46, 46, 0.1);
            color: var(--ncrc-accent-red);
        }

        .app-justpolicy .app-card-icon {
            background: rgba(85, 45, 135, 0.1);
            color: var(--ncrc-primary-blue);
        }

        .app-bizsight .app-card-icon {
            background: rgba(0, 128, 128, 0.1);
            color: #008080;
        }


        .app-analytics .app-card-icon {
            background: rgba(47, 173, 227, 0.1);
            color: var(--ncrc-secondary-blue);
        }

        .app-admin .app-card-icon {
            background: rgba(232, 46, 46, 0.1);
            color: var(--ncrc-accent-red);
        }

        .app-mergermeter .app-card-icon {
            background: rgba(85, 45, 135, 0.1);
            color: var(--ncrc-primary-blue);
        }

        /* Locked App States */
        .app-card.app-locked {
            opacity: 0.9;
            position: relative;
            cursor: not-allowed;
            pointer-events: auto;
        }

        .app-card.app-locked::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.45);
            border-radius: 12px;
            z-index: 1;
            pointer-events: none;
        }

        .app-card.app-locked .lock-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2;
            text-align: center;
            color: var(--ncrc-gray);
            pointer-events: none;
        }

        .app-card.app-locked .lock-overlay i {
            font-size: 2.5rem;
            color: var(--ncrc-primary-blue);
            margin-bottom: 10px;
            display: block;
        }

        .app-card.app-locked .lock-overlay p {
            font-weight: 600;
            color: var(--ncrc-primary-blue);
            margin: 0;
            font-size: 0.95rem;
        }

        .app-card.app-locked .app-card-launch-btn {
            display: none;
        }

        .app-card.app-hidden {
            display: none !important;
        }

        /* Sidebar */
        .sidebar {
            width: 320px;
            flex-shrink: 0;
            position: sticky;
            top: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 18px;
            margin-top: 20px;
            max-height: calc(100vh - 40px);
            overflow-y: visible;
        }

        .sidebar h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--ncrc-primary-blue);
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--ncrc-light-blue);
        }

        .sidebar-features {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .sidebar .feature-card {
            background: var(--ncrc-light-blue);
            border-radius: 8px;
            padding: 10px 12px;
            border: 1px solid rgba(0, 51, 102, 0.1);
        }

        .sidebar .feature-card i {
            font-size: 1.4rem;
            color: var(--ncrc-primary-blue);
            margin-bottom: 6px;
            display: inline-block;
            margin-right: 8px;
            vertical-align: top;
        }

        .sidebar .feature-card h4 {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--ncrc-primary-blue);
            margin: 0 0 4px 0;
            display: inline-block;
            vertical-align: top;
            width: calc(100% - 40px);
        }

        .sidebar .feature-card p {
            font-size: 0.8rem;
            color: var(--ncrc-gray);
            line-height: 1.3;
            margin: 4px 0 0 0;
        }

        /* Footer - ProPublica Style */
        .footer {
            background: var(--color-header);
            color: white;
            padding: var(--spacing-lg);
            margin-top: var(--spacing-xl);
            text-align: center;
        }

        .footer-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .footer-content {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: var(--spacing-sm);
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: var(--spacing-lg);
            margin-top: var(--spacing-sm);
        }

        .footer-links a {
            color: #8bb8ff;
            text-decoration: none;
            font-size: 13px;
            transition: color 0.2s ease;
        }

        .footer-links a:hover {
            text-decoration: underline;
            color: white;
        }

        /* Legacy footer columns - hidden in new design */
        .footer-col {
            display: none;
        }

        .footer-bottom {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
            margin-top: var(--spacing-sm);
        }

        .footer-bottom em {
            color: #eb2f89;
            font-style: italic;
        }

        /* User Types Button */
        .user-types-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--ncrc-primary-blue);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px auto;
            display: block;
            box-shadow: 0 2px 8px rgba(85, 45, 135, 0.2);
        }

        .user-types-button:hover {
            background: var(--ncrc-secondary-blue);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(85, 45, 135, 0.3);
        }

        .user-types-button:focus {
            outline: 3px solid var(--ncrc-secondary-blue);
            outline-offset: 2px;
        }

        .user-types-button i {
            font-size: 0.9rem;
        }

        /* Modal Overlay */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(4px);
        }

        .modal-overlay.active {
            display: flex;
        }

        /* Modal Content */
        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 1400px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            position: relative;
            animation: modalFadeIn 0.3s ease-out;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal-header {
            padding: 25px 30px;
            border-bottom: 2px solid var(--ncrc-light-blue);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: white;
            z-index: 1;
            border-radius: 12px 12px 0 0;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.5rem;
            color: var(--ncrc-primary-blue);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--ncrc-gray);
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 6px;
            transition: all 0.2s ease;
            line-height: 1;
        }

        .modal-close:hover {
            background: var(--ncrc-light-blue);
            color: var(--ncrc-primary-blue);
        }

        .modal-close:focus {
            outline: 2px solid var(--ncrc-secondary-blue);
            outline-offset: 2px;
        }

        .modal-body {
            padding: 30px;
        }
        
        /* Wider modal for mockup displays (Analytics and Administration) */
        .modal-content.mockup-modal {
            max-width: 95vw;
            max-height: 95vh;
        }
        
        .modal-body iframe {
            width: 100%;
            min-height: 600px;
            border: none;
            border-radius: 8px;
        }
        
        @media (max-width: 768px) {
            .modal-content.mockup-modal {
                max-width: 100vw;
                max-height: 100vh;
                border-radius: 0;
            }
            
            .modal-body iframe {
                min-height: 500px;
            }
        }

        /* Access Matrix Table */
        .access-matrix-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
            margin-top: 20px;
        }

        .access-matrix-table th {
            background: var(--ncrc-primary-blue);
            color: white;
            padding: 12px 10px;
            text-align: center;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .access-matrix-table th:first-child {
            text-align: left;
            background: var(--ncrc-dark-blue);
            position: sticky;
            left: 0;
            z-index: 11;
        }

        .access-matrix-table td {
            padding: 12px 10px;
            text-align: center;
            border-bottom: 1px solid #e0e0e0;
            vertical-align: middle;
        }

        .access-matrix-table td:first-child {
            text-align: left;
            font-weight: 600;
            color: var(--ncrc-dark-blue);
            background: var(--ncrc-light-blue);
            position: sticky;
            left: 0;
            z-index: 1;
        }

        .access-matrix-table tr:hover td {
            background: #f8f9fa;
        }

        .access-matrix-table tr:hover td:first-child {
            background: var(--ncrc-light-blue);
        }

        /* Access Status Icons */
        .access-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .access-full {
            background: #d4edda;
            color: #155724;
        }

        .access-locked {
            background: #fff3cd;
            color: #856404;
        }

        .access-hidden {
            background: #f8d7da;
            color: #721c24;
        }

        .access-partial {
            background: #d1ecf1;
            color: #0c5460;
        }

        .access-icon {
            margin-right: 4px;
        }

        /* Launch Modal Feature Details */
        .feature-detail-section {
            margin-bottom: 25px;
            padding: 20px;
            background: var(--ncrc-light-blue);
            border-radius: 8px;
            border-left: 4px solid var(--ncrc-primary-blue);
        }

        .feature-detail-section h4 {
            font-size: 1.1rem;
            color: var(--ncrc-primary-blue);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .feature-detail-section h4 i {
            font-size: 1.2rem;
        }

        .feature-detail-section p {
            margin: 8px 0;
            color: var(--ncrc-gray-dark);
            line-height: 1.6;
        }

        .feature-detail-section .feature-note {
            font-size: 0.9rem;
            color: var(--ncrc-gray);
            font-style: italic;
            margin-top: 8px;
        }

        .export-formats-list {
            list-style: none;
            padding: 0;
            margin: 12px 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }

        .export-formats-list li {
            padding: 10px 15px;
            background: white;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            color: var(--ncrc-dark-blue);
        }

        .export-formats-list li i {
            color: var(--ncrc-primary-blue);
        }

        .upgrade-notice {
            margin-top: 25px;
            padding: 20px;
            background: #fff3cd;
            border-radius: 8px;
            border-left: 4px solid var(--ncrc-gold);
        }

        .upgrade-notice h4 {
            font-size: 1rem;
            color: #856404;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .upgrade-notice p {
            margin: 8px 0;
            color: #856404;
        }

        .upgrade-notice ul {
            margin: 10px 0 0 20px;
            color: #856404;
        }

        .upgrade-notice ul li {
            margin: 5px 0;
        }

        /* Page Title */
        .page-title {
            text-align: center;
            margin: 40px 0 30px;
        }

        .page-title h2 {
            font-size: 2rem;
            font-weight: 600;
            color: var(--ncrc-primary-blue);
            margin-bottom: 10px;
        }

        .page-title p {
            font-size: 1.1rem;
            color: var(--ncrc-gray);
        }

        /* Skip to main content link for screen readers */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--ncrc-primary-blue);
            color: white;
            padding: 8px 16px;
            text-decoration: none;
            z-index: 1000;
            border-radius: 0 0 4px 0;
        }

        .skip-link:focus {
            top: 0;
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            .app-card {
                border: 2px solid var(--ncrc-gray-dark);
            }

            .app-card:hover {
                border-color: var(--ncrc-primary-blue);
            }
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }

            .app-card:hover {
                transform: none;
            }
        }

        /* Slack Support Button */
        .support-bar {
            position: relative;
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--spacing-xs) var(--spacing-lg);
        }

        .slack-support-btn {
            position: absolute;
            right: var(--spacing-lg);
            top: var(--spacing-xs);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: #4A154B;
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            padding: 8px 16px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
            transition: background 0.2s ease, transform 0.2s ease;
            z-index: 100;
        }

        .slack-support-btn:hover {
            background: #611f69;
            transform: translateY(-1px);
        }

        .slack-support-btn i {
            font-size: 16px;
        }

        @media (max-width: 600px) {
            .slack-support-btn {
                padding: 6px 12px;
                font-size: 12px;
            }

            .slack-support-btn span {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Skip to main content link -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <!-- Header -->
    <header class="header" style="padding: 10px 20px;">
        <div class="header-content">
            <div class="header-layout" style="display: flex; justify-content: space-between; align-items: center;">
                <!-- Logo - Left aligned -->
                <a href="/" class="logo" style="display: flex; align-items: center; text-decoration: none;">
                    <img src="/static/img/justdata-logo-white.png" alt="JustData" style="height: 48px; width: auto;" onerror="this.onerror=null; this.src='/static/img/justdata-logo.png';">
                </a>

                <!-- Executive/Admin Buttons (only visible to senior_executive and admin) -->
                <div id="adminButtonsContainer" style="display: none; flex-direction: row; align-items: center; gap: 8px;">
                    <button class="header-btn" onclick="openUserTypesModal()" style="background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 6px 12px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 6px; font-size: 0.8rem;">
                        <i class="fas fa-users-cog"></i>
                        <span>User Types</span>
                    </button>
                    <button class="header-btn" onclick="openIncomeSourcesModal()" style="background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 6px 12px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 6px; font-size: 0.8rem;">
                        <i class="fas fa-dollar-sign"></i>
                        <span>Income Sources</span>
                    </button>
                </div>

                <!-- Hidden user type selector -->
                <select id="userTypeSelect" onchange="switchUserType(this.value)" style="display: none;">
                    <option value="public_anonymous">Guest</option>
                    <option value="public_registered">Registered</option>
                    <option value="just_economy_club">Just Economy Club</option>
                    <option value="member">Member</option>
                    <option value="member_premium">Member Premium</option>
                    <option value="non_member_org">Institutional</option>
                    <option value="staff">Staff</option>
                    <option value="senior_executive">Senior Executive</option>
                    <option value="admin">Admin</option>
                </select>
                <!-- Right side: Auth & Hamburger Menu -->
                <div style="display: flex; align-items: center; min-width: 280px; justify-content: flex-end; gap: 12px;">
                    <!-- User Info (shown when logged in) -->
                    <div id="userInfo" style="display: none; align-items: center; gap: 8px;">
                        <img id="userAvatar" src="" alt="User" style="width: 32px; height: 32px; border-radius: 50%; display: none;">
                        <div style="display: flex; flex-direction: column; align-items: flex-start;">
                            <span id="userEmail" style="color: white; font-size: 13px; max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"></span>
                            <span id="userTypeBadge" style="color: #90EE90; font-size: 10px; text-transform: uppercase; font-weight: 600;"></span>
                        </div>
                    </div>

                    <!-- Login Button -->
                    <button id="loginBtn" onclick="openLoginModal()" style="display: inline-flex; align-items: center; gap: 6px; background: white; color: var(--ncrc-dark-blue); border: none; border-radius: 6px; padding: 8px 14px; font-size: 13px; font-weight: 500; cursor: pointer; transition: background 0.2s;">
                        <i class="fas fa-sign-in-alt" style="font-size: 14px;"></i>
                        <span>Sign In</span>
                    </button>

                    <!-- Logout Button -->
                    <button id="logoutBtn" onclick="JustDataAuth.signOut()" style="display: none; align-items: center; gap: 6px; background: rgba(255,255,255,0.15); color: white; border: 1px solid rgba(255,255,255,0.3); border-radius: 6px; padding: 8px 14px; font-size: 13px; font-weight: 500; cursor: pointer; transition: background 0.2s;">
                        <i class="fas fa-sign-out-alt" style="font-size: 14px;"></i>
                        <span>Sign Out</span>
                    </button>

                    <!-- Hamburger Menu -->
                    <button class="hamburger-menu" onclick="toggleNavMenu()" aria-label="Toggle navigation menu" style="background: none; border: none; cursor: pointer; padding: 8px; display: flex; flex-direction: column; gap: 7px;">
                        <span style="display: block; width: 36px; height: 5px; background: white; border-radius: 2px;"></span>
                        <span style="display: block; width: 36px; height: 5px; background: white; border-radius: 2px;"></span>
                        <span style="display: block; width: 36px; height: 5px; background: white; border-radius: 2px;"></span>
                    </button>
                </div>
            </div>
            <!-- Dropdown Nav Menu -->
            <nav id="navMenu" class="nav-menu" style="display: none; position: absolute; top: 100%; right: 0; background: white; box-shadow: 0 4px 12px rgba(0,0,0,0.15); border-radius: 0 0 8px 8px; min-width: 220px; z-index: 1000;">
                <a href="/" class="nav-item" data-app="home" style="display: block; padding: 12px 20px; color: #333; text-decoration: none; border-bottom: 1px solid #eee;"><i class="fas fa-home" style="margin-right: 10px; color: var(--ncrc-dark-blue);"></i>Home</a>
                <a href="/lendsight" class="nav-item" data-app="lendsight" style="display: block; padding: 12px 20px; color: #333; text-decoration: none; border-bottom: 1px solid #eee;"><i class="fas fa-chart-line" style="margin-right: 10px; color: #2563eb;"></i>LendSight</a>
                <a href="/bizsight" class="nav-item" data-app="bizsight" style="display: block; padding: 12px 20px; color: #333; text-decoration: none; border-bottom: 1px solid #eee;"><i class="fas fa-briefcase" style="margin-right: 10px; color: #059669;"></i>BizSight</a>
                <a href="/branchsight" class="nav-item" data-app="branchseeker" style="display: block; padding: 12px 20px; color: #333; text-decoration: none; border-bottom: 1px solid #eee;"><i class="fas fa-building" style="margin-right: 10px; color: #7c3aed;"></i>BranchSight</a>
                <a href="/branchmapper" class="nav-item" data-app="branchmapper" style="display: block; padding: 12px 20px; color: #333; text-decoration: none; border-bottom: 1px solid #eee;"><i class="fas fa-map-marked-alt" style="margin-right: 10px; color: #0891b2;"></i>BranchMapper</a>
                <a href="/mergermeter" class="nav-item" data-app="mergermeter" style="display: block; padding: 12px 20px; color: #333; text-decoration: none; border-bottom: 1px solid #eee;"><i class="fas fa-exchange-alt" style="margin-right: 10px; color: #dc2626;"></i>MergerMeter</a>
                <a href="/dataexplorer" class="nav-item" data-app="dataexplorer" style="display: block; padding: 12px 20px; color: #333; text-decoration: none; border-bottom: 1px solid #eee;"><i class="fas fa-search" style="margin-right: 10px; color: #ca8a04;"></i>DataExplorer</a>
                <a href="/lenderprofile" class="nav-item" data-app="lenderprofile" style="display: block; padding: 12px 20px; color: #333; text-decoration: none; border-bottom: 1px solid #eee;"><i class="fas fa-university" style="margin-right: 10px; color: #be185d;"></i>LenderProfile</a>
                <a href="/electwatch" class="nav-item" data-app="electwatch" style="display: block; padding: 12px 20px; color: #333; text-decoration: none;"><i class="fas fa-landmark" style="margin-right: 10px; color: #4f46e5;"></i>ElectWatch</a>
            </nav>

        </div>
    </header>

    <!-- Slack Support Button Bar -->
    <div class="support-bar">
        <a href="#" id="slackSupportBtn" class="slack-support-btn" title="Get support via Slack" onclick="openSlackSupport(event)">
            <i class="fab fa-slack"></i>
            <span>Get Support</span>
        </a>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 100000; justify-content: center; align-items: center;">
        <div style="background: white; border-radius: 12px; padding: 32px; width: 100%; max-width: 400px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); position: relative;">
            <!-- Close button -->
            <button onclick="closeLoginModal()" style="position: absolute; top: 12px; right: 12px; background: none; border: none; font-size: 24px; cursor: pointer; color: #666; line-height: 1;">&times;</button>

            <!-- Header -->
            <div style="text-align: center; margin-bottom: 24px;">
                <img src="/static/img/justdata-logo.png" alt="JustData" style="max-height: 50px; margin-bottom: 12px;" onerror="this.style.display='none'">
                <h2 style="margin: 0; color: #1a365d; font-size: 24px;">Sign In to JustData</h2>
                <p style="margin: 8px 0 0; color: #666; font-size: 14px;">Access your account to continue</p>
            </div>

            <!-- Email/Password Form -->
            <form id="emailLoginForm" onsubmit="handleEmailLogin(event)" style="margin-bottom: 20px;">
                <div style="margin-bottom: 16px;">
                    <label for="loginEmail" style="display: block; margin-bottom: 6px; font-weight: 500; color: #333; font-size: 14px;">Email</label>
                    <input type="email" id="loginEmail" placeholder="Enter your email" required autocomplete="email" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 15px; box-sizing: border-box; transition: border-color 0.2s;" onfocus="this.style.borderColor='#1a365d'" onblur="this.style.borderColor='#ddd'">
                </div>
                <div style="margin-bottom: 20px;">
                    <label for="loginPassword" style="display: block; margin-bottom: 6px; font-weight: 500; color: #333; font-size: 14px;">Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter your password" required autocomplete="current-password" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 15px; box-sizing: border-box; transition: border-color 0.2s;" onfocus="this.style.borderColor='#1a365d'" onblur="this.style.borderColor='#ddd'">
                </div>
                <!-- Error message -->
                <div id="loginError" style="display: none; background: #fee2e2; color: #dc2626; padding: 10px 12px; border-radius: 6px; margin-bottom: 16px; font-size: 14px;"></div>
                <button type="submit" id="emailLoginBtn" style="width: 100%; padding: 12px; background: #1a365d; color: white; border: none; border-radius: 8px; font-size: 15px; font-weight: 600; cursor: pointer; transition: background 0.2s;">
                    <span id="emailLoginText">Sign In</span>
                    <span id="emailLoginSpinner" style="display: none;"><i class="fas fa-spinner fa-spin"></i> Signing in...</span>
                </button>
            </form>

            <!-- Divider -->
            <div style="display: flex; align-items: center; margin: 24px 0;">
                <div style="flex: 1; height: 1px; background: #ddd;"></div>
                <span style="padding: 0 16px; color: #999; font-size: 13px; font-weight: 500;">OR</span>
                <div style="flex: 1; height: 1px; background: #ddd;"></div>
            </div>

            <!-- Google Sign In -->
            <button onclick="handleGoogleLogin()" id="googleLoginBtn" style="width: 100%; padding: 12px; background: white; color: #333; border: 1px solid #ddd; border-radius: 8px; font-size: 15px; font-weight: 500; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; transition: background 0.2s, border-color 0.2s;" onmouseover="this.style.background='#f5f5f5'" onmouseout="this.style.background='white'">
                <svg width="18" height="18" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/></svg>
                <span id="googleLoginText">Continue with Google</span>
                <span id="googleLoginSpinner" style="display: none;"><i class="fas fa-spinner fa-spin"></i></span>
            </button>

            <!-- Footer note -->
            <p style="margin: 20px 0 0; text-align: center; color: #999; font-size: 12px;">
                By signing in, you agree to NCRC's Terms of Service
            </p>
        </div>
    </div>

    <div class="container">
        <div class="content-wrapper">
            <!-- Welcome Section -->
            <section class="welcome-section">
                <h1 class="welcome-greeting" id="welcomeGreeting">Welcome back</h1>
                <p class="welcome-subtext">Access your research and analysis tools below.</p>
            </section>

            <!-- Platform Stats Bar -->
            <section class="stats-bar" id="platformStats">
                <div class="stat-item">
                    <div class="stat-number" id="mortgageRecords">--</div>
                    <div class="stat-label">Mortgage Records Analyzed</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="lendersTracked">--</div>
                    <div class="stat-label">Lenders Tracked</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="reportsGenerated">--</div>
                    <div class="stat-label">Reports Generated</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="activeResearchers">--</div>
                    <div class="stat-label">Active Researchers</div>
                </div>
            </section>

            <main class="main-content" id="main-content" role="main">
                <!-- LENDING ANALYSIS Category -->
                <section class="category-section">
                    <h2 class="category-header">Lending Analysis</h2>
                    <div class="apps-grid">
                        <!-- LendSight Card -->
                        <div class="app-card" data-app="lendsight" onclick="handleInfoClick('LendSight')">
                            <h3 class="app-card-title">LendSight</h3>
                            <p class="app-card-description">
                                County-level mortgage lending analysis with disparity metrics and AI-generated narratives.
                            </p>
                            <div class="app-card-buttons">
                                <a href="/lendsight" class="app-card-launch-btn" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation()">
                                    Launch <i class="fas fa-arrow-right"></i>
                                </a>
                            </div>
                        </div>

                        <!-- BizSight Card -->
                        <div class="app-card" data-app="bizsight" onclick="handleInfoClick('BizSight')">
                            <h3 class="app-card-title">BizSight</h3>
                            <p class="app-card-description">
                                Small business lending patterns and CRA analysis across communities.
                            </p>
                            <div class="app-card-buttons">
                                <a href="/bizsight" class="app-card-launch-btn" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation()">
                                    Launch <i class="fas fa-arrow-right"></i>
                                </a>
                            </div>
                        </div>

                        <!-- DataExplorer Card -->
                        <div class="app-card" data-app="dataexplorer" onclick="handleInfoClick('DataExplorer')">
                            <h3 class="app-card-title">DataExplorer</h3>
                            <p class="app-card-description">
                                Full HMDA dataset exploration with custom filtering and comprehensive analysis.
                            </p>
                            <div class="app-card-buttons">
                                <a href="/dataexplorer" class="app-card-launch-btn" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation()">
                                    Launch <i class="fas fa-arrow-right"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- BRANCH & MERGER Category -->
                <section class="category-section">
                    <h2 class="category-header">Branch & Merger</h2>
                    <div class="apps-grid">
                        <!-- BranchSight Card -->
                        <div class="app-card" data-app="branchseeker" onclick="handleInfoClick('BranchSeeker')">
                            <h3 class="app-card-title">BranchSight</h3>
                            <p class="app-card-description">
                                Bank branch location analysis and market concentration using FDIC data.
                            </p>
                            <div class="app-card-buttons">
                                <a href="/branchsight" class="app-card-launch-btn" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation()">
                                    Launch <i class="fas fa-arrow-right"></i>
                                </a>
                            </div>
                        </div>

                        <!-- BranchMapper Card -->
                        <div class="app-card" data-app="branchmapper" onclick="handleInfoClick('BranchMapper')">
                            <h3 class="app-card-title">BranchMapper</h3>
                            <p class="app-card-description">
                                Interactive branch network mapping with demographic overlays.
                            </p>
                            <div class="app-card-buttons">
                                <a href="/branchmapper" class="app-card-launch-btn" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation()">
                                    Launch <i class="fas fa-arrow-right"></i>
                                </a>
                            </div>
                        </div>

                        <!-- MergerMeter Card -->
                        <div class="app-card" data-app="mergermeter" onclick="handleInfoClick('MergerMeter')">
                            <h3 class="app-card-title">MergerMeter</h3>
                            <p class="app-card-description">
                                Bank merger impact analysis on market concentration and community lending.
                            </p>
                            <div class="app-card-buttons">
                                <a href="/mergermeter" class="app-card-launch-btn" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation()">
                                    Launch <i class="fas fa-arrow-right"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- POLITICAL INFLUENCE Category -->
                <section class="category-section">
                    <h2 class="category-header">Political Influence</h2>
                    <div class="apps-grid">
                        <!-- ElectWatch Card -->
                        <div class="app-card" data-app="electwatch" onclick="handleInfoClick('ElectWatch')">
                            <h3 class="app-card-title">ElectWatch</h3>
                            <p class="app-card-description">
                                Congressional financial relationships and voting records on financial legislation.
                            </p>
                            <div class="app-card-buttons">
                                <a href="/electwatch" class="app-card-launch-btn" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation()">
                                    Launch <i class="fas fa-arrow-right"></i>
                                </a>
                            </div>
                        </div>

                        <!-- LenderProfile Card -->
                        <div class="app-card" data-app="lenderprofile" onclick="handleInfoClick('LenderProfile')">
                            <h3 class="app-card-title">LenderProfile</h3>
                            <p class="app-card-description">
                                Comprehensive lender intelligence combining corporate structure, compliance, and market position.
                            </p>
                            <div class="app-card-buttons">
                                <a href="/lenderprofile" class="app-card-launch-btn" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation()">
                                    Launch <i class="fas fa-arrow-right"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- TOOLS Category (Coming Soon) -->
                <section class="category-section">
                    <h2 class="category-header">Tools</h2>
                    <div class="apps-grid">
                        <!-- CommentMaker Card -->
                        <div class="app-card coming-soon" data-app="commentmaker" onclick="handleInfoClick('CommentMaker')">
                            <h3 class="app-card-title">CommentMaker</h3>
                            <p class="app-card-description">
                                Generate public comments for federal rulemakings with AI assistance.
                            </p>
                            <div class="app-card-buttons">
                                <button class="app-card-launch-btn" onclick="event.stopPropagation();">
                                    <i class="fas fa-clock"></i> Coming Soon
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- ADMIN Category -->
                <section class="category-section" id="adminSection" style="display: none;">
                    <h2 class="category-header">Admin <span class="category-note">Staff & above</span></h2>
                    <div class="apps-grid">
                        <!-- Analytics Card - visible to staff, senior_executive, admin -->
                        <div class="app-card" data-app="analytics" onclick="handleInfoClick('Analytics')">
                            <h3 class="app-card-title">Analytics</h3>
                            <p class="app-card-description">
                                User activity monitoring and application usage dashboards.
                            </p>
                            <div class="app-card-buttons">
                                <a href="/analytics" class="app-card-launch-btn" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation()">
                                    Launch <i class="fas fa-arrow-right"></i>
                                </a>
                            </div>
                        </div>

                        <!-- Administration Card - visible only to admin -->
                        <div class="app-card" data-app="admin" id="administrationCard" onclick="window.open('/admin/users', '_blank', 'noopener,noreferrer')">
                            <h3 class="app-card-title">Administration</h3>
                            <p class="app-card-description">
                                User management, accounts, and system integrations.
                            </p>
                            <div class="app-card-buttons">
                                <a href="/admin/users" class="app-card-launch-btn" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation()">
                                    Launch <i class="fas fa-arrow-right"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container" style="display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto; padding: 24px;">
            <!-- Left side: Copyright and links -->
            <div style="text-align: left;">
                <p style="margin: 0 0 8px 0; font-size: 13px; color: rgba(255,255,255,0.9);">&copy; 2026 National Community Reinvestment Coalition</p>
                <p style="margin: 0 0 8px 0; font-size: 11px; color: rgba(255,255,255,0.6);">JustData Platform v{{ platform_version }}</p>
                <div style="display: flex; gap: 16px; font-size: 13px;">
                    <a href="mailto:research@ncrc.org" style="color: #8bb8ff; text-decoration: none;">research@ncrc.org</a>
                    <span style="color: rgba(255,255,255,0.5);">|</span>
                    <a href="tel:+12024644600" style="color: #8bb8ff; text-decoration: none;">(202) 464-4600</a>
                    <span style="color: rgba(255,255,255,0.5);">|</span>
                    <a href="/privacy" style="color: #8bb8ff; text-decoration: none;">Privacy</a>
                    <span style="color: rgba(255,255,255,0.5);">|</span>
                    <a href="/terms" style="color: #8bb8ff; text-decoration: none;">Terms</a>
                </div>
                <p style="margin: 12px 0 0 0; font-size: 11px; color: rgba(255,255,255,0.6);">
                    Created by Jay Richardson &amp; Jad Edlebi
                </p>
            </div>
            <!-- Right side: NCRC Logo -->
            <div style="flex-shrink: 0;">
                <img src="/static/img/ncrc-logo-white.png" alt="NCRC" style="height: 50px; width: auto; opacity: 0.9;">
            </div>
        </div>
    </footer>

    <!-- Launch Modal -->
    <div class="modal-overlay" id="launchModal" role="dialog" aria-labelledby="launchModalTitle" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="launchModalTitle">
                    <i class="fas fa-rocket" aria-hidden="true"></i>
                    <span id="launchAppName">Application Features</span>
                </h3>
                <button class="modal-close" onclick="closeLaunchModal()" aria-label="Close launch modal">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div class="modal-body" id="launchModalBody">
                <!-- Content populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- App Info Modal -->
    <div class="modal-overlay" id="appInfoModal" role="dialog" aria-labelledby="appInfoModalTitle" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="appInfoModalTitle">
                    <i class="fas fa-info-circle" aria-hidden="true"></i>
                    <span id="appInfoName">Application Information</span>
                </h3>
                <button class="modal-close" onclick="closeAppInfoModal()" aria-label="Close app info modal">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div class="modal-body" id="appInfoModalBody">
                <!-- Content populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Expected Income & Sources Modal -->
    <div class="modal-overlay" id="incomeSourcesModal" role="dialog" aria-labelledby="incomeModalTitle" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="incomeModalTitle">
                    <i class="fas fa-dollar-sign" aria-hidden="true"></i>
                    Expected Income & Funding Sources
                </h3>
                <button class="modal-close" onclick="closeIncomeSourcesModal()" aria-label="Close income sources modal">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="feature-detail-section">
                    <h4><i class="fas fa-chart-line"></i> Revenue Projections</h4>
                    <p><strong>Annual Revenue Targets:</strong></p>
                    <ul style="margin: 10px 0; padding-left: 20px; color: var(--ncrc-gray-dark);">
                        <li><strong>Member Plus Add-ons:</strong> $500-750/year per member (premium features)</li>
                        <li><strong>Institutional Subscriptions:</strong> $5,000-15,000/year per organization</li>
                        <li><strong>Projected Year 2 Revenue:</strong> $50,000 - $100,000</li>
                        <li><strong>Projected Year 3 Revenue:</strong> $150,000 - $250,000</li>
                    </ul>
                </div>

                <div class="feature-detail-section">
                    <h4><i class="fas fa-hand-holding-usd"></i> Primary Funding Sources</h4>
                    <p><strong>Revenue Streams:</strong></p>
                    <ul style="margin: 10px 0; padding-left: 20px; color: var(--ncrc-gray-dark);">
                        <li><strong>NCRC Membership Integration:</strong> JustData access included with $900/year NCRC organizational membership</li>
                        <li><strong>Premium Tier Subscriptions:</strong> Member Plus ($500-750/year) and Institutional ($5K-15K/year) add-on subscriptions</li>
                        <li><strong>Grant Funding:</strong> Foundation grants supporting data transparency and community reinvestment initiatives</li>
                        <li><strong>Corporate Sponsorships:</strong> Financial institution partnerships and corporate social responsibility programs</li>
                        <li><strong>Federal/State Contracts:</strong> Government contracts for data analysis and reporting services</li>
                    </ul>
                </div>

                <div class="feature-detail-section">
                    <h4><i class="fas fa-building"></i> Institutional Partnerships</h4>
                    <p><strong>Target Markets:</strong></p>
                    <ul style="margin: 10px 0; padding-left: 20px; color: var(--ncrc-gray-dark);">
                        <li><strong>Community Development Organizations:</strong> CDFIs, housing counseling agencies, and advocacy groups</li>
                        <li><strong>Financial Institutions:</strong> Banks, credit unions, and fintech companies seeking market analysis</li>
                        <li><strong>Consulting Firms:</strong> Fair lending consultants and compliance advisors</li>
                        <li><strong>Academic Institutions:</strong> Universities and research organizations</li>
                        <li><strong>Government Agencies:</strong> Federal and state regulatory agencies</li>
                    </ul>
                </div>

                <div class="feature-detail-section">
                    <h4><i class="fas fa-seedling"></i> Growth Strategy</h4>
                    <p><strong>Expansion Plans:</strong></p>
                    <ul style="margin: 10px 0; padding-left: 20px; color: var(--ncrc-gray-dark);">
                        <li><strong>Year 1:</strong> Focus on NCRC member base conversion and platform stabilization (target: 50-100 active users)</li>
                        <li><strong>Year 2:</strong> Expand to non-member organizations and institutional clients (target: 10-20 institutional subscriptions)</li>
                        <li><strong>Year 3:</strong> Scale premium features and add new data sources (target: 200-300 total users)</li>
                        <li><strong>Long-term:</strong> Develop API access, white-label solutions, and custom enterprise packages</li>
                    </ul>
                </div>

                <div class="feature-detail-section">
                    <h4><i class="fas fa-code-branch"></i> Applications in Development</h4>
                    <p><strong>AI-Driven Reports (Coming Soon):</strong></p>
                    <ul style="margin: 10px 0; padding-left: 20px; color: var(--ncrc-gray-dark);">
                        <li><strong>CommentMaker:</strong> Free tool for writing and submitting public comments to federal regulatory agencies. Will be available to all users when released.</li>
                        <li><strong>JustPolicy:</strong> AI-driven interactive tool that asks questions about your mission and service area to provide personalized policy overviews scaled to your niche, with plain-language explanations and supporting data. Will be available to all users when released.</li>
                    </ul>
                    <p class="feature-note">These applications are currently in development and will be released in future updates. Check back for availability announcements.</p>
                </div>

                <div class="upgrade-notice">
                    <h4><i class="fas fa-info-circle"></i> Sustainability Model</h4>
                    <p>JustData is designed to be self-sustaining through subscription revenue while maintaining free access to core tools like CommentMaker and JustPolicy (coming soon). Premium features and advanced analytics support the platform's development and maintenance costs.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- User Types Modal -->
    <div class="modal-overlay" id="userTypesModal" role="dialog" aria-labelledby="modalTitle" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">
                    <i class="fas fa-users-cog" aria-hidden="true"></i>
                    User Access Matrix
                </h3>
                <button class="modal-close" onclick="closeUserTypesModal()" aria-label="Close user types modal">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 20px; color: var(--ncrc-gray);">
                    This table shows which applications are accessible to each user type. 
                    <strong> Full Access</strong> means the user can use the application with all features (multiple counties/metro areas, exports). 
                    <strong> Partial Access</strong> means the user can view reports but cannot export and is limited to their own county or single counties. 
                    <strong> Visible (Locked)</strong> means the app is visible but requires membership. 
                    <strong> Hidden</strong> means the app is not visible to that user type.
                </p>
                <table class="access-matrix-table">
                    <thead>
                        <tr>
                            <th>Application</th>
                            <th>Public<br><small>(Free)</small></th>
                            <th>Just Economy Club<br><small>(Free)</small></th>
                            <th>Member<br><small>($900/yr*)</small></th>
                            <th>Member Plus<br><small>($500-750/yr)</small></th>
                            <th>Institutional<br><small>($5K-15K/yr)</small></th>
                            <th>Staff<br><small>(Free)</small></th>
                            <th>Admin<br><small>(Free)</small></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>AI-Driven Reports</strong></td>
                            <td colspan="7" style="text-align: center; background: var(--ncrc-light-blue); font-weight: 600; color: var(--ncrc-primary-blue);">AI-Driven Reports</td>
                        </tr>
                        <tr>
                            <td>LendSight</td>
                            <td><span class="access-status access-partial"><i class="fas fa-check-circle access-icon" aria-hidden="true"></i>Limited</span></td>
                            <td><span class="access-status access-partial"><i class="fas fa-check-circle access-icon" aria-hidden="true"></i>Limited</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                        </tr>
                        <tr>
                            <td>BranchSeeker</td>
                            <td><span class="access-status access-locked"><i class="fas fa-lock access-icon" aria-hidden="true"></i>Locked</span></td>
                            <td><span class="access-status access-locked"><i class="fas fa-lock access-icon" aria-hidden="true"></i>Locked</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                        </tr>
                        <tr>
                            <td>BizSight</td>
                            <td><span class="access-status access-locked"><i class="fas fa-lock access-icon" aria-hidden="true"></i>Locked</span></td>
                            <td><span class="access-status access-locked"><i class="fas fa-lock access-icon" aria-hidden="true"></i>Locked</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                        </tr>
                        <tr>
                            <td>CommentMaker <span style="background: #ff9800; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.7rem; font-weight: 600; margin-left: 8px;">In Development</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                        </tr>
                        <tr>
                            <td>JustPolicy <span style="background: #ff9800; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.7rem; font-weight: 600; margin-left: 8px;">In Development</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                        </tr>
                        <tr>
                            <td>LenderProfile</td>
                            <td><span class="access-status access-hidden"><i class="fas fa-eye-slash access-icon" aria-hidden="true"></i>Hidden</span></td>
                            <td><span class="access-status access-hidden"><i class="fas fa-eye-slash access-icon" aria-hidden="true"></i>Hidden</span></td>
                            <td><span class="access-status access-hidden"><i class="fas fa-eye-slash access-icon" aria-hidden="true"></i>Hidden</span></td>
                            <td><span class="access-status access-hidden"><i class="fas fa-eye-slash access-icon" aria-hidden="true"></i>Hidden</span></td>
                            <td><span class="access-status access-hidden"><i class="fas fa-eye-slash access-icon" aria-hidden="true"></i>Hidden</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                        </tr>
                        <tr>
                            <td>MergerMeter</td>
                            <td><span class="access-status access-hidden"><i class="fas fa-eye-slash access-icon" aria-hidden="true"></i>Hidden</span></td>
                            <td><span class="access-status access-hidden"><i class="fas fa-eye-slash access-icon" aria-hidden="true"></i>Hidden</span></td>
                            <td><span class="access-status access-hidden"><i class="fas fa-eye-slash access-icon" aria-hidden="true"></i>Hidden</span></td>
                            <td><span class="access-status access-hidden"><i class="fas fa-eye-slash access-icon" aria-hidden="true"></i>Hidden</span></td>
                            <td><span class="access-status access-hidden"><i class="fas fa-eye-slash access-icon" aria-hidden="true"></i>Hidden</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                        </tr>
                        <tr>
                            <td>ElectWatch</td>
                            <td><span class="access-status access-hidden"><i class="fas fa-eye-slash access-icon" aria-hidden="true"></i>Hidden</span></td>
                            <td><span class="access-status access-hidden"><i class="fas fa-eye-slash access-icon" aria-hidden="true"></i>Hidden</span></td>
                            <td><span class="access-status access-hidden"><i class="fas fa-eye-slash access-icon" aria-hidden="true"></i>Hidden</span></td>
                            <td><span class="access-status access-hidden"><i class="fas fa-eye-slash access-icon" aria-hidden="true"></i>Hidden</span></td>
                            <td><span class="access-status access-hidden"><i class="fas fa-eye-slash access-icon" aria-hidden="true"></i>Hidden</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                        </tr>
                        <tr>
                            <td><strong>Interactive Tools</strong></td>
                            <td colspan="7" style="text-align: center; background: var(--ncrc-light-blue); font-weight: 600; color: var(--ncrc-primary-blue);">Interactive Tools</td>
                        </tr>
                        <tr>
                            <td>BranchMapper</td>
                            <td><span class="access-status access-locked"><i class="fas fa-lock access-icon" aria-hidden="true"></i>Locked</span></td>
                            <td><span class="access-status access-locked"><i class="fas fa-lock access-icon" aria-hidden="true"></i>Locked</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                        </tr>
                        <tr>
                            <td>DataExplorer</td>
                            <td><span class="access-status access-locked"><i class="fas fa-lock access-icon" aria-hidden="true"></i>Locked</span></td>
                            <td><span class="access-status access-locked"><i class="fas fa-lock access-icon" aria-hidden="true"></i>Locked</span></td>
                            <td><span class="access-status access-locked"><i class="fas fa-lock access-icon" aria-hidden="true"></i>Locked</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full**</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                        </tr>
                        <tr>
                            <td><strong>Administrative</strong></td>
                            <td colspan="7" style="text-align: center; background: var(--ncrc-light-blue); font-weight: 600; color: var(--ncrc-primary-blue);">Administrative</td>
                        </tr>
                        <tr>
                            <td>Analytics</td>
                            <td><span class="access-status access-hidden"><i class="fas fa-eye-slash access-icon" aria-hidden="true"></i>Hidden</span></td>
                            <td><span class="access-status access-hidden"><i class="fas fa-eye-slash access-icon" aria-hidden="true"></i>Hidden</span></td>
                            <td><span class="access-status access-hidden"><i class="fas fa-eye-slash access-icon" aria-hidden="true"></i>Hidden</span></td>
                            <td><span class="access-status access-hidden"><i class="fas fa-eye-slash access-icon" aria-hidden="true"></i>Hidden</span></td>
                            <td><span class="access-status access-hidden"><i class="fas fa-eye-slash access-icon" aria-hidden="true"></i>Hidden</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                        </tr>
                        <tr>
                            <td>Administration</td>
                            <td><span class="access-status access-hidden"><i class="fas fa-eye-slash access-icon" aria-hidden="true"></i>Hidden</span></td>
                            <td><span class="access-status access-hidden"><i class="fas fa-eye-slash access-icon" aria-hidden="true"></i>Hidden</span></td>
                            <td><span class="access-status access-hidden"><i class="fas fa-eye-slash access-icon" aria-hidden="true"></i>Hidden</span></td>
                            <td><span class="access-status access-hidden"><i class="fas fa-eye-slash access-icon" aria-hidden="true"></i>Hidden</span></td>
                            <td><span class="access-status access-hidden"><i class="fas fa-eye-slash access-icon" aria-hidden="true"></i>Hidden</span></td>
                            <td><span class="access-status access-hidden"><i class="fas fa-eye-slash access-icon" aria-hidden="true"></i>Hidden</span></td>
                            <td><span class="access-status access-full"><i class="fas fa-check access-icon" aria-hidden="true"></i>Full</span></td>
                        </tr>
                    </tbody>
                </table>
                <div style="margin-top: 20px; padding: 15px; background: var(--ncrc-light-blue); border-radius: 8px; font-size: 0.9rem; color: var(--ncrc-gray);">
                    <p style="margin: 0 0 10px 0;"><strong>Pricing Notes:</strong></p>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li><strong>Public & Just Economy Club (Free):</strong> Limited access to LendSight (own county only, view-only, no exports). CommentMaker (AI-Driven Reports, in development) will be available to all users with full access when released.</li>
                        <li><strong>Member ($900/yr*):</strong> Included with NCRC membership. Full access to all apps except DataExplorer. Up to 3 counties/metro areas. Exports: Excel, PDF, PowerPoint. Access to CommentMaker (AI-Driven Reports, in development) when released.</li>
                        <li><strong>Member Plus ($500-750/yr):</strong> Add-on to Member tier. Unlocks DataExplorer with enhanced features. 5+ counties or unlimited geography.</li>
                        <li><strong>Institutional ($5K-15K/yr):</strong> Base tier ($5K) includes standard DataExplorer. Premium tier ($10K-15K) includes enhanced DataExplorer features. Unlimited geography. CSV exports included.</li>
                        <li><strong>Staff & Admin (Free):</strong> Included with NCRC employment. Full access to all features and formats.</li>
                    </ul>
                    <p style="margin: 10px 0 0 0;"><strong>*</strong> Member tier price: Included with $900/year NCRC membership (no additional cost)</p>
                    <p style="margin: 10px 0 0 0;"><strong>**</strong> Member Plus DataExplorer includes enhanced features: advanced filtering, bulk exports, custom reports, historical data, priority support</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Toggle hamburger navigation menu
        function toggleNavMenu() {
            const menu = document.getElementById('navMenu');
            if (menu.style.display === 'none' || menu.style.display === '') {
                menu.style.display = 'block';
            } else {
                menu.style.display = 'none';
            }
        }
        
        // Close menu when clicking outside
        document.addEventListener('click', function(event) {
            const menu = document.getElementById('navMenu');
            const hamburger = document.querySelector('.hamburger-menu');
            if (menu && hamburger && !menu.contains(event.target) && !hamburger.contains(event.target)) {
                menu.style.display = 'none';
            }
        });

        // Slack Support Button
        function openSlackSupport(event) {
            event.preventDefault();
            const currentUserType = document.getElementById('userTypeSelect').value;
            const isInternalUser = ['staff', 'senior_executive', 'admin'].includes(currentUserType);

            // Staff channel for internal users, public support channel for everyone else
            const slackChannelUrl = isInternalUser
                ? 'https://ncrcgroup.slack.com/archives/C0A0BBWRT36'  // justdata_staff
                : 'https://ncrcgroup.slack.com/archives/C0AAHCK98A0'; // public support

            window.open(slackChannelUrl, '_blank');
        }

        // Login Modal Functions
        function openLoginModal() {
            document.getElementById('loginModal').style.display = 'flex';
            document.getElementById('loginEmail').focus();
            // Clear any previous errors
            document.getElementById('loginError').style.display = 'none';
            document.getElementById('loginEmail').value = '';
            document.getElementById('loginPassword').value = '';
        }

        function closeLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
        }

        // Close modal on background click
        document.getElementById('loginModal')?.addEventListener('click', function(e) {
            if (e.target === this) closeLoginModal();
        });

        // Close modal on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && document.getElementById('loginModal').style.display === 'flex') {
                closeLoginModal();
            }
        });

        // Handle email/password login
        async function handleEmailLogin(event) {
            event.preventDefault();

            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');
            const loginText = document.getElementById('emailLoginText');
            const loginSpinner = document.getElementById('emailLoginSpinner');
            const loginBtn = document.getElementById('emailLoginBtn');

            // Show loading state
            loginText.style.display = 'none';
            loginSpinner.style.display = 'inline';
            loginBtn.disabled = true;
            errorDiv.style.display = 'none';

            try {
                await JustDataAuth.signInWithEmail(email, password);
                closeLoginModal();
                // Page will update via auth state change handler
            } catch (error) {
                console.error('Email login error:', error);

                // Show user-friendly error messages
                let errorMessage = 'Sign in failed. Please try again.';
                switch (error.code) {
                    case 'auth/user-not-found':
                        errorMessage = 'No account found with this email address.';
                        break;
                    case 'auth/wrong-password':
                        errorMessage = 'Incorrect password. Please try again.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Please enter a valid email address.';
                        break;
                    case 'auth/user-disabled':
                        errorMessage = 'This account has been disabled. Contact support.';
                        break;
                    case 'auth/too-many-requests':
                        errorMessage = 'Too many failed attempts. Please try again later.';
                        break;
                    case 'auth/invalid-credential':
                        errorMessage = 'Invalid email or password. Please check and try again.';
                        break;
                }

                errorDiv.textContent = errorMessage;
                errorDiv.style.display = 'block';
            } finally {
                // Reset loading state
                loginText.style.display = 'inline';
                loginSpinner.style.display = 'none';
                loginBtn.disabled = false;
            }
        }

        // Handle Google login from modal
        async function handleGoogleLogin() {
            const loginText = document.getElementById('googleLoginText');
            const loginSpinner = document.getElementById('googleLoginSpinner');
            const loginBtn = document.getElementById('googleLoginBtn');
            const errorDiv = document.getElementById('loginError');

            // Show loading state
            loginText.style.display = 'none';
            loginSpinner.style.display = 'inline';
            loginBtn.disabled = true;
            errorDiv.style.display = 'none';

            try {
                await JustDataAuth.signInWithGoogle();
                closeLoginModal();
            } catch (error) {
                // Only show error if it wasn't user-cancelled
                if (error.code !== 'auth/popup-closed-by-user' && error.code !== 'auth/cancelled-popup-request') {
                    errorDiv.textContent = 'Google sign-in failed. Please try again.';
                    errorDiv.style.display = 'block';
                }
            } finally {
                // Reset loading state
                loginText.style.display = 'inline';
                loginSpinner.style.display = 'none';
                loginBtn.disabled = false;
            }
        }

        // User Access Configuration (9 user types)
        const appAccessConfig = {
            'lendsight': {
                public_anonymous: 'locked',
                public_registered: 'limited',
                just_economy_club: 'limited',
                member: 'full',
                member_premium: 'full',
                non_member_org: 'full',
                staff: 'full',
                senior_executive: 'full',
                admin: 'full'
            },
            'branchseeker': {
                public_anonymous: 'locked',
                public_registered: 'locked',
                just_economy_club: 'limited',
                member: 'full',
                member_premium: 'full',
                non_member_org: 'full',
                staff: 'full',
                senior_executive: 'full',
                admin: 'full'
            },
            'branchmapper': {
                public_anonymous: 'locked',
                public_registered: 'locked',
                just_economy_club: 'locked',
                member: 'full',
                member_premium: 'full',
                non_member_org: 'full',
                staff: 'full',
                senior_executive: 'full',
                admin: 'full'
            },
            'bizsight': {
                public_anonymous: 'locked',
                public_registered: 'locked',
                just_economy_club: 'limited',
                member: 'full',
                member_premium: 'full',
                non_member_org: 'full',
                staff: 'full',
                senior_executive: 'full',
                admin: 'full'
            },
            'commentmaker': {
                public_anonymous: 'full',
                public_registered: 'full',
                just_economy_club: 'full',
                member: 'full',
                member_premium: 'full',
                non_member_org: 'full',
                staff: 'full',
                senior_executive: 'full',
                admin: 'full'
            },
            'justpolicy': {
                public_anonymous: 'full',
                public_registered: 'full',
                just_economy_club: 'full',
                member: 'full',
                member_premium: 'full',
                non_member_org: 'full',
                staff: 'full',
                senior_executive: 'full',
                admin: 'full'
            },
            'dataexplorer': {
                public_anonymous: 'locked',
                public_registered: 'locked',
                just_economy_club: 'locked',
                member: 'locked',
                member_premium: 'full',
                non_member_org: 'full',
                staff: 'full',
                senior_executive: 'full',
                admin: 'full'
            },
            'mergermeter': {
                public_anonymous: 'hidden',
                public_registered: 'hidden',
                just_economy_club: 'hidden',
                member: 'hidden',
                member_premium: 'hidden',
                non_member_org: 'hidden',
                staff: 'full',
                senior_executive: 'full',
                admin: 'full'
            },
            'lenderprofile': {
                public_anonymous: 'hidden',
                public_registered: 'hidden',
                just_economy_club: 'hidden',
                member: 'hidden',
                member_premium: 'hidden',
                non_member_org: 'hidden',
                staff: 'full',
                senior_executive: 'full',
                admin: 'full'
            },
            'analytics': {
                public_anonymous: 'hidden',
                public_registered: 'hidden',
                just_economy_club: 'hidden',
                member: 'hidden',
                member_premium: 'hidden',
                non_member_org: 'hidden',
                staff: 'full',
                senior_executive: 'full',
                admin: 'full'
            },
            'admin': {
                public_anonymous: 'hidden',
                public_registered: 'hidden',
                just_economy_club: 'hidden',
                member: 'hidden',
                member_premium: 'hidden',
                non_member_org: 'hidden',
                staff: 'hidden',
                senior_executive: 'hidden',
                admin: 'full'
            },
            'electwatch': {
                public_anonymous: 'hidden',
                public_registered: 'hidden',
                just_economy_club: 'hidden',
                member: 'hidden',
                member_premium: 'hidden',
                non_member_org: 'hidden',
                staff: 'full',
                senior_executive: 'full',
                admin: 'full'
            }
        };

        // App URLs - Render test deployment URLs
        const appUrls = {
            'commentmaker': 'https://commentmaker.onrender.com',
            'lendsight': '/lendsight',
            'bizsight': '/bizsight',
            'branchmapper': '/branchmapper',
            'branchseeker': '/branchsight',
                'dataexplorer': '/dataexplorer',
            'mergermeter': '/mergermeter',
            'lenderprofile': '/lenderprofile'
        };

        // Feature Permissions by User Type (9 types)
        const featurePermissions = {
            'public_anonymous': {
                geographicLimit: 'none',
                canExport: false,
                exportFormats: [],
                price: 'Free (Guest)'
            },
            'public_registered': {
                geographicLimit: 'own_county_only',
                canExport: false,
                exportFormats: [],
                price: 'Free (Registered)'
            },
            'just_economy_club': {
                geographicLimit: 'own_county_only',
                canExport: false,
                exportFormats: [],
                price: 'Free'
            },
            'member': {
                geographicLimit: 'up_to_3_counties',
                canExport: true,
                exportFormats: ['excel', 'powerpoint', 'pdf'],
                price: 'Included with $900/yr NCRC membership'
            },
            'member_premium': {
                geographicLimit: '5_plus_counties',
                canExport: true,
                exportFormats: ['excel', 'powerpoint', 'pdf', 'csv'],
                price: '$500-750/year (add-on)'
            },
            'non_member_org': {
                geographicLimit: 'unlimited',
                canExport: true,
                exportFormats: ['excel', 'powerpoint', 'pdf', 'csv'],
                price: '$5,000-15,000/year'
            },
            'staff': {
                geographicLimit: 'unlimited',
                canExport: true,
                exportFormats: ['excel', 'powerpoint', 'pdf', 'csv', 'json'],
                price: 'Included with employment'
            },
            'senior_executive': {
                geographicLimit: 'unlimited',
                canExport: true,
                exportFormats: ['excel', 'powerpoint', 'pdf', 'csv', 'json'],
                executiveTools: true,
                price: 'N/A (internal)'
            },
            'admin': {
                geographicLimit: 'unlimited',
                canExport: true,
                exportFormats: ['excel', 'powerpoint', 'pdf', 'csv', 'json'],
                executiveTools: true,
                adminAccess: true,
                price: 'N/A (internal)'
            }
        };

        // Switch user type and update app visibility
        function switchUserType(userType) {
            // Update all app cards based on user type
            Object.keys(appAccessConfig).forEach(appKey => {
                const card = document.querySelector(`.app-card[data-app="${appKey}"]`);
                if (!card) return;

                const access = appAccessConfig[appKey][userType];
                
                // Remove all state classes
                card.classList.remove('app-locked', 'app-hidden');
                
                // Remove lock overlay if it exists
                const existingOverlay = card.querySelector('.lock-overlay');
                if (existingOverlay) {
                    existingOverlay.remove();
                }

                if (access === 'hidden' || access === undefined) {
                    // Hide the app completely
                    card.classList.add('app-hidden');
                    card.style.display = 'none';
                    card.style.visibility = 'hidden';
                    return; // Exit early for hidden cards
                } else if (access === 'locked') {
                    // Show but lock the app
                    card.classList.add('app-locked');
                    card.style.display = 'block';
                    card.style.visibility = 'visible';
                    
                    // Add lock overlay
                    const lockOverlay = document.createElement('div');
                    lockOverlay.className = 'lock-overlay';
                    let lockMessage = 'NCRC organizational members only';
                    if (appKey === 'lendsight') {
                        lockMessage = 'Free registration required';
                    } else if (appKey === 'dataexplorer') {
                        lockMessage = 'Member Plus or Institutional tier required';
                    }
                    lockOverlay.innerHTML = `
                        <i class="fas fa-lock"></i>
                        <p>${lockMessage}</p>
                    `;
                    card.appendChild(lockOverlay);
                    
                    // Disable click functionality - replace with locked handler
                    card.onclick = function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        let message = 'This application is available to NCRC organizational members only. Please sign up or log in as a member to access.';
                        if (appKey === 'lendsight') {
                            message = 'LendSight requires a free account. Please sign up or log in to access.';
                        } else if (appKey === 'dataexplorer') {
                            message = 'DataExplorer is a premium feature. Upgrade to Member Plus ($500-750/year) or Institutional tier ($5K-15K/year) to access.';
                        }
                        alert(message);
                        return false;
                    };
                    card.onkeydown = function(e) {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            let message = 'This application is available to NCRC organizational members only. Please sign up or log in as a member to access.';
                            if (appKey === 'lendsight') {
                                message = 'LendSight requires a free account. Please sign up or log in to access.';
                            } else if (appKey === 'dataexplorer') {
                                message = 'DataExplorer is a premium feature. Upgrade to Member Plus ($500-750/year) or Institutional tier ($5K-15K/year) to access.';
                            }
                            alert(message);
                        }
                        return false;
                    };
                } else if (access === 'limited') {
                    // Limited access (for Status - Staff can see but with restrictions)
                    card.style.display = 'block';
                    card.style.visibility = 'visible';
                    // Don't add card-level click handlers - buttons handle interactions
                    // Status will handle limited access internally
                } else {
                    // Full access - show normally
                    card.style.display = 'block';
                    card.style.visibility = 'visible';
                    // Don't add card-level click handlers - buttons handle interactions
                }
            });

            // Update page title based on visible apps
            const visibleApps = document.querySelectorAll('.app-card:not(.app-hidden)').length;
            const titleP = document.querySelector('.page-title p');
            if (titleP) {
                titleP.textContent = "Select an application to begin your data analysis";
            }

            // Update hamburger nav menu visibility based on user type
            document.querySelectorAll('#navMenu .nav-item').forEach(item => {
                const appKey = item.getAttribute('data-app');
                if (appKey === 'home') {
                    item.style.display = 'block'; // Home always visible
                    return;
                }
                const access = appAccessConfig[appKey];
                if (!access || access[userType] === 'hidden') {
                    item.style.display = 'none';
                } else if (access[userType] === 'locked') {
                    item.style.display = 'flex';
                    item.style.alignItems = 'center';
                    item.style.opacity = '0.75';
                    // Add lock icon if not present
                    if (!item.querySelector('.nav-lock-icon')) {
                        const lockIcon = document.createElement('i');
                        lockIcon.className = 'fas fa-lock nav-lock-icon';
                        lockIcon.style.cssText = 'margin-left: auto; color: #999; font-size: 0.8rem;';
                        item.appendChild(lockIcon);
                    }
                } else {
                    item.style.display = 'block';
                    item.style.opacity = '1';
                    // Remove lock icon if present
                    const lockIcon = item.querySelector('.nav-lock-icon');
                    if (lockIcon) lockIcon.remove();
                }
            });

            // Show/hide admin buttons based on user type (only senior_executive and admin can see)
            const adminButtonsContainer = document.getElementById('adminButtonsContainer');
            if (adminButtonsContainer) {
                if (userType === 'admin' || userType === 'senior_executive') {
                    adminButtonsContainer.style.display = 'flex';
                } else {
                    adminButtonsContainer.style.display = 'none';
                }
            }
        }

        // Handle card clicks
        function handleCardClick(appName) {
            // Special handling for Analytics and Admin - show info modal instead of navigating
            if (appName === 'Analytics' || appName === 'Administration' || appName === 'Admin') {
                handleInfoClick(appName);
                return;
            }
            
            // Show launch modal with feature details
            showLaunchModal(appName);
        }

        // Show launch modal with feature details based on current user type
        function showLaunchModal(appName) {
            const currentUserType = document.getElementById('userTypeSelect').value;
            const permissions = featurePermissions[currentUserType] || featurePermissions['public'];
            const modal = document.getElementById('launchModal');
            const modalTitle = document.getElementById('launchAppName');
            const modalBody = document.getElementById('launchModalBody');
            
            modalTitle.textContent = appName + ' - Available Features';
            
            let content = '';
            
            // Special handling for CommentMaker - it doesn't use geographic restrictions or exports
            if (appName === 'CommentMaker') {
                content += `
                    <div class="feature-detail-section">
                        <h4><i class="fas fa-comments"></i> How CommentMaker Works</h4>
                        <p><strong>Create Your Unique Comment Letter:</strong> CommentMaker helps you write and submit public comments to federal regulatory agencies without using complex forms.</p>
                        <p>Simply enter your personal information, and CommentMaker will generate a unique, personalized comment letter that includes NCRC's key policy points.</p>
                    </div>
                    
                    <div class="feature-detail-section">
                        <h4><i class="fas fa-user-edit"></i> Personal Information</h4>
                        <p>You'll be asked to provide basic information such as:</p>
                        <ul style="margin: 10px 0; padding-left: 20px; color: var(--ncrc-gray-dark);">
                            <li>Your name and contact information</li>
                            <li>Your organization (if applicable)</li>
                            <li>Your location</li>
                            <li>Any specific concerns or experiences you'd like to include</li>
                        </ul>
                    </div>
                    
                    <div class="feature-detail-section">
                        <h4><i class="fas fa-file-alt"></i> Generated Comment Letter</h4>
                        <p>CommentMaker creates a unique comment letter that:</p>
                        <ul style="margin: 10px 0; padding-left: 20px; color: var(--ncrc-gray-dark);">
                            <li>Includes NCRC's key policy points and recommendations</li>
                            <li>Personalizes the content with your information</li>
                            <li>Formats it properly for federal agency submission</li>
                            <li>Is ready to copy and paste into the Federal Register comment system</li>
                        </ul>
                    </div>
                    
                    <div class="feature-detail-section">
                        <h4><i class="fas fa-paper-plane"></i> Submission to Federal Register</h4>
                        <p>Once you have your generated comment letter, you can:</p>
                        <ul style="margin: 10px 0; padding-left: 20px; color: var(--ncrc-gray-dark);">
                            <li>Copy the text directly from CommentMaker</li>
                            <li>Paste it into the Federal Register comment form</li>
                            <li>Submit your comment to agencies like CFPB, FDIC, OCC, or the Federal Reserve</li>
                        </ul>
                        <p class="feature-note">No need to navigate complex agency forms - CommentMaker does the heavy lifting for you!</p>
                    </div>
                    
                    <div class="feature-detail-section">
                        <h4><i class="fas fa-unlock"></i> Available to Everyone</h4>
                        <p><strong>Free for All Users:</strong> CommentMaker is available to everyone - no membership or subscription required. This tool helps amplify community voices in federal rulemaking processes.</p>
                    </div>
                `;
                
                modalBody.innerHTML = content;
                modal.classList.add('active');
                modal.setAttribute('aria-hidden', 'false');
                document.body.style.overflow = 'hidden';
                
                // Focus on close button for accessibility
                setTimeout(() => {
                    modal.querySelector('.modal-close').focus();
                }, 100);
                return;
            }
            
            // Geographic limits
            if (permissions.geographicLimit === 'own_county_only') {
                content += `
                    <div class="feature-detail-section">
                        <h4><i class="fas fa-map-marker-alt"></i> Geographic Selection</h4>
                        <p><strong>Your County Only:</strong> You can only analyze data for the county in which you are located.</p>
                        <p class="feature-note">Reports will focus on your home county with detailed analysis. You cannot select other counties.</p>
                    </div>
                `;
            } else if (permissions.geographicLimit === 'single_county') {
                content += `
                    <div class="feature-detail-section">
                        <h4><i class="fas fa-map-marker-alt"></i> Geographic Selection</h4>
                        <p><strong>Single County Only:</strong> You can analyze data for one county at a time.</p>
                        <p class="feature-note">Reports will focus on a single county with detailed analysis.</p>
                    </div>
                `;
            } else if (permissions.geographicLimit === 'up_to_3_counties') {
                content += `
                    <div class="feature-detail-section">
                        <h4><i class="fas fa-map-marker-alt"></i> Geographic Selection</h4>
                        <p><strong>Up to 3 Counties/Metro Areas:</strong> You can select up to 3 counties or metro areas for analysis.</p>
                        <p class="feature-note">Reports will include separate sections for each selected geographic area, allowing for comparative analysis.</p>
                    </div>
                `;
            } else if (permissions.geographicLimit === '5_plus_counties') {
                content += `
                    <div class="feature-detail-section">
                        <h4><i class="fas fa-map-marker-alt"></i> Geographic Selection</h4>
                        <p><strong>5+ Counties or Unlimited:</strong> You can select 5 or more counties or unlimited geographic areas for analysis.</p>
                        <p class="feature-note">Reports will include separate sections for each selected geographic area, allowing for comprehensive comparative analysis.</p>
                    </div>
                `;
            } else if (permissions.geographicLimit === 'multiple_counties') {
                content += `
                    <div class="feature-detail-section">
                        <h4><i class="fas fa-map-marker-alt"></i> Geographic Selection</h4>
                        <p><strong>Multiple Counties & Metro Areas:</strong> You can select multiple counties or entire metro areas for analysis.</p>
                        <p class="feature-note">Reports will include separate sections for each selected geographic area, allowing for comparative analysis.</p>
                    </div>
                `;
            } else {
                content += `
                    <div class="feature-detail-section">
                        <h4><i class="fas fa-map-marker-alt"></i> Geographic Selection</h4>
                        <p><strong>Unlimited:</strong> You can analyze any geographic combination.</p>
                        <p class="feature-note">Full access to all geographic analysis options.</p>
                    </div>
                `;
            }
            
            // Export capabilities
            if (permissions.canExport && permissions.exportFormats.length > 0) {
                content += `
                    <div class="feature-detail-section">
                        <h4><i class="fas fa-download"></i> Export Options</h4>
                        <p><strong>Available Formats:</strong></p>
                        <ul class="export-formats-list">
                            ${permissions.exportFormats.map(format => `
                                <li><i class="fas fa-file-${format === 'excel' ? 'excel' : format === 'powerpoint' ? 'powerpoint' : format === 'pdf' ? 'pdf' : format === 'csv' ? 'file-csv' : 'code'}"></i> ${format.toUpperCase()}</li>
                            `).join('')}
                        </ul>
                        <p class="feature-note">You can export your analysis results in the formats listed above.</p>
                    </div>
                `;
            } else {
                content += `
                    <div class="feature-detail-section">
                        <h4><i class="fas fa-download"></i> Export Options</h4>
                        <p><strong>No Export Available:</strong> Export functionality is not available for your account type.</p>
                        <p class="feature-note">You can view reports online but cannot download or export data.</p>
                    </div>
                `;
            }
            
            // Additional app-specific features
            content += `
                <div class="feature-detail-section">
                    <h4><i class="fas fa-chart-bar"></i> Analysis Features</h4>
                    <p>Access to comprehensive data analysis tools, interactive visualizations, and detailed reporting capabilities.</p>
                </div>
            `;
            
            // Add pricing information
            content += `
                <div class="feature-detail-section">
                    <h4><i class="fas fa-dollar-sign"></i> Pricing</h4>
                    <p><strong>Your Account Type:</strong> ${permissions.price}</p>
                </div>
            `;
            
            // User type specific notes
            if (currentUserType === 'public') {
                content += `
                    <div class="upgrade-notice">
                        <h4><i class="fas fa-info-circle"></i> Upgrade Your Account</h4>
                        <p>Upgrade to an NCRC Member ($900/year membership) to unlock:</p>
                        <ul>
                            <li>Up to 3 counties/metro areas analysis</li>
                            <li>Export to Excel, PowerPoint, and PDF</li>
                            <li>Access to BranchSeeker, BranchMapper, and BizSight</li>
                        </ul>
                        <p style="margin-top: 10px;"><strong>Or upgrade to Member Plus ($500-750/year add-on) to also unlock DataExplorer with enhanced features!</strong></p>
                    </div>
                `;
            } else if (currentUserType === 'economy') {
                content += `
                    <div class="upgrade-notice">
                        <h4><i class="fas fa-info-circle"></i> Upgrade Your Account</h4>
                        <p>Upgrade to an NCRC Member ($900/year membership) to unlock:</p>
                        <ul>
                            <li>Up to 3 counties/metro areas analysis</li>
                            <li>Export to Excel, PowerPoint, and PDF</li>
                            <li>Access to BranchSeeker, BranchMapper, and BizSight</li>
                        </ul>
                        <p style="margin-top: 10px;"><strong>Or upgrade to Member Plus ($500-750/year add-on) to also unlock DataExplorer with enhanced features!</strong></p>
                    </div>
                `;
            } else if (currentUserType === 'member') {
                content += `
                    <div class="upgrade-notice">
                        <h4><i class="fas fa-info-circle"></i> Upgrade to Member Plus</h4>
                        <p>Unlock DataExplorer with enhanced features for $500-750/year:</p>
                        <ul>
                            <li>Advanced filtering options</li>
                            <li>Bulk export capabilities</li>
                            <li>Custom report builder</li>
                            <li>Historical data access</li>
                            <li>Priority support</li>
                            <li>5+ counties or unlimited geography</li>
                        </ul>
                    </div>
                `;
            }
            
            modalBody.innerHTML = content;
            modal.classList.add('active');
            modal.setAttribute('aria-hidden', 'false');
            document.body.style.overflow = 'hidden';
            
            // Focus on close button for accessibility
            setTimeout(() => {
                modal.querySelector('.modal-close').focus();
            }, 100);
        }

        // Close launch modal
        function closeLaunchModal() {
            const modal = document.getElementById('launchModal');
            modal.classList.remove('active');
            modal.setAttribute('aria-hidden', 'true');
            document.body.style.overflow = '';
        }

        // App descriptions and details
        const appDescriptions = {
            'CommentMaker': {
                description: 'CommentMaker is a free, user-friendly tool designed to help individuals and organizations write and submit public comments to federal regulatory agencies. Instead of navigating complex agency forms, CommentMaker guides you through a simple process to create personalized comment letters that include NCRC\'s key policy points. The tool generates unique, formatted comments ready for submission to agencies like the CFPB, FDIC, OCC, and the Federal Reserve.',
                features: [
                    'Simple form-based interface - no complex agency forms to navigate',
                    'Personalized comment generation with your information',
                    'Integration with NCRC policy positions and recommendations',
                    'Proper formatting for Federal Register submission',
                    'Copy-and-paste ready output for agency comment systems'
                ],
                useCases: [
                    'Community advocates submitting comments on banking regulations',
                    'Organizations responding to proposed rule changes',
                    'Individuals sharing personal experiences with financial services',
                    'Groups amplifying community voices in federal rulemaking'
                ]
            },
            'JustPolicy': {
                description: 'JustPolicy is a JavaScript and AI-driven interactive tool that helps organizations discover and understand policies relevant to their specific mission and service area. The tool asks questions about your organization\'s mission, service area, target population, and other key details, then provides a personalized overview of policies that are particularly relevant to your niche. JustPolicy includes plain-language explanations and supporting data to help you understand policy information and its implications for your work.',
                features: [
                    'Interactive question-based interface to understand your organization\'s needs',
                    'AI-powered policy matching based on mission and service area',
                    'Personalized policy overviews scaled to your specific niche',
                    'Plain-language explanations of complex policy information',
                    'Supporting data and context to help understand policy implications',
                    'Available to all users - free public tool'
                ],
                useCases: [
                    'Community organizations discovering relevant policies for their work',
                    'Advocacy groups understanding policy implications for their mission',
                    'Nonprofits identifying policies that affect their service area',
                    'Organizations new to policy work seeking guidance',
                    'Groups needing plain-language explanations of complex policies'
                ]
            },
            'LendSight': {
                description: 'LendSight provides comprehensive analysis of mortgage lending patterns using Home Mortgage Disclosure Act (HMDA) data. The tool helps identify lending disparities, assess fair lending compliance, and understand lending trends across different demographic groups and geographic areas. LendSight combines HMDA loan data with demographic context from the U.S. Census Bureau to provide actionable insights for advocacy, research, and policy development.',
                features: [
                    'Analysis of mortgage lending by race, ethnicity, and income',
                    'Geographic lending pattern visualization',
                    'Fair lending compliance assessment',
                    'Demographic and economic context integration',
                    'Exportable reports and data tables'
                ],
                useCases: [
                    'Fair lending advocacy and research',
                    'Community development planning',
                    'Market analysis for housing organizations',
                    'Compliance monitoring for financial institutions'
                ]
            },
            'BizSight': {
                description: 'BizSight analyzes small business lending data collected under the Community Reinvestment Act (CRA), which requires financial institutions to report small business loans. The tool helps identify lending patterns, assess market coverage, and understand how small business credit is distributed across different communities, income levels, and geographic areas. BizSight is essential for understanding small business lending disparities and advocating for equitable access to capital.',
                features: [
                    'Small business lending analysis by loan size and purpose',
                    'Geographic distribution of small business credit',
                    'LMI (Low-to-Moderate Income) tract analysis',
                    'Top lender identification and market share analysis',
                    'AI-generated insights and narratives'
                ],
                useCases: [
                    'Small business advocacy and research',
                    'CDFI market analysis and planning',
                    'Community economic development',
                    'Fair lending compliance assessment'
                ]
            },
            'BranchSeeker': {
                description: 'BranchSeeker analyzes bank branch locations, closures, and accessibility patterns using FDIC Summary of Deposits data. The tool helps identify branch deserts, assess market concentration, and understand how branch networks have changed over time. BranchSeeker is critical for understanding physical banking access disparities and their impact on communities, particularly in low-income and minority neighborhoods.',
                features: [
                    'Branch location and closure analysis',
                    'Market concentration metrics',
                    'Demographic coverage analysis',
                    'Historical trend analysis',
                    'Excel export for custom analysis'
                ],
                useCases: [
                    'Branch closure impact assessment',
                    'Market concentration analysis',
                    'Community banking access advocacy',
                    'CDFI branch network planning'
                ]
            },
            'BranchMapper': {
                description: 'BranchMapper provides an interactive map visualization of bank branch locations with demographic and lending context. Users can explore branch networks across geographic areas, filter by institution type, and overlay demographic data to understand how branch locations relate to community characteristics. The tool helps visualize banking access disparities and supports advocacy for equitable branch distribution.',
                features: [
                    'Interactive map with branch locations',
                    'Demographic overlay options',
                    'Institution filtering and search',
                    'Census tract-level detail',
                    'Income and minority level indicators'
                ],
                useCases: [
                    'Visualizing branch access disparities',
                    'Community banking access research',
                    'Advocacy for branch expansion',
                    'Market analysis and planning'
                ]
            },
            'DataExplorer': {
                description: 'DataExplorer is an advanced data exploration and analysis tool that provides comprehensive access to multiple data sources including HMDA mortgage lending, HMDA small business lending, FDIC branch data, and U.S. Census demographic data. The tool offers powerful filtering, cross-tabulation, and export capabilities for users who need deep, customized analysis. DataExplorer is designed for researchers, analysts, and organizations that require flexible data access and advanced reporting features.',
                features: [
                    'Multi-source data integration (HMDA, FDIC, Census)',
                    'Advanced filtering and cross-tabulation',
                    'Bulk export capabilities (Excel, PDF, PowerPoint)',
                    'Custom report builder',
                    'Historical data access',
                    'Priority support'
                ],
                useCases: [
                    'Advanced research and analysis',
                    'Custom report generation',
                    'Data verification and validation',
                    'Comprehensive market studies',
                    'Institutional reporting needs'
                ]
            },
            'LenderProfile': {
                description: 'LenderProfile generates comprehensive intelligence reports on lenders for NCRC leadership, combining corporate structure, financial performance, regulatory compliance, legal history, organizational structure, and strategic positioning. This complements DataExplorer by providing non-HMDA intelligence using free APIs and AI summarization. Reports help senior staff understand lender organizations, identify partnership opportunities, evaluate CBA renewals, and prepare for merger opposition.',
                features: [
                    'Corporate structure and legal entity hierarchy',
                    '5-year financial trends and peer comparison',
                    'CRA performance ratings and evaluations',
                    'Regulatory enforcement history (CFPB, OCC, Fed)',
                    'Litigation tracking (CourtListener)',
                    'Executive profiles and organizational analysis',
                    'Merger activity and market context',
                    'Recent developments and news coverage',
                    'AI-generated executive summaries',
                    'Advocacy intelligence scoring'
                ],
                useCases: [
                    'CBA opportunity evaluation',
                    'Merger opposition decision framework',
                    'Partnership opportunity identification',
                    'Executive background research',
                    'Regulatory compliance assessment',
                    'Strategic positioning analysis'
                ]
            },
            'MergerMeter': {
                description: 'MergerMeter analyzes proposed bank mergers and acquisitions, assessing their potential impact on market concentration, community lending, and branch access. The tool helps advocates, researchers, and regulators evaluate merger proposals and understand their implications for competition and community reinvestment. MergerMeter supports informed public comment on merger applications and advocacy for merger conditions that protect community interests.',
                features: [
                    'Market concentration analysis',
                    'Branch network impact assessment',
                    'Lending commitment evaluation',
                    'Community impact projections',
                    'Exportable analysis reports'
                ],
                useCases: [
                    'Merger application analysis',
                    'Public comment preparation',
                    'Regulatory advocacy',
                    'Market competition research'
                ]
            },
            'LenderProfile': {
                description: 'LenderProfile is a JustData application that lets NCRC members quickly research any lender. It generates an AI-driven report covering lender identification, mortgage and small business lending profiles, branch footprint, CFPB complaints, and AI-generated narratives. The tool helps members understand lenders they haven\'t dealt with before, so they know what questions to ask, where the lender operates, what they do, and who the major players are. Reports use simple visualizations and explain technical terms in plain language.',
                features: [
                    'Lender Identification: Search by name with fuzzy matching',
                    'Mortgage Lending Profile: HMDA data showing volumes, shares, and basic disparities',
                    'Small Business Lending Profile: Small business lending patterns from existing SB data',
                    'Branch Footprint: Geographic presence (SOD 25 for banks, NCUA for credit unions)',
                    'CFPB Complaints: Summary of consumer complaints with context',
                    'AI-Generated Narrative: Plain-language explanations of lender operations and patterns',
                    'Key Questions to Ask: 5-10 AI-generated questions based on the lender\'s profile',
                    'Enhanced Data (Phase 2): SEC filings, enforcement actions, news, and corporate leadership'
                ],
                useCases: [
                    'Quick lender research before meetings or partnerships',
                    'Understanding lender operations and market presence',
                    'Identifying key questions to ask lenders',
                    'Researching lenders for advocacy and engagement',
                    'Comparing lender performance and practices'
                ]
            },
            'Analytics': {
                description: 'Analytics dashboard provides comprehensive monitoring of user activity, application usage patterns, and platform analytics. This internal tool is available only to NCRC staff and administrators. The dashboard includes interactive maps showing user locations, activity patterns, and usage statistics to help understand how JustData tools are being utilized.',
                features: [
                    'User activity monitoring',
                    'Application usage statistics',
                    'Interactive user location maps',
                    'Activity pattern analysis',
                    'Platform analytics and metrics'
                ],
                useCases: [
                    'Understanding user engagement',
                    'Identifying popular features',
                    'Monitoring platform usage',
                    'Data-driven platform improvements'
                ]
            },
            'Administration': {
                description: 'Administration dashboard provides comprehensive user and system management capabilities for JustData platform administrators. This internal tool allows management of user accounts, Memberful integrations, HubSpot configurations, and system settings. Available only to platform administrators.',
                features: [
                    'User account management',
                    'Memberful link management',
                    'HubSpot integration configuration',
                    'System settings and configuration',
                    'Access control management'
                ],
                useCases: [
                    'User account administration',
                    'Integration management',
                    'System configuration',
                    'Access control and permissions'
                ]
            },
            'Admin': {
                description: 'Administration dashboard provides comprehensive user and system management capabilities for JustData platform administrators. This internal tool allows management of user accounts, Memberful integrations, HubSpot configurations, and system settings. Available only to platform administrators.',
                features: [
                    'User account management',
                    'Memberful link management',
                    'HubSpot integration configuration',
                    'System settings and configuration',
                    'Access control management'
                ],
                useCases: [
                    'User account administration',
                    'Integration management',
                    'System configuration',
                    'Access control and permissions'
                ]
            }
        };

        // Show app info modal
        function handleInfoClick(appName) {
            const modal = document.getElementById('appInfoModal');
            const modalTitle = document.getElementById('appInfoName');
            const modalBody = document.getElementById('appInfoModalBody');
            
            modalTitle.textContent = appName + ' - Application Information';
            
            // Special handling for Analytics and Administration - show mockup
            if (appName === 'Analytics' || appName === 'Administration' || appName === 'Admin') {
                let mockupFile = '';
                if (appName === 'Analytics') {
                    mockupFile = '/static/mockups/analytics-dashboard.html?v=' + Date.now();
                } else {
                    mockupFile = '/static/mockups/admin-dashboard.html?v=' + Date.now();
                }
                
                // Add wider modal class for better mockup display
                const modalContent = modal.querySelector('.modal-content');
                if (modalContent) {
                    modalContent.classList.add('mockup-modal');
                }
                
                const appInfo = appDescriptions[appName] || {};
                let content = '';
                
                // App description
                if (appInfo && appInfo.description) {
                    content += `
                        <div class="feature-detail-section">
                            <h4><i class="fas fa-info-circle"></i> About ${appName}</h4>
                            <p>${appInfo.description}</p>
                        </div>
                    `;
                }
                
                // Key features
                if (appInfo && appInfo.features) {
                    content += `
                        <div class="feature-detail-section">
                            <h4><i class="fas fa-star"></i> Key Features</h4>
                            <ul style="margin: 10px 0; padding-left: 20px; color: var(--ncrc-gray-dark);">
                                ${appInfo.features.map(feature => `<li>${feature}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
                
                // Mockup preview
                content += `
                    <div class="feature-detail-section" style="margin-top: 20px;">
                        <h4><i class="fas fa-desktop"></i> Dashboard Preview</h4>
                        <div style="border: 1px solid #ddd; border-radius: 8px; overflow: hidden; margin-top: 10px; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <iframe 
                                src="${mockupFile}" 
                                style="width: 100%; height: 700px; border: none; display: block;"
                                title="${appName} Dashboard Mockup"
                                loading="lazy"
                                allow="fullscreen">
                            </iframe>
                        </div>
                        <p style="margin-top: 10px; font-size: 0.9rem; color: var(--ncrc-gray);">
                            <i class="fas fa-info-circle"></i> This is a preview mockup of the ${appName} dashboard interface.
                        </p>
                    </div>
                `;
                
                modalBody.innerHTML = content;
                modal.classList.add('active');
                modal.setAttribute('aria-hidden', 'false');
                document.body.style.overflow = 'hidden';
                
                // Focus on close button for accessibility
                setTimeout(() => {
                    modal.querySelector('.modal-close').focus();
                }, 100);
                return;
            }
            
            // Remove mockup-modal class for other apps
            const modalContent = modal.querySelector('.modal-content');
            if (modalContent) {
                modalContent.classList.remove('mockup-modal');
            }
            
            // Get app key (lowercase, handle variations)
            let appKey = appName.toLowerCase().replace(/\s+/g, '');
            // Handle app name variations
            const appNameMap = {
                'commentmaker': 'commentmaker',
                'justpolicy': 'justpolicy',
                'lendsight': 'lendsight',
                'bizsight': 'bizsight',
                'branchseeker': 'branchseeker',
                'branchmapper': 'branchmapper',
                'dataexplorer': 'dataexplorer',
                'mergermeter': 'mergermeter',
                'lenderprofile': 'lenderprofile'
            };
            appKey = appNameMap[appKey] || appKey;
            
            const appInfo = appDescriptions[appName] || {};
            const accessConfig = appAccessConfig[appKey] || {};
            
            let content = '';
            
            // App description
            if (appInfo && appInfo.description) {
                content += `
                    <div class="feature-detail-section">
                        <h4><i class="fas fa-info-circle"></i> About ${appName}</h4>
                        <p>${appInfo.description}</p>
                    </div>
                `;
            }
            
            // Key features
            if (appInfo && appInfo.features) {
                content += `
                    <div class="feature-detail-section">
                        <h4><i class="fas fa-star"></i> Key Features</h4>
                        <ul style="margin: 10px 0; padding-left: 20px; color: var(--ncrc-gray-dark);">
                            ${appInfo.features.map(feature => `<li>${feature}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            // Use cases
            if (appInfo && appInfo.useCases) {
                content += `
                    <div class="feature-detail-section">
                        <h4><i class="fas fa-briefcase"></i> Common Use Cases</h4>
                        <ul style="margin: 10px 0; padding-left: 20px; color: var(--ncrc-gray-dark);">
                            ${appInfo.useCases.map(useCase => `<li>${useCase}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            // User access information
            content += `
                <div class="feature-detail-section">
                    <h4><i class="fas fa-users"></i> User Access</h4>
                    <p><strong>Access by User Type:</strong></p>
                    <ul style="margin: 10px 0; padding-left: 20px; color: var(--ncrc-gray-dark);">
            `;
            
            const userTypeLabels = {
                'public': 'Public (Free)',
                'economy': 'Just Economy Club (Free)',
                'member': 'NCRC Member ($900/yr - included with membership)',
                'memberplus': 'Member Plus ($500-750/yr add-on)',
                'institutional': 'Institutional ($5K-15K/yr)',
                'staff': 'NCRC Staff (Free - included with employment)',
                'admin': 'Administrator (Free - internal)'
            };
            
            Object.keys(userTypeLabels).forEach(userType => {
                const access = accessConfig[userType] || 'hidden';
                let accessLabel = '';
                let accessIcon = '';
                
                if (access === 'full') {
                    accessLabel = 'Full Access';
                    accessIcon = '<i class="fas fa-check-circle" style="color: #28a745;"></i>';
                } else if (access === 'limited') {
                    accessLabel = 'Limited Access';
                    accessIcon = '<i class="fas fa-exclamation-circle" style="color: #ffc107;"></i>';
                } else if (access === 'locked') {
                    accessLabel = 'Not Available';
                    accessIcon = '<i class="fas fa-lock" style="color: #dc3545;"></i>';
                } else {
                    accessLabel = 'Hidden';
                    accessIcon = '<i class="fas fa-eye-slash" style="color: #6c757d;"></i>';
                }
                
                content += `<li>${accessIcon} <strong>${userTypeLabels[userType]}:</strong> ${accessLabel}</li>`;
            });
            
            content += `
                    </ul>
                </div>
            `;
            
            modalBody.innerHTML = content;
            modal.classList.add('active');
            modal.setAttribute('aria-hidden', 'false');
            document.body.style.overflow = 'hidden';
            
            // Focus on close button for accessibility
            setTimeout(() => {
                modal.querySelector('.modal-close').focus();
            }, 100);
        }

        // Close app info modal
        function closeAppInfoModal() {
            const modal = document.getElementById('appInfoModal');
            const modalContent = modal.querySelector('.modal-content');
            if (modalContent) {
                modalContent.classList.remove('mockup-modal');
            }
            modal.classList.remove('active');
            modal.setAttribute('aria-hidden', 'true');
            document.body.style.overflow = '';
        }

        // Handle keyboard navigation for cards
        function handleCardKeyDown(event, appName) {
            // Enter or Space key activates the card
            if (event.key === 'Enter' || event.key === ' ') {
                event.preventDefault();
                handleCardClick(appName);
            }
        }

        // Add focus management for better keyboard navigation
        document.addEventListener('DOMContentLoaded', async function() {
            // Check auth status and set user type accordingly
            let userType = 'public_anonymous';  // Default for non-authenticated users

            let authData = null;
            try {
                const response = await fetch('/api/auth/status');
                authData = await response.json();
                if (authData.user_type) {
                    userType = authData.user_type;
                }
                console.log('User type:', userType, '| Authenticated:', authData.authenticated);
            } catch (error) {
                console.log('Auth check failed, using public_anonymous:', error);
            }

            document.getElementById('userTypeSelect').value = userType;
            switchUserType(userType);

            // Update welcome greeting with user's name
            const welcomeGreeting = document.getElementById('welcomeGreeting');
            if (welcomeGreeting && authData) {
                if (authData.authenticated && authData.user && authData.user.name) {
                    // Extract first name from display name
                    const firstName = authData.user.name.split(' ')[0];
                    welcomeGreeting.textContent = 'Welcome back, ' + firstName;
                } else if (authData.authenticated && authData.user && authData.user.email) {
                    // Use email username as fallback
                    const emailName = authData.user.email.split('@')[0];
                    welcomeGreeting.textContent = 'Welcome back, ' + emailName;
                } else if (authData.authenticated) {
                    welcomeGreeting.textContent = 'Welcome back';
                } else {
                    welcomeGreeting.textContent = 'Welcome to JustData';
                }
            }

            // Fetch and display platform stats
            try {
                const statsResponse = await fetch('/api/platform-stats');
                if (statsResponse.ok) {
                    const stats = await statsResponse.json();
                    // Format large numbers nicely (e.g., 12.5M+)
                    const formatNumber = (num) => {
                        if (num >= 1000000) {
                            return (num / 1000000).toFixed(1).replace(/\.0$/, '') + 'M+';
                        } else if (num >= 1000) {
                            return (num / 1000).toFixed(1).replace(/\.0$/, '') + 'K+';
                        }
                        return num.toLocaleString();
                    };

                    const mortgageEl = document.getElementById('mortgageRecords');
                    const lendersEl = document.getElementById('lendersTracked');
                    const reportsEl = document.getElementById('reportsGenerated');
                    const researchersEl = document.getElementById('activeResearchers');

                    if (mortgageEl && stats.mortgage_records !== undefined) {
                        mortgageEl.textContent = formatNumber(stats.mortgage_records);
                    }
                    if (lendersEl && stats.lenders_tracked !== undefined) {
                        lendersEl.textContent = formatNumber(stats.lenders_tracked);
                    }
                    if (reportsEl && stats.reports_generated !== undefined) {
                        reportsEl.textContent = stats.reports_generated.toLocaleString();
                    }
                    if (researchersEl && stats.active_researchers !== undefined) {
                        researchersEl.textContent = stats.active_researchers.toLocaleString();
                    }
                }
            } catch (error) {
                console.log('Stats fetch failed:', error);
            }

            // Show admin section for staff/senior_executive/admin users
            const adminSection = document.getElementById('adminSection');
            if (adminSection) {
                if (userType === 'staff' || userType === 'senior_executive' || userType === 'admin') {
                    adminSection.style.display = 'block';
                } else {
                    adminSection.style.display = 'none';
                }
            }

            // Hide Administration card for non-admin users (only admin can see it)
            const administrationCard = document.getElementById('administrationCard');
            if (administrationCard) {
                if (userType === 'admin') {
                    administrationCard.style.display = 'flex';
                } else {
                    administrationCard.style.display = 'none';
                }
            }

            const cards = document.querySelectorAll('.app-card');
            
            // Add visual feedback for keyboard users
            cards.forEach(card => {
                card.addEventListener('focus', function() {
                    this.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                });
            });

            // Announce page load to screen readers
            const announcement = document.createElement('div');
            announcement.setAttribute('role', 'status');
            announcement.setAttribute('aria-live', 'polite');
            announcement.setAttribute('aria-atomic', 'true');
            announcement.className = 'sr-only';
            announcement.style.cssText = 'position: absolute; left: -10000px; width: 1px; height: 1px; overflow: hidden;';
            announcement.textContent = 'JustData landing page loaded. ' + cards.length + ' applications available.';
            document.body.appendChild(announcement);

            // Remove announcement after screen reader has time to read it
            setTimeout(() => {
                announcement.remove();
            }, 1000);
        });

        // User Types Modal Functions
        function openUserTypesModal() {
            const modal = document.getElementById('userTypesModal');
            modal.classList.add('active');
            modal.setAttribute('aria-hidden', 'false');
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
            
            // Focus on close button for accessibility
            setTimeout(() => {
                modal.querySelector('.modal-close').focus();
            }, 100);
        }

        function closeUserTypesModal() {
            const modal = document.getElementById('userTypesModal');
            modal.classList.remove('active');
            modal.setAttribute('aria-hidden', 'true');
            document.body.style.overflow = ''; // Restore scrolling
            
            // Return focus to button that opened modal
            // Focus restored
        }

        // Expected Income & Sources Modal Functions
        function openIncomeSourcesModal() {
            const modal = document.getElementById('incomeSourcesModal');
            modal.classList.add('active');
            modal.setAttribute('aria-hidden', 'false');
            document.body.style.overflow = 'hidden';
            
            // Focus on close button for accessibility
            setTimeout(() => {
                modal.querySelector('.modal-close').focus();
            }, 100);
        }

        function closeIncomeSourcesModal() {
            const modal = document.getElementById('incomeSourcesModal');
            modal.classList.remove('active');
            modal.setAttribute('aria-hidden', 'true');
            document.body.style.overflow = '';
            
            // Focus restored
        }

        // Close modal on Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const userTypesModal = document.getElementById('userTypesModal');
                const launchModal = document.getElementById('launchModal');
                const incomeSourcesModal = document.getElementById('incomeSourcesModal');
                const appInfoModal = document.getElementById('appInfoModal');
                if (userTypesModal.classList.contains('active')) {
                    closeUserTypesModal();
                }
                if (launchModal.classList.contains('active')) {
                    closeLaunchModal();
                }
                if (incomeSourcesModal.classList.contains('active')) {
                    closeIncomeSourcesModal();
                }
                if (appInfoModal.classList.contains('active')) {
                    closeAppInfoModal();
                }
            }
        });

        // Close modal when clicking overlay (but not modal content)
        document.getElementById('userTypesModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeUserTypesModal();
            }
        });

        document.getElementById('launchModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeLaunchModal();
            }
        });

        document.getElementById('incomeSourcesModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeIncomeSourcesModal();
            }
        });

        document.getElementById('appInfoModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeAppInfoModal();
            }
        });
    </script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>

    <!-- JustData Auth -->
    <script src="/static/js/auth.js"></script>

    <!-- Auth-gated app launching -->
    <script>
        // Intercept app launch buttons to require authentication
        document.addEventListener('DOMContentLoaded', function() {
            // Wait for Firebase to initialize
            setTimeout(function() {
                // Add click handlers to all launch buttons
                document.querySelectorAll('.app-card-launch-btn').forEach(function(btn) {
                    btn.addEventListener('click', function(e) {
                        // Check if user is authenticated
                        if (typeof JustDataAuth !== 'undefined' && !JustDataAuth.isAuthenticated()) {
                            e.preventDefault();
                            e.stopPropagation();

                            // Show sign-in prompt
                            if (confirm('Please sign in to access JustData applications.\n\nClick OK to sign in with Google.')) {
                                JustDataAuth.signInWithGoogle().then(function() {
                                    // After successful sign-in, open the app in a new window
                                    window.open(btn.getAttribute('href'), '_blank', 'noopener,noreferrer');
                                }).catch(function(err) {
                                    console.log('Sign-in cancelled or failed');
                                });
                            }
                        }
                        // If authenticated, allow normal navigation
                    });
                });

                // Also intercept nav menu links
                document.querySelectorAll('#navMenu .nav-item').forEach(function(link) {
                    const href = link.getAttribute('href');
                    if (href && href !== '/' && !href.startsWith('#')) {
                        link.addEventListener('click', function(e) {
                            if (typeof JustDataAuth !== 'undefined' && !JustDataAuth.isAuthenticated()) {
                                e.preventDefault();

                                if (confirm('Please sign in to access JustData applications.\n\nClick OK to sign in with Google.')) {
                                    JustDataAuth.signInWithGoogle().then(function() {
                                        window.open(href, '_blank', 'noopener,noreferrer');
                                    }).catch(function(err) {
                                        console.log('Sign-in cancelled or failed');
                                    });
                                }
                            }
                        });
                    }
                });
            }, 500); // Give Firebase time to initialize
        });
    </script>
</body>
</html>

